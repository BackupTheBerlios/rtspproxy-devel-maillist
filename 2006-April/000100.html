<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Rtspproxy-devel] r416 - in trunk: . RTSPProxy-App RTSPProxy-App/src/main/java/rtspproxy/filter/accounting RTSPProxy-App/src/main/java/rtspproxy/filter/authentication RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite RTSPProxy-App/src/resources/conf RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress RTSPProxy-Core RTSPProxy-Core/src RTSPProxy-Core/src/main/java/gov/nist/core RTSPProxy-Core/src/main/java/gov/nist/javax/sdp RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser RTSPProxy-Core/src/main/java/javax/sdp RTSPProxy-Core/src/main/java/rtspproxy RTSPProxy-Core/src/main/java/rtspproxy/config RTSPProxy-Core/src/main/java/rtspproxy/filter RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme RTSPProxy-Core/src/main/java/rtspproxy/filte! r/control RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking RTSPProxy-Core/src/main/java/rtspproxy/jmx RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans RTSPProxy-Core/src/main/java/rtspproxy/lib RTSPProxy-Core/src/main/java/rtspproxy/lib/number RTSPProxy-Core/src/main/java/rtspproxy/proxy RTSPProxy-Core/src/main/java/rtspproxy/proxy/track RTSPProxy-Core/src/main/java/rtspproxy/rdt RTSPProxy-Core/src/main/java/rtspproxy/rtp/range RTSPProxy-Core/src/main/java/rtspproxy/rtsp RTSPProxy-Core/src/test/java/rtspproxy/lib/number RTSPProxy-Core/src/test/java/rtspproxy/rdt RTSPProxy-Core/src/test/java/rtspproxy/rtsp RTSPProxy-Core/src/test/resources/rtspproxy/rdt RTSPProxy-OSGi src/changes src/site
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/rtspproxy-devel/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:rtspproxy-devel%40lists.berlios.de?Subject=Re%3A%20%5BRtspproxy-devel%5D%20r416%20-%20in%20trunk%3A%20.%20RTSPProxy-App%20RTSPProxy-App/src/main/java/rtspproxy/filter/accounting%20RTSPProxy-App/src/main/java/rtspproxy/filter/authentication%20RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress%20RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite%20RTSPProxy-App/src/resources/conf%20RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress%20RTSPProxy-Core%20RTSPProxy-Core/src%20RTSPProxy-Core/src/main/java/gov/nist/core%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser%20RTSPProxy-Core/src/main/java/javax/sdp%20RTSPProxy-Core/src/main/java/rtspproxy%20RTSPProxy-Core/src/main/java/rtspproxy/config%20RTSPProxy-Core/src/main/java/rtspproxy/filter%20RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting%20RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication%20RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme%20RTSPProxy-Core/src/main/java/rtspproxy/filte%21%0A%20r/control%20RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress%20RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite%20RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking%20RTSPProxy-Core/src/main/java/rtspproxy/jmx%20RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans%20RTSPProxy-Core/src/main/java/rtspproxy/lib%20RTSPProxy-Core/src/main/java/rtspproxy/lib/number%20RTSPProxy-Core/src/main/java/rtspproxy/proxy%20RTSPProxy-Core/src/main/java/rtspproxy/proxy/track%20RTSPProxy-Core/src/main/java/rtspproxy/rdt%20RTSPProxy-Core/src/main/java/rtspproxy/rtp/range%20RTSPProxy-Core/src/main/java/rtspproxy/rtsp%20RTSPProxy-Core/src/test/java/rtspproxy/lib/number%20RTSPProxy-Core/src/test/java/rtspproxy/rdt%20RTSPProxy-Core/src/test/java/rtspproxy/rtsp%20RTSPProxy-Core/src/test/resources/rtspproxy/rdt%20RTSPProxy-OSGi%20src/changes%20src/site&In-Reply-To=%3C200604252150.k3PLokxI002763%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000099.html">
   <LINK REL="Next"  HREF="000101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Rtspproxy-devel] r416 - in trunk: . RTSPProxy-App RTSPProxy-App/src/main/java/rtspproxy/filter/accounting RTSPProxy-App/src/main/java/rtspproxy/filter/authentication RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite RTSPProxy-App/src/resources/conf RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress RTSPProxy-Core RTSPProxy-Core/src RTSPProxy-Core/src/main/java/gov/nist/core RTSPProxy-Core/src/main/java/gov/nist/javax/sdp RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser RTSPProxy-Core/src/main/java/javax/sdp RTSPProxy-Core/src/main/java/rtspproxy RTSPProxy-Core/src/main/java/rtspproxy/config RTSPProxy-Core/src/main/java/rtspproxy/filter RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme RTSPProxy-Core/src/main/java/rtspproxy/filte! r/control RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking RTSPProxy-Core/src/main/java/rtspproxy/jmx RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans RTSPProxy-Core/src/main/java/rtspproxy/lib RTSPProxy-Core/src/main/java/rtspproxy/lib/number RTSPProxy-Core/src/main/java/rtspproxy/proxy RTSPProxy-Core/src/main/java/rtspproxy/proxy/track RTSPProxy-Core/src/main/java/rtspproxy/rdt RTSPProxy-Core/src/main/java/rtspproxy/rtp/range RTSPProxy-Core/src/main/java/rtspproxy/rtsp RTSPProxy-Core/src/test/java/rtspproxy/lib/number RTSPProxy-Core/src/test/java/rtspproxy/rdt RTSPProxy-Core/src/test/java/rtspproxy/rtsp RTSPProxy-Core/src/test/resources/rtspproxy/rdt RTSPProxy-OSGi src/changes src/site</H1>
    <B>merlimat at berlios.de</B> 
    <A HREF="mailto:rtspproxy-devel%40lists.berlios.de?Subject=Re%3A%20%5BRtspproxy-devel%5D%20r416%20-%20in%20trunk%3A%20.%20RTSPProxy-App%20RTSPProxy-App/src/main/java/rtspproxy/filter/accounting%20RTSPProxy-App/src/main/java/rtspproxy/filter/authentication%20RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress%20RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite%20RTSPProxy-App/src/resources/conf%20RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress%20RTSPProxy-Core%20RTSPProxy-Core/src%20RTSPProxy-Core/src/main/java/gov/nist/core%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields%20RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser%20RTSPProxy-Core/src/main/java/javax/sdp%20RTSPProxy-Core/src/main/java/rtspproxy%20RTSPProxy-Core/src/main/java/rtspproxy/config%20RTSPProxy-Core/src/main/java/rtspproxy/filter%20RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting%20RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication%20RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme%20RTSPProxy-Core/src/main/java/rtspproxy/filte%21%0A%20r/control%20RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress%20RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite%20RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking%20RTSPProxy-Core/src/main/java/rtspproxy/jmx%20RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans%20RTSPProxy-Core/src/main/java/rtspproxy/lib%20RTSPProxy-Core/src/main/java/rtspproxy/lib/number%20RTSPProxy-Core/src/main/java/rtspproxy/proxy%20RTSPProxy-Core/src/main/java/rtspproxy/proxy/track%20RTSPProxy-Core/src/main/java/rtspproxy/rdt%20RTSPProxy-Core/src/main/java/rtspproxy/rtp/range%20RTSPProxy-Core/src/main/java/rtspproxy/rtsp%20RTSPProxy-Core/src/test/java/rtspproxy/lib/number%20RTSPProxy-Core/src/test/java/rtspproxy/rdt%20RTSPProxy-Core/src/test/java/rtspproxy/rtsp%20RTSPProxy-Core/src/test/resources/rtspproxy/rdt%20RTSPProxy-OSGi%20src/changes%20src/site&In-Reply-To=%3C200604252150.k3PLokxI002763%40sheep.berlios.de%3E"
       TITLE="[Rtspproxy-devel] r416 - in trunk: . RTSPProxy-App RTSPProxy-App/src/main/java/rtspproxy/filter/accounting RTSPProxy-App/src/main/java/rtspproxy/filter/authentication RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite RTSPProxy-App/src/resources/conf RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress RTSPProxy-Core RTSPProxy-Core/src RTSPProxy-Core/src/main/java/gov/nist/core RTSPProxy-Core/src/main/java/gov/nist/javax/sdp RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser RTSPProxy-Core/src/main/java/javax/sdp RTSPProxy-Core/src/main/java/rtspproxy RTSPProxy-Core/src/main/java/rtspproxy/config RTSPProxy-Core/src/main/java/rtspproxy/filter RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme RTSPProxy-Core/src/main/java/rtspproxy/filte! r/control RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking RTSPProxy-Core/src/main/java/rtspproxy/jmx RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans RTSPProxy-Core/src/main/java/rtspproxy/lib RTSPProxy-Core/src/main/java/rtspproxy/lib/number RTSPProxy-Core/src/main/java/rtspproxy/proxy RTSPProxy-Core/src/main/java/rtspproxy/proxy/track RTSPProxy-Core/src/main/java/rtspproxy/rdt RTSPProxy-Core/src/main/java/rtspproxy/rtp/range RTSPProxy-Core/src/main/java/rtspproxy/rtsp RTSPProxy-Core/src/test/java/rtspproxy/lib/number RTSPProxy-Core/src/test/java/rtspproxy/rdt RTSPProxy-Core/src/test/java/rtspproxy/rtsp RTSPProxy-Core/src/test/resources/rtspproxy/rdt RTSPProxy-OSGi src/changes src/site">merlimat at berlios.de
       </A><BR>
    <I>Tue Apr 25 23:50:46 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000099.html">[Rtspproxy-devel] r415 - in trunk: RTSPProxy-App RTSPProxy-App/src/main/java/rtspproxy RTSPProxy-App/src/main/java/rtspproxy/filter/accounting RTSPProxy-App/src/resources/conf RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress RTSPProxy-Core RTSPProxy-Core/src/main/java/gov/nist/javax/sdp RTSPProxy-Core/src/main/java/javax/sdp RTSPProxy-Core/src/main/java/rtspproxy RTSPProxy-Core/src/main/java/rtspproxy/config RTSPProxy-Core/src/main/java/rtspproxy/filter RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme RTSPProxy-Core/src/main/java/rtspproxy/filter/control RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking RTSPProxy-Core/src/main/java/rtspproxy/jmx RTSPProxy-Core/src/main/java/rtspproxy/lib RTSPProxy-Core/src/main/java/rtspproxy/lib/number RTSPProxy-Core/src/main/java/rtspproxy/proxy RTSPProxy-Core/src/main/java/rtspproxy/proxy/track RTSPProxy-! Core/src/main/java/rtspproxy/rdt RTSPProxy-Core/src/main/java/rtspproxy/rtp/range RTSPProxy-Core/src/main/java/rtspproxy/rtsp
</A></li>
        <LI>Next message: <A HREF="000101.html">[Rtspproxy-devel] r417 - in trunk: . JainSDP JainSDP/src JainSDP/src/main JainSDP/src/main/java JainSDP/src/main/java/javax RTSPProxy-Core/src/main/java RTSPProxy-Core/src/main/java/javax RTSPProxy-OSGi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100">[ date ]</a>
              <a href="thread.html#100">[ thread ]</a>
              <a href="subject.html#100">[ subject ]</a>
              <a href="author.html#100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: merlimat
Date: 2006-04-25 23:47:58 +0200 (Tue, 25 Apr 2006)
New Revision: 416

Added:
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/IpAddressPattern.java
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/RewriteMapping.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/Mx4jLoggerWrapper.java
Removed:
   trunk/RTSPProxy-Core/src/changes/
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfig.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfigurable.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProviderAdapter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ClientControlFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ServerControlFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ClientUrlRewritingFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ServerUrlRewritingFilter.java
Modified:
   trunk/RTSPProxy-App/pom.xml
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/accounting/SimpleAccountingProvider.java
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/authentication/SimpleAuthenticationProvider.java
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/SimpleIpAddressProvider.java
   trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/SimpleUrlRewritingProvider.java
   trunk/RTSPProxy-App/src/resources/conf/rtspproxy.conf.xml
   trunk/RTSPProxy-App/src/resources/conf/rtspproxy.log4j.xml
   trunk/RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress/PlainTextIpAddressProviderTest.java
   trunk/RTSPProxy-Core/pom.xml
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Debug.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/GenericObject.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/GenericObjectList.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Host.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/HostNameParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/HostPort.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/InternalErrorHandler.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/LexerCore.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/LogWriter.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Match.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/NameValue.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/NameValueList.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/PackageNames.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/ParserCore.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Separators.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/StringTokenizer.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Token.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/MediaDescriptionImpl.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/SdpEncoderImpl.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/SessionDescriptionImpl.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/TimeDescriptionImpl.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/AttributeField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/BandwidthField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ConnectionAddress.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ConnectionField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/Email.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/EmailAddress.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/EmailField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/Indentation.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/InformationField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/KeyField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/MediaField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/OriginField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/PhoneField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ProtoVersionField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/RepeatField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFieldList.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFieldNames.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFormat.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPKeywords.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPObject.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPObjectList.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SessionNameField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/TimeField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/TypedTime.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/URIField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ZoneAdjustment.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ZoneField.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/AttributeFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/BandwidthFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ConnectionFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/EmailFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/InformationFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/KeyFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/Lexer.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/MediaFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/OriginFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ParserFactory.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/PhoneFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ProtoVersionFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/RepeatFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SDPAnnounceParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SDPParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SessionNameFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/TimeFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/URIFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ZoneFieldParser.java
   trunk/RTSPProxy-Core/src/main/java/javax/sdp/SdpFactory.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyService.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyServiceRegistry.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/Config.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListElementParameter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListParameter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/XMLConfigReader.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterBase.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterRegistry.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProvider.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspClientFilters.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspServerFilters.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingProviderAdapter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/AuthenticationFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme/BasicAuthentication.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProvider.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProviderAdapter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressProvider.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingProvider.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingResult.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionClientTrackingFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionTrackingFilter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxAgent.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxManageable.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxManageable2.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/Filter.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/FilterMBean.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpServerFactory.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpServerFactoryMBean.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpSession.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpSessionMBean.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/ProxySessionFacade.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/ProxySessionFacadeMBean.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/Base64.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/Side.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedByte.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedInt.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedLong.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedNumber.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedShort.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ClientRtcpPacketHandler.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyConstants.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyHandler.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/track/Track.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtAckPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtControlPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtDataPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtFilterChainBuilder.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtLatencyReportPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtPacketDecoder.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolCodecFactory.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolDecoder.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolEncoder.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtRttRequestPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtRttResponsePacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtStreamEndPacket.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/PortrangeRtpServerSession.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/PortrangeRtpServerSessionFactory.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/RtpRtcpFilterChainBuilder.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/RtpServerSessionFactory.java
   trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtsp/RtspTransportList.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedByteTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedIntTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedLongTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedShortTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/BufferUtils.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtAckPacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtDataPacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtLatencyRepostPacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtRttRequestPacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtRttResponsePacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtStreamEndPacketTest.java
   trunk/RTSPProxy-Core/src/test/java/rtspproxy/rtsp/RtspTransportTest.java
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtAckPacket.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketDataPacket.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketStream0.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketStream1.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtLatencyReportWithDataPacket.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtRttRequestPacket.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtRttResponsePacket.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtStreamEndPacketStream0.txt
   trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtStreamEndPacketStream1.txt
   trunk/RTSPProxy-OSGi/pom.xml
   trunk/pom.xml
   trunk/src/changes/changes.xml
   trunk/src/site/site.xml
Log:
Another 'all-in-one' change-set. (Hope it'll be the last one). The filters 
are now working with the new configuration system, again XML but using 
Commons-Configuration instead of plain dom4j. Many updates to project 
descriptors too.



Modified: trunk/RTSPProxy-App/pom.xml
===================================================================
--- trunk/RTSPProxy-App/pom.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/pom.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -11,64 +11,30 @@
 		&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
 		&lt;artifactId&gt;rtspproxy&lt;/artifactId&gt;
 		&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-		&lt;!--	&lt;relativePath&gt;../pom.xml&lt;/relativePath&gt; --&gt;
+		&lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;
 	&lt;/parent&gt;
 
 	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
 
 	&lt;name&gt;RTSP Proxy standalone application&lt;/name&gt;
-	&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
-	&lt;artifactId&gt;RTSPProxy-App&lt;/artifactId&gt;
-	&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-	&lt;url&gt;<A HREF="http://rtspproxy.berlios.de&lt;/url">http://rtspproxy.berlios.de&lt;/url</A>&gt;
-	&lt;inceptionYear&gt;2003&lt;/inceptionYear&gt;
+	&lt;artifactId&gt;RTSPProxy-App&lt;/artifactId&gt;&#729;
 
-
 	&lt;dependencies&gt;
 		&lt;dependency&gt;
 			&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
 			&lt;artifactId&gt;RTSPProxy-Core&lt;/artifactId&gt;
 			&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-		&lt;/dependency&gt;
-		
-		&lt;dependency&gt;
-			&lt;groupId&gt;junit&lt;/groupId&gt;
-			&lt;artifactId&gt;junit&lt;/artifactId&gt;
-			&lt;version&gt;3.8.1&lt;/version&gt;
-			&lt;scope&gt;test&lt;/scope&gt;
-		&lt;/dependency&gt;
-		
+		&lt;/dependency&gt;		
 	&lt;/dependencies&gt;
 
 
 	&lt;build&gt;
 		&lt;defaultGoal&gt;assembly:directory&lt;/defaultGoal&gt;
 
-		&lt;resources&gt;
-			&lt;resource&gt;
-				&lt;directory&gt;src/main/resources&lt;/directory&gt;
-				&lt;filtering&gt;true&lt;/filtering&gt;
-			&lt;/resource&gt;
-		&lt;/resources&gt;
-
 		&lt;plugins&gt;
 			&lt;plugin&gt;
 				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
-				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
-				&lt;configuration&gt;
-					&lt;source&gt;1.5&lt;/source&gt;
-					&lt;target&gt;1.5&lt;/target&gt;
-					&lt;showWarnings&gt;true&lt;/showWarnings&gt;
-				&lt;/configuration&gt;
-			&lt;/plugin&gt;
-			&lt;plugin&gt;
-				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
 				&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
-				&lt;configuration&gt;
-					&lt;descriptor&gt;
-						src/resources/release/default.xml
-					&lt;/descriptor&gt;
-				&lt;/configuration&gt;
 			&lt;/plugin&gt;
 		&lt;/plugins&gt;
 	&lt;/build&gt;

Modified: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/accounting/SimpleAccountingProvider.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/accounting/SimpleAccountingProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/accounting/SimpleAccountingProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -3,13 +3,15 @@
 import java.net.InetSocketAddress;
 import java.text.SimpleDateFormat;
 import java.util.Date;
-import java.util.List;
+import java.util.Observable;
+import java.util.Observer;
 
-import org.apache.log4j.Logger;
+import org.apache.commons.configuration.Configuration;
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
-import rtspproxy.config.AAAConfigurable;
+import rtspproxy.config.StringParameter;
 import rtspproxy.filter.authentication.AuthenticationFilter;
 import rtspproxy.rtsp.RtspMessage;
 import rtspproxy.rtsp.RtspRequest;
@@ -18,26 +20,58 @@
  * @author Matteo Merli
  */
 public class SimpleAccountingProvider extends AccountingProviderAdapter implements
-        AccountingProvider, AAAConfigurable
+        Observer
 {
 
-    private static SimpleDateFormat format = new SimpleDateFormat(
+    private static final SimpleDateFormat format = new SimpleDateFormat(
             &quot;yyyy-MM-dd HH:mm:ss Z&quot; );
 
+    private static Logger log = LoggerFactory.getLogger( SimpleAccountingProvider.class );
+
     // This is not static since it's a separate log
-    private Logger accessLog;
+    private Logger accessLog = null;
 
+    private final StringParameter loggerCatergory;
+
     public SimpleAccountingProvider()
     {
-        accessLog = Logger.getLogger( &quot;accessLog&quot; );
+        loggerCatergory = new StringParameter( &quot;filters.accounting.category&quot;, // name
+                &quot;accessLog&quot;, // default value
+                true, // mutable
+                &quot;Log4j category name for the accounting log.&quot; );
+        
+        loggerCatergory.addObserver( this );
     }
 
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#start()
+     */
+    public void start() throws Exception
+    {
+        accessLog = LoggerFactory.getLogger( loggerCatergory.getValue() );
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#stop()
+     */
+    public void stop()
+    {
+        accessLog = null;
+    }
+
     @Override
     public void messageReceived( IoSession session, RtspMessage message )
     {
+        if ( accessLog == null )
+            return;
+
         StringBuilder logMessage = new StringBuilder();
         if ( message instanceof RtspRequest ) {
-            logMessage.append( ((RtspRequest) message).getVerb() ).append( &quot; &quot; );
+            logMessage.append( ((RtspRequest) message).getVerb() ).append( ' ' );
             logMessage.append( ((RtspRequest) message).getUrl() );
         }
         accessLog.info( buildLogMessage( session, message, logMessage ) );
@@ -46,6 +80,9 @@
     @Override
     public void messageSent( IoSession session, RtspMessage message )
     {
+        if ( accessLog == null )
+            return;
+
         StringBuilder logMessage = new StringBuilder();
         accessLog.info( buildLogMessage( session, message, logMessage ) );
     }
@@ -54,7 +91,7 @@
             StringBuilder logMessage )
     {
         StringBuilder sb = new StringBuilder( 150 );
-        String userName = (String) session.getAttribute( AuthenticationFilter.ATTR );
+        String userName = (String) session.getAttribute( AuthenticationFilter.getAttrName() );
         String userAgent = message.getHeader( &quot;User-Agent&quot; );
         Date now = new Date();
         String dateString = format.format( now );
@@ -72,17 +109,31 @@
         return sb.toString();
     }
 
-    public void configure( List&lt;Element&gt; configElements ) throws Exception
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#configure(org.apache.commons.configuration.Configuration)
+     */
+    public void configure( Configuration configuration ) throws Exception
     {
-        for ( Element el : configElements ) {
-            if ( el.getName().equals( &quot;category&quot; ) ) {
-                String category = el.getTextTrim();
+        loggerCatergory.readConfiguration( configuration );
+    }
 
-                if ( category == null || category.length() == 0 )
-                    throw new IllegalArgumentException( &quot;invalid log category given&quot; );
-
-                accessLog = Logger.getLogger( category );
-            }
+    /*
+     * (non-Javadoc)
+     * 
+     * @see java.util.Observer#update(java.util.Observable, java.lang.Object)
+     */
+    public void update( Observable o, Object arg )
+    {
+        if ( o != loggerCatergory )
+            return;
+        
+        try {
+            stop();
+            start();
+        } catch ( Exception e ) {
+            log.error( &quot;Error restarting SimpleAccountingProvider&quot; );
         }
     }
 }

Modified: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/authentication/SimpleAuthenticationProvider.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/authentication/SimpleAuthenticationProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/authentication/SimpleAuthenticationProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -18,70 +18,97 @@
 
 package rtspproxy.filter.authentication;
 
-import java.util.List;
+import java.io.FileInputStream;
+import java.io.InputStream;
+import java.util.Observable;
+import java.util.Observer;
 import java.util.Properties;
 
-import org.apache.log4j.Logger;
-import org.dom4j.Element;
+import org.apache.commons.configuration.Configuration;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
-import rtspproxy.config.AAAConfigurable;
-import rtspproxy.filter.GenericProviderAdapter;
+import rtspproxy.config.StringParameter;
 import rtspproxy.filter.authentication.scheme.Credentials;
 
 /**
  * @author Matteo Merli
  */
-public class SimpleAuthenticationProvider extends GenericProviderAdapter
-		implements AuthenticationProvider, AAAConfigurable {
+public class SimpleAuthenticationProvider implements AuthenticationProvider, Observer
+{
 
-	private static Logger log = Logger
-			.getLogger(SimpleAuthenticationProvider.class);
+    private static Logger log = LoggerFactory
+            .getLogger( SimpleAuthenticationProvider.class );
 
-	private Properties usersDb = new Properties();
+    private final StringParameter usersDbParameter;
 
-	public String getPassword(String username) {
-		return usersDb.getProperty(username);
-	}
+    private final Properties usersDb = new Properties();
 
-	public boolean isAuthenticated(Credentials credentials) {
-		String storedPassword = usersDb.getProperty(credentials.getUserName());
-		if (storedPassword == null)
-			// User is not present
-			return false;
+    public SimpleAuthenticationProvider()
+    {
+        usersDbParameter = new StringParameter( &quot;filters.authentication.usersFile&quot;, // name
+                &quot;conf/user.properties&quot;, // default value
+                true, // mutable
+                &quot;&quot; );
 
-		if (storedPassword.compareTo(credentials.getPassword()) == 0)
-			// Password is ok
-			return true;
-		else
-			// Password is wrong
-			return false;
-	}
+        usersDbParameter.addObserver( this );
+    }
 
-	public void configure(List&lt;Element&gt; configElements) throws Exception {
-		for (Element el : configElements) {
-			if (el.getName().equals(&quot;user&quot;)) {
-				Element nameEl = el.element(&quot;name&quot;);
-				Element passwordEl = el.element(&quot;password&quot;);
+    public void start() throws Exception
+    {
+        // Read user database
+        try {
+            String fileName = usersDbParameter.getValue();
+            InputStream is = new FileInputStream( fileName );
+            usersDb.load( is );
 
-				if (nameEl == null)
-					throw new IllegalArgumentException(
-							&quot;no name element available in user configuration&quot;);
-				if (passwordEl == null)
-					throw new IllegalArgumentException(
-							&quot;no password element available in user configuration&quot;);
+        } catch ( Exception e ) {
+            log.error( &quot;Error reading users DB: &quot; + e );
+        }
+    }
 
-				String name = nameEl.getTextTrim();
-				String password = passwordEl.getTextTrim();
+    public void stop()
+    {
+        usersDb.clear();
+    }
 
-				if (name == null || name.length() == 0)
-					throw new IllegalArgumentException(&quot;invalid username given&quot;);
-				if (password == null || password.length() == 0)
-					throw new IllegalArgumentException(&quot;invalid password given&quot;);
+    public String getPassword( String username )
+    {
+        return usersDb.getProperty( username );
+    }
 
-				log.debug(&quot;adding user &quot; + name + &quot; with password &quot; + password);
-				this.usersDb.put(name, password);
-			}
-		}
-	}
+    public boolean isAuthenticated( Credentials credentials )
+    {
+        String storedPassword = usersDb.getProperty( credentials.getUserName() );
+        if ( storedPassword == null )
+            // User is not present
+            return false;
 
+        if ( storedPassword.compareTo( credentials.getPassword() ) == 0 )
+            // Password is ok
+            return true;
+
+        // Password is wrong
+        return false;
+    }
+
+    public void configure( Configuration configuration )
+    {
+        usersDbParameter.readConfiguration( configuration );
+    }
+
+    public void update( Observable o, Object arg )
+    {
+        if ( o != usersDbParameter ) {
+            log.debug( &quot;Received notification of wrong object: {}&quot;, o );
+            return;
+        }
+
+        try {
+            stop();
+            start();
+        } catch ( Exception e ) {
+            log.error( &quot;Error restarting Authentication provider&quot; );
+        }
+    }
 }

Added: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/IpAddressPattern.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/IpAddressPattern.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/IpAddressPattern.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -0,0 +1,120 @@
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   Copyright (C) 2006 - Matteo Merli - <A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">matteo.merli at gmail.com</A>            *
+ *                                                                         *
+ ***************************************************************************/
+
+/*
+ * $Id$
+ * 
+ * $URL$
+ * 
+ */
+package rtspproxy.filter.ipaddress;
+
+import java.util.regex.Pattern;
+
+import org.apache.commons.configuration.Configuration;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import rtspproxy.config.ListElementParameter;
+
+/**
+ * @author Matteo Merli
+ * 
+ */
+public class IpAddressPattern implements ListElementParameter
+{
+
+    private static Logger log = LoggerFactory.getLogger( IpAddressPattern.class );
+
+    public enum Type {
+        Allow, Deny
+    }
+
+    private Type type;
+
+    private Pattern pattern;
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.config.ListElementParameter#readConfiguration(org.apache.commons.configuration.Configuration,
+     *      java.lang.String)
+     */
+    public boolean readConfiguration( Configuration configuration, String prefix )
+    {
+        String tmpType = configuration.getString( prefix + &quot;[@type]&quot; );
+        if ( tmpType == null )
+            return false;
+
+        if ( tmpType.equalsIgnoreCase( &quot;allow&quot; ) )
+            type = Type.Allow;
+        else if ( tmpType.equalsIgnoreCase( &quot;deny&quot; ) )
+            type = Type.Deny;
+        else
+            throw new IllegalArgumentException( &quot;Invalid rule type: &quot; + tmpType + &quot;)&quot; );
+
+        String tmpPattern = configuration.getString( prefix + &quot;[@pattern]&quot; );
+        if ( tmpPattern == null )
+            throw new IllegalArgumentException( &quot;Missing pattern.&quot; );
+
+        log.debug( &quot;Rule: {} {}&quot;, type, tmpPattern );
+
+        // Transform the patterns escaping &quot;.&quot; and &quot;*&quot; characters
+        tmpPattern = tmpPattern.replaceAll( &quot;\\.&quot;, &quot;\\\\.&quot; );
+        tmpPattern = tmpPattern.replaceAll( &quot;\\*&quot;, &quot;.*&quot; );
+        pattern = Pattern.compile( tmpPattern );
+        return true;
+    }
+
+    /**
+     * @return the pattern
+     */
+    public Pattern getPattern()
+    {
+        return pattern;
+    }
+
+    /**
+     * @param pattern
+     *            the pattern to set
+     */
+    public void setPattern( Pattern pattern )
+    {
+        this.pattern = pattern;
+    }
+
+    /**
+     * @return the type
+     */
+    public Type getType()
+    {
+        return type;
+    }
+
+    /**
+     * @param type
+     *            the type to set
+     */
+    public void setType( Type type )
+    {
+        this.type = type;
+    }
+
+    @Override
+    public String toString()
+    {
+        final StringBuilder sb = new StringBuilder();
+        sb.append( &quot;IpAddressPattern( &quot; ).append( type );
+        sb.append( ' ' ).append( pattern ).append( &quot;  )&quot; );
+        return sb.toString();
+    }
+
+}


Property changes on: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/IpAddressPattern.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/SimpleIpAddressProvider.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/SimpleIpAddressProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/ipaddress/SimpleIpAddressProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -18,162 +18,124 @@
 
 package rtspproxy.filter.ipaddress;
 
-import java.io.BufferedReader;
-import java.io.IOException;
-import java.io.Reader;
 import java.net.InetAddress;
 import java.util.LinkedList;
 import java.util.List;
-import java.util.regex.Pattern;
 
-import org.apache.log4j.Logger;
-import org.dom4j.Element;
+import org.apache.commons.configuration.Configuration;
 
-import rtspproxy.config.AAAConfigurable;
-import rtspproxy.filter.GenericProviderAdapter;
+import rtspproxy.config.ListParameter;
+import rtspproxy.filter.ipaddress.IpAddressPattern.Type;
+import rtspproxy.lib.Side;
 
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
 /**
- * Implementation of the IpAddressFilter that is based on a list of XML config elements
- * which contain instruction on &quot;allowed&quot; and &quot;denied&quot; addresses and hosts.
+ * Implementation of the IpAddressFilter that is based on a list of XML config
+ * elements which contain instruction on &quot;allowed&quot; and &quot;denied&quot; addresses and
+ * hosts.
  * 
  * @author Matteo Merli
  */
-public class SimpleIpAddressProvider extends GenericProviderAdapter implements
-		IpAddressProvider, AAAConfigurable {
+public class SimpleIpAddressProvider implements IpAddressProvider
+{
 
-	private static Logger log = Logger.getLogger( SimpleIpAddressProvider.class );
+    private static Logger log = LoggerFactory.getLogger( SimpleIpAddressProvider.class );
 
-	private enum RuleType {
-		Allow, Deny
-	};
+    private List&lt;IpAddressPattern&gt; rules = new LinkedList&lt;IpAddressPattern&gt;();
 
-	private static class Rule
-	{
+    private Side side = Side.Client;
 
-		public RuleType type;
+    private final ListParameter&lt;IpAddressPattern&gt; clientRules = new ListParameter&lt;IpAddressPattern&gt;(
+            &quot;filters.ipaddress.client-rules.rule&quot;, // name
+            false, // mutable
+            IpAddressPattern.class, // parameter class
+            &quot;Client-side IP address filter rules.&quot; );
 
-		public Pattern pattern;
-	}
+    private final ListParameter&lt;IpAddressPattern&gt; serverRules = new ListParameter&lt;IpAddressPattern&gt;(
+            &quot;filters.ipaddress.server-rules.rule&quot;, // name
+            false, // mutable
+            IpAddressPattern.class, // parameter class
+            &quot;Server-side IP address filter rules.&quot; );
 
-	private List&lt;Rule&gt; rules = new LinkedList&lt;Rule&gt;();
+    public void setSide( Side side )
+    {
+        this.side = side;
+    }
 
-	/*
-	 * (non-Javadoc)
-	 * 
-	 * @see rtspproxy.auth.IpAddressProvider#shutdown()
-	 */
-	@Override
-	public void shutdown()
-	{
-		rules.clear();
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#start()
+     */
+    public void start() throws Exception
+    {
+        switch ( side )
+        {
+        case Client:
+            rules.addAll( clientRules.getElementsList() );
+            break;
 
-	/*
-	 * (non-Javadoc)
-	 * 
-	 * @see rtspproxy.auth.IpAddressProvider#isBlocked(java.net.InetAddress)
-	 */
-	public boolean isBlocked( InetAddress address )
-	{
-		boolean blocked = true; // by default the address is blocked
-		String[] hostip = address.toString().split( &quot;/&quot; );
-		String host = hostip[0];
-		String ip = hostip[1];
+        case Server:
+            rules.addAll( serverRules.getElementsList() );
+            break;
+            
+        default:
+            break;
+        }
+    }
 
-		for ( Rule rule : rules ) {
-			if ( blocked &amp;&amp; rule.type == RuleType.Deny )
-				// Don't need to check, up to now this IP is already
-				// blocked
-				continue;
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#stop()
+     */
+    public void stop()
+    {
+        rules.clear();
+    }
 
-			if ( rule.pattern.matcher( ip ).matches()
-					|| rule.pattern.matcher( host ).matches() )
-				// the address matches the pattern
-				// check if it's allow or deny
-				blocked = (rule.type == RuleType.Allow) ? false : true;
-		}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.auth.IpAddressProvider#isBlocked(java.net.InetAddress)
+     */
+    public boolean isBlocked( InetAddress address )
+    {
+        boolean blocked = true; // by default the address is blocked
+        String[] hostip = address.toString().split( &quot;/&quot; );
+        String host = hostip[0];
+        String ip = hostip[1];
 
-		return blocked;
-	}
+        for ( IpAddressPattern rule : rules ) {
+            if ( blocked &amp;&amp; rule.getType() == Type.Deny )
+                // Don't need to check, up to now this IP is already
+                // blocked
+                continue;
 
-	/**
-	 * Reads the rules from a file
-	 * 
-	 * @param reader
-	 *            Reader of a file containing the access rules
-	 * @throws IOException
-	 */
-	protected void loadRules( Reader reader ) throws IOException
-	{
-		BufferedReader in = new BufferedReader( reader );
+            if ( rule.getPattern().matcher( ip ).matches()
+                    || rule.getPattern().matcher( host ).matches() )
+                // the address matches the pattern
+                // check if it's allow or deny
+                blocked = (rule.getType() == Type.Allow) ? false : true;
+       }
 
-		String line;
-		int lineNumber = 0;
-		try {
-			while ( (line = in.readLine()) != null ) {
-				line = line.replaceAll( &quot;\t&quot;, &quot; &quot; ); // replace tabs
-				line = line.trim();
-				++lineNumber;
+        return blocked;
+    }
 
-				if ( line.length() == 0 )
-					continue; // Ignore empty lines
-				if ( line.startsWith( &quot;#&quot; ) )
-					continue; // Ignore comments
-				RuleType ruleType = null;
-				if ( line.startsWith( &quot;Allow&quot; ) )
-					ruleType = RuleType.Allow;
-				else if ( line.startsWith( &quot;Deny&quot; ) )
-					ruleType = RuleType.Deny;
-				else
-					throw new IOException( &quot;Invalid filter pattern (line &quot; + lineNumber
-							+ &quot;)&quot; );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#configure(org.apache.commons.configuration.Configuration)
+     */
+    public void configure( Configuration configuration ) throws Exception
+    {
+        clientRules.readConfiguration( configuration );
+        serverRules.readConfiguration( configuration );
 
-				// read the pattern
-				String[] patternSplit = line.split( &quot; &quot;, 2 );
-				if ( patternSplit.length != 2 )
-					throw new IOException( &quot;Invalid filter pattern (line &quot; + lineNumber
-							+ &quot;)&quot; );
-				String pattern = patternSplit[1];
-				log.debug( &quot;Rule: &quot; + ruleType + &quot; &quot; + pattern );
+	log.debug( &quot;clientRules: {}&quot;, clientRules.getElementsList() );
+	log.debug( &quot;serverRules: {}&quot;, serverRules.getElementsList() );
+    }
 
-				// Transform the patterns escaping &quot;.&quot; and &quot;*&quot; characters
-				pattern = pattern.replaceAll( &quot;\\.&quot;, &quot;\\\\.&quot; );
-				pattern = pattern.replaceAll( &quot;\\*&quot;, &quot;.*&quot; );
-
-				Rule rule = new Rule();
-				rule.type = ruleType;
-				rule.pattern = Pattern.compile( pattern );
-				rules.add( rule );
-			}
-		} catch ( IOException e ) {
-			log.error( &quot;Error reading IpAddressFilter rules: &quot; + e );
-			throw e;
-		}
-	}
-
-	public void configure(List&lt;Element&gt; configElements) throws Exception {
-		for(Element el : configElements) {
-			RuleType ruleType = null;
-			
-			if ( el.getName().equals( &quot;allow&quot; ) )
-				ruleType = RuleType.Allow;
-			else if ( el.getName().equals( &quot;deny&quot; ) )
-				ruleType = RuleType.Deny;
-			else
-				throw new IllegalArgumentException( &quot;Invalid filter pattern (element &quot; + el	+ &quot;)&quot; );
-			
-			String pattern = el.getTextTrim();
-			log.debug( &quot;Rule: &quot; + ruleType + &quot; &quot; + pattern );
-
-			// Transform the patterns escaping &quot;.&quot; and &quot;*&quot; characters
-			pattern = pattern.replaceAll( &quot;\\.&quot;, &quot;\\\\.&quot; );
-			pattern = pattern.replaceAll( &quot;\\*&quot;, &quot;.*&quot; );
-
-			Rule rule = new Rule();
-			rule.type = ruleType;
-			rule.pattern = Pattern.compile( pattern );
-			rules.add( rule );
-			
-		}
-	}
 }

Added: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/RewriteMapping.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/RewriteMapping.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/RewriteMapping.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -0,0 +1,90 @@
+/***************************************************************************
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   Copyright (C) 2006 - Matteo Merli - <A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">matteo.merli at gmail.com</A>            *
+ *                                                                         *
+ ***************************************************************************/
+
+/*
+ * $Id$
+ * 
+ * $URL$
+ * 
+ */
+package rtspproxy.filter.rewrite;
+
+import org.apache.commons.configuration.Configuration;
+
+import rtspproxy.config.ListElementParameter;
+
+/**
+ * @author Matteo Merli
+ */
+public class RewriteMapping implements ListElementParameter
+{
+
+    private String from = null;
+
+    private String to = null;
+
+    public boolean readConfiguration( Configuration configuration, String prefix )
+    {
+        String tmpFrom = configuration.getString( prefix + &quot;.from&quot; );
+        if ( tmpFrom == null )
+            // Value not found
+            return false;
+
+        from = tmpFrom;
+        to = configuration.getString( prefix + &quot;.to&quot; );
+
+        return true;
+    }
+
+    /**
+     * @return the from
+     */
+    public String getFrom()
+    {
+        return from;
+    }
+
+    /**
+     * @param from
+     *            the from to set
+     */
+    public void setFrom( String from )
+    {
+        this.from = from;
+    }
+
+    /**
+     * @return the to
+     */
+    public String getTo()
+    {
+        return to;
+    }
+
+    /**
+     * @param to
+     *            the to to set
+     */
+    public void setTo( String to )
+    {
+        this.to = to;
+    }
+
+    @Override
+    public String toString()
+    {
+        final StringBuilder sb = new StringBuilder();
+        sb.append( &quot;Mapping(from='&quot; ).append( from );
+        sb.append( &quot;' to='&quot; ).append( to ).append( &quot;')&quot; );
+        return sb.toString();
+    }
+
+}


Property changes on: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/RewriteMapping.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/SimpleUrlRewritingProvider.java
===================================================================
--- trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/SimpleUrlRewritingProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/SimpleUrlRewritingProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -3,156 +3,167 @@
  */
 package rtspproxy.filter.rewrite;
 
-import org.apache.log4j.Logger;
-
 import java.net.MalformedURLException;
 import java.net.SocketAddress;
 import java.net.URL;
 import java.util.HashMap;
-import java.util.List;
 import java.util.Map;
 
-import org.dom4j.Element;
+import org.apache.commons.configuration.Configuration;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
-import rtspproxy.config.AAAConfigurable;
-import rtspproxy.filter.GenericProviderAdapter;
+import rtspproxy.config.ListParameter;
 import rtspproxy.rtsp.RtspRequest;
-import rtspproxy.rtsp.RtspRequest.Verb;
 
 /**
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
+ * 
  */
-public class SimpleUrlRewritingProvider extends GenericProviderAdapter
-		implements UrlRewritingProvider, AAAConfigurable {
-	
-	/**
-	 * Logger for this class
-	 */
-	private static final Logger logger = Logger
-			.getLogger(SimpleUrlRewritingProvider.class);
+public class SimpleUrlRewritingProvider implements UrlRewritingProvider
+{
 
-	// map with url from--&gt;to prefix mapping (used in rewriting request URL)
-	private HashMap&lt;String, String&gt; forwardMappings = new HashMap&lt;String, String&gt;();
-	
-	// map with url from--&gt;to prefix mapping (used in rewriting request URL)
-	private HashMap&lt;URL, URL&gt; optionsForwardMappings = new HashMap&lt;URL, URL&gt;();
-	
-	// map with url to--&gt;from prefix mapping (used in rewriting response URL)
-	private HashMap&lt;String, String&gt; reverseMappings = new HashMap&lt;String, String&gt;();
-	
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.rewrite.UrlRewritingProvider#rewriteRequestUrl(java.net.URL)
-	 */
-	public UrlRewritingResult rewriteRequestUrl(URL request, RtspRequest.Verb verb, SocketAddress client,
-			Map&lt;String, String&gt; requestHeaders, Map&lt;String, Object&gt; exposedSessionAttributes) {
-		UrlRewritingResult result = null;
-		URL rewritten = null;
-		String req = request.toString();
-		
-		logger.debug(&quot;checking request URL: &quot; + req + &quot;, verb=&quot; + verb);
-		
-		if(verb == RtspRequest.Verb.OPTIONS) {
-			logger.debug(&quot;handling OPTIONS request&quot;);
-			
-			if((rewritten = this.optionsForwardMappings.get(request)) != null) {
-				logger.debug(&quot;found special OPTIONS rewrite URL: &quot; + rewritten);
-				
-				return new UrlRewritingResult(rewritten);
-			}
-		}
-		for(String prefix : this.forwardMappings.keySet()) {
-			if(req.startsWith(prefix)) {
-				logger.debug(&quot;found prefix match on &quot; + prefix);
-				try {
-					rewritten = new URL(this.forwardMappings.get(prefix) 
-							+ req.substring(prefix.length()));
-				} catch(MalformedURLException mue) {
-					logger.error(&quot;request prefix rewriting caused invalid URL&quot;, mue);
-				}
-			}
-		}
-		logger.debug(&quot;rewritten URL: &quot; + rewritten);
-		
-		if(rewritten != null)
-			result = new UrlRewritingResult(rewritten);
-		
-		return result;
-	}
+    private static final Logger log = LoggerFactory
+            .getLogger( SimpleUrlRewritingProvider.class );
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.rewrite.UrlRewritingProvider#rewriteResponseHeaderUrl(java.net.URL)
-	 */
-	public URL rewriteResponseHeaderUrl(URL response) {
-		URL rewritten = null;
-		String resp = response.toString();
-		
-		logger.debug(&quot;checking response URL: &quot; + resp);
-		for(String prefix : this.reverseMappings.keySet()) {
-			if(resp.startsWith(prefix)) {
-				logger.debug(&quot;found prefix match on &quot; + prefix);
-				try {
-					rewritten = new URL(this.reverseMappings.get(prefix) 
-							+ resp.substring(prefix.length()));
-				} catch(MalformedURLException mue) {
-					logger.error(&quot;response prefix rewriting caused invalid URL&quot;, mue);
-				}
-			}
-		}
-		logger.debug(&quot;rewritten URL: &quot; + rewritten);
-		
-		return rewritten;
-	}
+    /** map with url from--&gt;to prefix mapping (used in rewriting request URL) */
+    private Map&lt;String, String&gt; forwardMappings = new HashMap&lt;String, String&gt;();
 
-	public void configure(List&lt;Element&gt; configElements) throws Exception {
-		for(Element el : configElements) {
-			if(el.getName().equals(&quot;mapping&quot;)) {
-				Element fromEl = el.element(&quot;from&quot;);
-				Element toEl = el.element(&quot;to&quot;);
-				
-				if(fromEl == null || toEl == null)
-					throw new IllegalArgumentException(&quot;no from or to element in mapping configuration&quot;);
-				
-				String from = fromEl.getTextTrim();
-				String to = toEl.getTextTrim();
-				
-				if(from == null || from.length() == 0 || to == null || to.length() == 0)
-					throw new IllegalArgumentException(&quot;invalid from or to element in mapping configuration&quot;);
-				
-				if(from.endsWith(&quot;/&quot;))
-					from = from.substring(0, from.length()-1);
-				if(to.endsWith(&quot;/&quot;))
-					to = to.substring(0, to.length()-1);
+    // /** map with url from--&gt;to prefix mapping (used in rewriting request URL)
+    // */
+    // private Map&lt;URL, URL&gt; optionsForwardMappings = new HashMap&lt;URL, URL&gt;();
 
-				this.forwardMappings.put(from, to);
-				this.reverseMappings.put(to, from);
-			} else if(el.getName().equals(&quot;map-options&quot;)) {
-				Element fromEl = el.element(&quot;from&quot;);
-				Element toEl = el.element(&quot;to&quot;);
-				
-				if(fromEl == null || toEl == null)
-					throw new IllegalArgumentException(&quot;no from or to element in mapping configuration&quot;);
-				
-				String from = fromEl.getTextTrim();
-				String to = toEl.getTextTrim();
-				
-				if(from == null || from.length() == 0 || to == null || to.length() == 0)
-					throw new IllegalArgumentException(&quot;invalid from or to element in mapping configuration&quot;);
-				
-				URL fromUrl = new URL(from);
-				URL toUrl = new URL(to);
-				
-				this.optionsForwardMappings.put(new URL(fromUrl.getProtocol(), fromUrl.getHost(), 
-						fromUrl.getPort(), &quot;/&quot;),
-						new URL(toUrl.getProtocol(), toUrl.getHost(), 
-								toUrl.getPort(), &quot;/&quot;));
-			}
-		}
-	}
+    /** map with url to--&gt;from prefix mapping (used in rewriting response URL) */
+    private Map&lt;String, String&gt; reverseMappings = new HashMap&lt;String, String&gt;();
 
-	public String[] getWantedSessionAttributes() {
-		// no attributes wanted
-		return null;
-	}
+    private final ListParameter&lt;RewriteMapping&gt; rewriteRules;
 
+    public SimpleUrlRewritingProvider()
+    {
+        rewriteRules = new ListParameter&lt;RewriteMapping&gt;(
+                &quot;filters.rewrite.rules.mapping&quot;, // name
+                false, // mutable
+                RewriteMapping.class, // parameter class
+                &quot;Rewriting rules&quot; );
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.rewrite.UrlRewritingProvider#rewriteRequestUrl(java.net.URL)
+     */
+    public UrlRewritingResult rewriteRequestUrl( URL request, RtspRequest.Verb verb,
+            SocketAddress client, Map&lt;String, String&gt; requestHeaders,
+            Map&lt;String, Object&gt; exposedSessionAttributes )
+    {
+        UrlRewritingResult result = null;
+        URL rewritten = null;
+        String req = request.toString();
+
+        log.debug( &quot;checking request URL: {}, verb={}&quot;, req, verb );
+
+        // TODO: OPTIONS mapping
+        /*
+         * if ( verb == RtspRequest.Verb.OPTIONS ) { log.debug( &quot;handling
+         * OPTIONS request&quot; );
+         * 
+         * if ( (rewritten = this.optionsForwardMappings.get( request )) != null ) {
+         * log.debug( &quot;found special OPTIONS rewrite URL: {}&quot;, rewritten );
+         * 
+         * return new UrlRewritingResult( rewritten ); } }
+         */
+        for ( String prefix : forwardMappings.keySet() ) {
+            if ( req.startsWith( prefix ) ) {
+                log.debug( &quot;found prefix match on {}&quot;, prefix );
+                try {
+                    rewritten = new URL( forwardMappings.get( prefix )
+                            + req.substring( prefix.length() ) );
+
+                } catch ( MalformedURLException mue ) {
+                    log.error( &quot;request prefix rewriting caused invalid URL&quot;, mue );
+                }
+            }
+        }
+        log.debug( &quot;rewritten URL: {}&quot;, rewritten );
+
+        if ( rewritten != null )
+            result = new UrlRewritingResult( rewritten );
+
+        return result;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#start()
+     */
+    public void start() throws Exception
+    {
+        for ( RewriteMapping rewriteMap : rewriteRules.getElementsList() ) {
+            forwardMappings.put( rewriteMap.getFrom(), rewriteMap.getTo() );
+            reverseMappings.put( rewriteMap.getTo(), rewriteMap.getFrom() );
+        }
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#stop()
+     */
+    public void stop()
+    {
+        forwardMappings.clear();
+        reverseMappings.clear();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.rewrite.UrlRewritingProvider#rewriteResponseHeaderUrl(java.net.URL)
+     */
+    public URL rewriteResponseHeaderUrl( URL response )
+    {
+        URL rewritten = null;
+        String resp = response.toString();
+
+        log.debug( &quot;checking response URL: {}&quot;, resp );
+
+        for ( String prefix : reverseMappings.keySet() ) {
+            if ( resp.startsWith( prefix ) ) {
+                log.debug( &quot;found prefix match on {}&quot;, prefix );
+                String url = reverseMappings.get( prefix )
+                        + resp.substring( prefix.length() );
+                try {
+                    rewritten = new URL( url );
+                } catch ( MalformedURLException mue ) {
+                    log.error( &quot;response prefix rewriting caused invalid URL: {}&quot;, url );
+                }
+            }
+        }
+
+        log.info( &quot;rewritten URL: {}&quot;, rewritten );
+        return rewritten;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#configure(org.apache.commons.configuration.Configuration)
+     */
+    public void configure( Configuration configuration ) throws Exception
+    {
+        rewriteRules.readConfiguration( configuration );
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.rewrite.UrlRewritingProvider#getWantedSessionAttributes()
+     */
+    public String[] getWantedSessionAttributes()
+    {
+        // no attributes wanted
+        return null;
+    }
+
 }


Property changes on: trunk/RTSPProxy-App/src/main/java/rtspproxy/filter/rewrite/SimpleUrlRewritingProvider.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-App/src/resources/conf/rtspproxy.conf.xml
===================================================================
--- trunk/RTSPProxy-App/src/resources/conf/rtspproxy.conf.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/resources/conf/rtspproxy.conf.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,3 +1,4 @@
+
 &lt;!-- $Id$ --&gt;
 
 &lt;rtspproxy&gt;
@@ -2,2 +3,5 @@
 
+	&lt;!-- Enable or disable debug output. 
+	     A more fine-grained configuration can be done in the log4j 
+	     properties file. --&gt;
 	&lt;debug&gt;true&lt;/debug&gt;
@@ -14,10 +18,24 @@
 
 		&lt;!-- Server-side configuration --&gt;
 		&lt;server&gt;
+	
+			&lt;!-- If specified, bound the proxy on a specifed network
+                             interface. --&gt;
+                        &lt;!-- &lt;address&gt;127.0.0.1&lt;/address&gt; --&gt;
+
+                        &lt;!-- Same as for the address, but specifying the
+                             network interface name. On Linux they are called 'eth0', 'eth1'...
+                             On  MacOS X they are 'en0', 'en1', .. --&gt;
+                        &lt;!-- &lt;interface&gt;eth0&lt;/interface&gt; --&gt;
+		
+			&lt;!-- RTP port used with servers --&gt;
 			&lt;!-- &lt;rtpPort&gt;6970&lt;/rtpPort&gt; --&gt;
+
+			&lt;!-- RTCP port used with servers --&gt;
 			&lt;!-- &lt;rtcpPort&gt;6971&lt;/rtcpPort&gt; --&gt;
+
+			&lt;!-- RDT port used with servers --&gt;
 			&lt;!-- &lt;rdtPort&gt;6972&lt;/rdtPort&gt; --&gt;
-			&lt;!-- &lt;address&gt;10.0.0.24&lt;/address&gt; --&gt;
 
 			&lt;!-- 
 				&lt;rtpUsePortrange&gt;false&lt;/rtpUsePortrange&gt;
@@ -32,15 +50,25 @@
 			--&gt;
 		&lt;/server&gt;
 
+		&lt;!-- Client-side configuration --&gt;
+		&lt;client&gt;
+			&lt;!-- If specified, bound the proxy on a specifed network 
+			     interface. --&gt;
+			&lt;address&gt;127.0.0.1&lt;/address&gt;
 
-		&lt;client&gt;
-			&lt;!-- 
-				&lt;rtpPort&gt;6970&lt;/rtpPort&gt;
-				&lt;rtcpPort&gt;6971&lt;/rtcpPort&gt;
-				&lt;rdtPort&gt;6972&lt;/rdtPort&gt;
-				&lt;address&gt;127.0.0.1&lt;/address&gt;
-			--&gt;
-			&lt;interface&gt;lo0&lt;/interface&gt;
+			&lt;!-- Same as for the address, but specifying the 
+			     network interface name. On Linux they are called 'eth0', 'eth1'...
+			     On  MacOS X they are 'en0', 'en1', .. --&gt;
+                        &lt;!-- &lt;interface&gt;eth0&lt;/interface&gt; --&gt;
+
+			&lt;!-- Rtp port used with clients --&gt;
+			&lt;!-- &lt;rtpPort&gt;6970&lt;/rtpPort&gt; --&gt;
+
+			&lt;!-- Rtcp port used with clients --&gt;
+			&lt;!-- &lt;rtcpPort&gt;6971&lt;/rtcpPort&gt; --&gt;
+
+			&lt;!-- Rdt port used with clients --&gt;
+			&lt;!-- &lt;rdtPort&gt;6972&lt;/rdtPort&gt; --&gt;
 		&lt;/client&gt;
 
 		&lt;!-- Proxy feature selection --&gt;
@@ -77,6 +105,8 @@
 		&lt;!-- JMX web console --&gt;
 		&lt;web&gt;
 			&lt;enable&gt;true&lt;/enable&gt;
+			
+			&lt;!-- HTTP port --&gt;
 			&lt;port&gt;8080&lt;/port&gt;
 		&lt;/web&gt;
 
@@ -87,16 +117,16 @@
 		&lt;/connectorService&gt;
 	&lt;/jmx&gt;
 
-	&lt;!-- Filters are the mean layered functionalities such as Authentication or 
+	&lt;!-- Filters are mean layered functionalities such as Authentication or 
 		Tracking are implemented.
 	--&gt;
 	&lt;filters&gt;
 
 		&lt;!-- Authentication filter --&gt;
 		&lt;authentication&gt;
+			&lt;!-- Enable or disable the authentication filter --&gt;
+			&lt;enable&gt;true&lt;/enable&gt;
 
-			&lt;enable&gt;false&lt;/enable&gt;
-
 			&lt;implClass&gt;
 				rtspproxy.filter.authentication.SimpleAuthenticationProvider
 			&lt;/implClass&gt;
@@ -106,38 +136,34 @@
 			--&gt;
 			&lt;scheme&gt;Digest&lt;/scheme&gt;
 
+			&lt;!-- The SimpleAuthenticationProvider uses a Property file 
+			     to keep a user db. In this file, keys are the usernames 
+			     and values are the passwords. --&gt;
 			&lt;usersFile&gt;conf/users.properties&lt;/usersFile&gt;
 		&lt;/authentication&gt;
 
 		&lt;!-- Filter clients using theyr IP address --&gt;
-		&lt;ipaddress
-			implClass=&quot;rtspproxy.filter.ipaddress.SimpleIpAddressProvider&quot;
-			side=&quot;client&quot;&gt;
-
+		&lt;ipaddress&gt;
+			
 			&lt;!-- Enable or disable the ipaddress filter --&gt;
-			&lt;enabled&gt;false&lt;/enabled&gt;
+                        &lt;enable&gt;true&lt;/enable&gt;
 
-			&lt;rules&gt;
-				&lt;rule type=&quot;deny&quot; pattern=&quot;*&quot; /&gt;
-				&lt;allow&gt;127.0.0.1&lt;/allow&gt;
-				&lt;allow&gt;10.0.0.*&lt;/allow&gt;
-				&lt;allow&gt;*.some.domain&lt;/allow&gt;
-			&lt;/rules&gt;
-		&lt;/ipaddress&gt;
+			&lt;implClass&gt;
+				rtspproxy.filter.ipaddress.SimpleIpAddressProvider
+			&lt;/implClass&gt;
 
-		&lt;ipaddress
-			implClass=&quot;rtspproxy.filter.ipaddress.SimpleIpAddressProvider&quot;
-			side=&quot;server&quot;&gt;
+			&lt;!-- Access rules for clients --&gt;
+			&lt;client-rules&gt;	
+				&lt;rule type=&quot;deny&quot;  pattern=&quot;*&quot; /&gt;
+				&lt;rule type=&quot;allow&quot; pattern=&quot;127.0.0.1&quot; /&gt;
+				&lt;rule type=&quot;allow&quot; pattern=&quot;10.0.0.*&quot; /&gt;
+				&lt;rule type=&quot;allow&quot; pattern=&quot;*.some.domain&quot; /&gt;
+			&lt;/client-rules&gt;
 
-			&lt;!-- Enable or disable the ipaddress filter --&gt;
-			&lt;enable&gt;false&lt;/enable&gt;
-
-			&lt;rules&gt;
-				&lt;deny&gt;*&lt;/deny&gt;
-				&lt;allow&gt;127.0.0.1&lt;/allow&gt;
-				&lt;allow&gt;10.0.0.*&lt;/allow&gt;
-				&lt;allow&gt;*.some.domain&lt;/allow&gt;
-			&lt;/rules&gt;
+			&lt;!-- Restrict access to certains RTSP servers  --&gt;
+			&lt;server-rules&gt;
+				&lt;rule type=&quot;deny&quot; pattern=&quot;*.bad.domain.com&quot; /&gt;
+			&lt;/server-rules&gt;
 		&lt;/ipaddress&gt;
 
 
@@ -146,6 +172,7 @@
 			&lt;!-- Enable or disable the ipaddress filter --&gt;
 			&lt;enable&gt;false&lt;/enable&gt;
 
+			&lt;!-- --&gt;
 			&lt;implClass&gt;
 				rtspproxy.filter.accounting.SimpleAccountingProvider
 			&lt;/implClass&gt;
@@ -154,7 +181,7 @@
 		&lt;/accounting&gt;
 
 
-		&lt;rewriting&gt;
+		&lt;rewrite&gt;
 
 			&lt;!-- enable or disable the rewriting filter --&gt;
 			&lt;enable&gt;false&lt;/enable&gt;
@@ -164,15 +191,35 @@
 				rtspproxy.filter.rewrite.SimpleUrlRewritingProvider
 			&lt;/implClass&gt;
 
-			&lt;!-- Rewriting rules --&gt;
+			&lt;!-- SimpleUrlRewritingProvider uses the following rules 
+		 	     to rewrite the URLs.	
+                          --&gt;
 			&lt;rules&gt;
-				&lt;mapping from=&quot;<A HREF="rtsp://10.0.0.1:554/">rtsp://10.0.0.1:554/</A>&quot;
-					       to=&quot;<A HREF="rtsp://10.0.0.2:1554/foo/">rtsp://10.0.0.2:1554/foo/</A>&quot; /&gt;
+				&lt;mapping&gt;
+					&lt;from&gt;<A HREF="rtsp://10.0.0.1:554/&lt;/from">rtsp://10.0.0.1:554/&lt;/from</A>&gt;
+					&lt;to&gt;<A HREF="rtsp://10.0.0.2:1554/foo/&lt;/to">rtsp://10.0.0.2:1554/foo/&lt;/to</A>&gt;
+				&lt;/mapping&gt;
+				&lt;mapping&gt;
+					&lt;from&gt;<A HREF="rtsp://127.0.0.1/&lt;/from">rtsp://127.0.0.1/&lt;/from</A>&gt;
+					&lt;to&gt;<A HREF="rtsp://10.0.0.26:1554/foo/&lt;/to">rtsp://10.0.0.26:1554/foo/&lt;/to</A>&gt;
+				&lt;/mapping&gt;
+			&lt;/rules&gt;
+		&lt;/rewrite&gt;
 
-				&lt;mapping from=&quot;<A HREF="rtsp://127.0.0.01/">rtsp://127.0.0.01/</A>&quot; 
-					 		   to=&quot;<A HREF="rtsp://10.0.0.26:1554/foo/">rtsp://10.0.0.26:1554/foo/</A>&quot; /&gt;
-			&lt;/rules&gt;
-		&lt;/rewriting&gt;
+		&lt;control&gt;
+			&lt;enable&gt;false&lt;/enable&gt;
+			
+			&lt;filters&gt;
+				&lt;filter side=&quot;Client&quot; 
+					name=&quot;testFilter&quot; 
+					implClass=&quot;path.to.Class&quot; /&gt;
+
+				&lt;filter side=&quot;Server&quot; 
+					name=&quot;testFilterServer&quot;
+					implClass=&quot;other.path.class&quot; /&gt;
+			&lt;/filters&gt;
+		&lt;/control&gt;
+
 	&lt;/filters&gt;
 
 &lt;/rtspproxy&gt;


Property changes on: trunk/RTSPProxy-App/src/resources/conf/rtspproxy.conf.xml
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-App/src/resources/conf/rtspproxy.log4j.xml
___________________________________________________________________
Name: svn:keywords
   - HeadURL Id LastChangedBy LastChangedDate LastChangedRevision
   + Id URL Rev

Modified: trunk/RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress/PlainTextIpAddressProviderTest.java
===================================================================
--- trunk/RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress/PlainTextIpAddressProviderTest.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress/PlainTextIpAddressProviderTest.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -17,9 +17,6 @@
  */
 package rtspproxy.filter.ipaddress;
 
-import java.io.StringReader;
-import java.net.InetAddress;
-
 import junit.framework.TestCase;
 
 /**
@@ -27,16 +24,13 @@
  */
 public class PlainTextIpAddressProviderTest extends TestCase
 {
+	// TODO: Rewrite this test using the xml based configuration
 
 	private static final String CRLF = &quot;\r\n&quot;;
 
-	public static void main( String[] args )
-	{
-		junit.textui.TestRunner.run( PlainTextIpAddressProviderTest.class );
-	}
-
 	public void test1() throws Exception
 	{
+	/*
 		// prepare
 		SimpleIpAddressProvider provider = new SimpleIpAddressProvider();
 		StringBuilder rules = new StringBuilder();
@@ -50,10 +44,12 @@
 
 		// close
 		provider.shutdown();
+	*/
 	}
 	
 	public void test2() throws Exception
 	{
+	/*
 		// prepare
 		SimpleIpAddressProvider provider = new SimpleIpAddressProvider();
 		StringBuilder rules = new StringBuilder();
@@ -67,6 +63,7 @@
 
 		// close
 		provider.shutdown();
+	*/
 	}
 
 }

Modified: trunk/RTSPProxy-Core/pom.xml
===================================================================
--- trunk/RTSPProxy-Core/pom.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/pom.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -11,92 +11,14 @@
 		&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
 		&lt;artifactId&gt;rtspproxy&lt;/artifactId&gt;
 		&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
+		&lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;
 	&lt;/parent&gt;
 
 	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
 
 	&lt;name&gt;RTSP Proxy core&lt;/name&gt;
-	&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
-	&lt;artifactId&gt;RTSPProxy-Core&lt;/artifactId&gt;
-	&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-	&lt;url&gt;<A HREF="http://rtspproxy.berlios.de&lt;/url">http://rtspproxy.berlios.de&lt;/url</A>&gt;
-	&lt;inceptionYear&gt;2003&lt;/inceptionYear&gt;
+	&lt;artifactId&gt;RTSPProxy-Core&lt;/artifactId&gt;	
 
-	&lt;dependencies&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.apache.directory.mina&lt;/groupId&gt;
-			&lt;artifactId&gt;mina-core&lt;/artifactId&gt;
-			&lt;version&gt;0.9.3&lt;/version&gt;
-		&lt;/dependency&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;mx4j&lt;/groupId&gt;
-			&lt;artifactId&gt;mx4j-tools&lt;/artifactId&gt;
-			&lt;version&gt;2.1.1&lt;/version&gt;
-		&lt;/dependency&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
-			&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
-			&lt;version&gt;1.0-rc3&lt;/version&gt;
-		&lt;/dependency&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;log4j&lt;/groupId&gt;
-			&lt;artifactId&gt;log4j&lt;/artifactId&gt;
-			&lt;version&gt;1.2.9&lt;/version&gt;
-		&lt;/dependency&gt;
- 
-		&lt;dependency&gt;
-			&lt;groupId&gt;commons-pool&lt;/groupId&gt;
-			&lt;artifactId&gt;commons-pool&lt;/artifactId&gt;
-			&lt;version&gt;1.2&lt;/version&gt;
-		&lt;/dependency&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;commons-configuration&lt;/groupId&gt;
-			&lt;artifactId&gt;commons-configuration&lt;/artifactId&gt;
-			&lt;version&gt;1.2&lt;/version&gt;
-		&lt;/dependency&gt;
-		
-		&lt;!-- Included here to disambiguate the version number --&gt;
-		&lt;dependency&gt;
-			&lt;groupId&gt;commons-collections&lt;/groupId&gt;
-			&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;
-			&lt;version&gt;3.1&lt;/version&gt;
-		&lt;/dependency&gt;
-
-		&lt;dependency&gt;
-			&lt;groupId&gt;junit&lt;/groupId&gt;
-			&lt;artifactId&gt;junit&lt;/artifactId&gt;
-			&lt;version&gt;3.8.1&lt;/version&gt;
-			&lt;scope&gt;test&lt;/scope&gt;
-		&lt;/dependency&gt;
-	&lt;/dependencies&gt;
-
-	&lt;repositories&gt;
-
-		&lt;repository&gt;
-			&lt;id&gt;Apache repository&lt;/id&gt;
-			&lt;url&gt;<A HREF="http://svn.apache.org/repository/&lt;/url">http://svn.apache.org/repository/&lt;/url</A>&gt;
-		&lt;/repository&gt;
-
-		&lt;!-- For snapshots (no release jars or non-apache jars)           --&gt;
-		&lt;repository&gt;
-			&lt;id&gt;apache.snapshots&lt;/id&gt;
-			&lt;name&gt;Apache Snapshot Repository&lt;/name&gt;
-			&lt;url&gt;<A HREF="http://cvs.apache.org/maven-snapshot-repository&lt;/url">http://cvs.apache.org/maven-snapshot-repository&lt;/url</A>&gt;
-		&lt;/repository&gt;
-
-		&lt;!--
-			&lt;repository&gt;
-			&lt;id&gt;ibilio maven2&lt;/id&gt;
-			&lt;url&gt;<A HREF="http://www.ibiblio.org/maven2/&lt;/url">http://www.ibiblio.org/maven2/&lt;/url</A>&gt;
-			&lt;/repository&gt;
-		--&gt;
-	&lt;/repositories&gt;
-
 	&lt;build&gt;
 		&lt;defaultGoal&gt;assembly:directory&lt;/defaultGoal&gt;
 
@@ -106,18 +28,6 @@
 				&lt;filtering&gt;true&lt;/filtering&gt;
 			&lt;/resource&gt;
 		&lt;/resources&gt;
-
-		&lt;plugins&gt;
-			&lt;plugin&gt;
-				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
-				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
-				&lt;configuration&gt;
-					&lt;source&gt;1.5&lt;/source&gt;
-					&lt;target&gt;1.5&lt;/target&gt;
-					&lt;showWarnings&gt;true&lt;/showWarnings&gt;
-				&lt;/configuration&gt;
-			&lt;/plugin&gt;
-		&lt;/plugins&gt;
 	&lt;/build&gt;
 
 &lt;/project&gt;


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Debug.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/GenericObject.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/GenericObjectList.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Host.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/HostNameParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/HostPort.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/InternalErrorHandler.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/LexerCore.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/LogWriter.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Match.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/NameValue.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/NameValueList.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/PackageNames.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/ParserCore.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Separators.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/StringTokenizer.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/core/Token.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/MediaDescriptionImpl.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/SdpEncoderImpl.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/SessionDescriptionImpl.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/TimeDescriptionImpl.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/AttributeField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/BandwidthField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ConnectionAddress.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ConnectionField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/Email.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/EmailAddress.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/EmailField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/Indentation.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/InformationField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/KeyField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/MediaField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/OriginField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/PhoneField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ProtoVersionField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/RepeatField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFieldList.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFieldNames.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPFormat.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPKeywords.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPObject.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SDPObjectList.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/SessionNameField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/TimeField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/TypedTime.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/URIField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ZoneAdjustment.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/fields/ZoneField.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/AttributeFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/BandwidthFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ConnectionFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/EmailFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/InformationFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/KeyFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/Lexer.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/MediaFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/OriginFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ParserFactory.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/PhoneFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ProtoVersionFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/RepeatFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SDPAnnounceParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SDPParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/SessionNameFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/TimeFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/URIFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/gov/nist/javax/sdp/parser/ZoneFieldParser.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/javax/sdp/SdpFactory.java
___________________________________________________________________
Name: svn:executable
   - *

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyService.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyService.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyService.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -142,6 +142,8 @@
             return;
         }
 
+        Reactor.getRegistry().unbind( this, false );
+
         log.info( getName() + &quot; Stopped&quot; );
         isRunning = false;
     }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyServiceRegistry.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyServiceRegistry.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/ProxyServiceRegistry.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -53,278 +53,291 @@
 public final class ProxyServiceRegistry extends Singleton implements Observer
 {
 
-	private static Logger log = LoggerFactory.getLogger( ProxyServiceRegistry.class );
+    private static Logger log = LoggerFactory.getLogger( ProxyServiceRegistry.class );
 
-	public static final String threadPoolFilterNAME = &quot;threadPoolFilter&quot;;
+    public static final String threadPoolFilterNAME = &quot;threadPoolFilter&quot;;
 
-	/** Thread pool instance that will be added to all acceptors. */
-	private final ThreadPoolFilter threadPoolFilter = new ThreadPoolFilter(&quot;sharedThreadPoolFilter&quot;);
+    /** Thread pool instance that will be added to all acceptors. */
+    private final ThreadPoolFilter threadPoolFilter = new ThreadPoolFilter(
+            &quot;sharedThreadPoolFilter&quot; );
 
-	/** All the services, mapped by name. */
-	private final ConcurrentMap&lt;String, ProxyService&gt; services = new ConcurrentHashMap&lt;String, ProxyService&gt;();
+    /** All the services, mapped by name. */
+    private final ConcurrentMap&lt;String, ProxyService&gt; services = new ConcurrentHashMap&lt;String, ProxyService&gt;();
 
-	/** Map a ProxyService to all its bound addresses. */
-	private final ConcurrentMap&lt;ProxyService, Set&lt;SocketAddress&gt;&gt; addresses = new ConcurrentHashMap&lt;ProxyService, Set&lt;SocketAddress&gt;&gt;();
+    /** Map a ProxyService to all its bound addresses. */
+    private final ConcurrentMap&lt;ProxyService, Set&lt;SocketAddress&gt;&gt; addresses = new ConcurrentHashMap&lt;ProxyService, Set&lt;SocketAddress&gt;&gt;();
 
-	/** Map a ProxyService to its own IoAcceptor. */
-	private final ConcurrentMap&lt;ProxyService, IoAcceptor&gt; acceptors = new ConcurrentHashMap&lt;ProxyService, IoAcceptor&gt;();
+    /** Map a ProxyService to its own IoAcceptor. */
+    private final ConcurrentMap&lt;ProxyService, IoAcceptor&gt; acceptors = new ConcurrentHashMap&lt;ProxyService, IoAcceptor&gt;();
 
-	/**
-	 * Construct a new ProxyServiceRegistry. This class is a Singleton, so there
-	 * can be only one instance.
-	 */
-	public ProxyServiceRegistry()
-	{
-		int poolMaxSize = Config.threadPoolSize.getValue();
-		threadPoolFilter.setMaximumPoolSize( poolMaxSize );
+    /**
+     * Construct a new ProxyServiceRegistry. This class is a Singleton, so there
+     * can be only one instance.
+     */
+    public ProxyServiceRegistry()
+    {
+        int poolMaxSize = Config.threadPoolSize.getValue();
+        threadPoolFilter.setMaximumPoolSize( poolMaxSize );
 
-		// Subscribe to thread pool size changes notification
-		Config.threadPoolSize.addObserver( this );
-	}
+        // Subscribe to thread pool size changes notification
+        Config.threadPoolSize.addObserver( this );
+    }
 
-	/**
-	 * Bind a Service to a local address and specify the IoHandler that will
-	 * manage ingoing and outgoing messages.
-	 * 
-	 * @param service
-	 *            the ProxyService
-	 * @param ioHandler
-	 *            the IoHandler that will handle the messages
-	 * @param address
-	 *            the local address to bind on
-	 * @throws IOException
-	 */
-	public void bind( ProxyService service, IoHandler ioHandler, InetSocketAddress address )
-			throws IOException
-	{
-		bind( service, ioHandler, address, null );
-	}
+    /**
+     * Bind a Service to a local address and specify the IoHandler that will
+     * manage ingoing and outgoing messages.
+     * 
+     * @param service
+     *            the ProxyService
+     * @param ioHandler
+     *            the IoHandler that will handle the messages
+     * @param address
+     *            the local address to bind on
+     * @throws IOException
+     */
+    public void bind( ProxyService service, IoHandler ioHandler, InetSocketAddress address )
+            throws IOException
+    {
+        bind( service, ioHandler, address, null );
+    }
 
-	/**
-	 * Bind a Service to a local address and specify the IoHandler that will
-	 * manage ingoing and outgoing messages.
-	 * &lt;p&gt;
-	 * In addition it should be specified an IoFilterChainBuilder. This builder
-	 * will be associated with the IoAcceptor itself (which is unique per
-	 * ProxyService) and not for every IoSession created.
-	 * 
-	 * @param service
-	 *            the ProxyService
-	 * @param ioHandler
-	 *            the IoHandler that will handle the messages
-	 * @param address
-	 *            the local address to bind on
-	 * @param filterChainBuilder
-	 *            the IoFilterChainBuilder instance
-	 * @throws IOException
-	 */
-	public void bind( ProxyService service, IoHandler ioHandler,
-			InetSocketAddress address, IoFilterChainBuilder filterChainBuilder )
-			throws IOException
-	{
-		IoAcceptor acceptor = newAcceptor( service );
-		
-		IoFilterChainBuilder builder = new IoFilterChainBuilderWrapper( service,
-				filterChainBuilder );
-		acceptor.setFilterChainBuilder( builder );
-		acceptor.bind( address, ioHandler );
+    /**
+     * Bind a Service to a local address and specify the IoHandler that will
+     * manage ingoing and outgoing messages.
+     * &lt;p&gt;
+     * In addition it should be specified an IoFilterChainBuilder. This builder
+     * will be associated with the IoAcceptor itself (which is unique per
+     * ProxyService) and not for every IoSession created.
+     * 
+     * @param service
+     *            the ProxyService
+     * @param ioHandler
+     *            the IoHandler that will handle the messages
+     * @param address
+     *            the local address to bind on
+     * @param filterChainBuilder
+     *            the IoFilterChainBuilder instance
+     * @throws IOException
+     */
+    public void bind( ProxyService service, IoHandler ioHandler,
+            InetSocketAddress address, IoFilterChainBuilder filterChainBuilder )
+            throws IOException
+    {
+        IoAcceptor acceptor = newAcceptor( service );
 
-		services.put( service.getName(), service );
+        IoFilterChainBuilder builder = new IoFilterChainBuilderWrapper( service,
+                filterChainBuilder );
+        acceptor.setFilterChainBuilder( builder );
+        acceptor.bind( address, ioHandler );
 
-		if ( addresses.get( service ) == null )
-			addresses.put( service, new HashSet&lt;SocketAddress&gt;() );
-		addresses.get( service ).add( address );
-	}
+        services.put( service.getName(), service );
 
-	/**
-	 * Unbind the service from all of its bound addresses.
-	 * 
-	 * @param service
-	 *            the ProxyService
-	 * @throws Exception
-	 */
-	public synchronized void unbind( ProxyService service ) throws Exception
-	{
-		IoAcceptor acceptor = acceptors.get( service );
-		for ( SocketAddress address : addresses.get( service ) ) {
-			try {
-				acceptor.unbind( address );
-			} catch ( Exception e ) {
-				// ignore
-			}
-		}
+        if ( addresses.get( service ) == null )
+            addresses.put( service, new HashSet&lt;SocketAddress&gt;() );
+        addresses.get( service ).add( address );
+    }
 
-		if ( service.isRunning() ) {
-			service.stop();
-		}
+    public void unbind( ProxyService service ) throws Exception
+    {
+        unbind( service, true );
+    }
 
-		services.remove( service.getName() );
-		acceptors.remove( service );
-		addresses.remove( service );
-	}
+    /**
+     * Unbind the service from all of its bound addresses.
+     * 
+     * @param service
+     *            the ProxyService
+     * @throws Exception
+     */
+    public synchronized void unbind( ProxyService service, boolean stopService )
+            throws Exception
+    {
+        IoAcceptor acceptor = acceptors.get( service );
+        for ( SocketAddress address : addresses.get( service ) ) {
+            try {
+                acceptor.unbind( address );
+            } catch ( Exception e ) {
+                // log.debug( &quot;Error unbinding {}&quot;, service.getName() );
+                // Exceptions.logStackTrace( e );
+                // ignore
+            }
+        }
 
-	/**
-	 * Unbind all the services registered in the ProxyServiceRegistry, from all
-	 * of they bound addresses.
-	 * 
-	 * @throws Exception
-	 */
-	public synchronized void unbindAll() throws Exception
-	{
-		Set&lt;ProxyService&gt; serviceList = new HashSet&lt;ProxyService&gt;( services.values() );
-		for ( ProxyService service : serviceList ) {
-			unbind( service );
-		}
-	}
+        if ( stopService &amp;&amp; service.isRunning() ) {
+            service.stop();
+        }
 
-	/**
-	 * @return a Set containing all the registered services.
-	 */
-	public Set&lt;ProxyService&gt; getAllServices()
-	{
-		return new HashSet&lt;ProxyService&gt;( services.values() );
-	}
+        services.remove( service.getName() );
+        acceptors.remove( service );
+        addresses.remove( service );
+    }
 
-	/**
-	 * Return the instance of a ProxyService.
-	 * 
-	 * @param name
-	 *            the name of the ProxyService
-	 * @return the instance of the ProxyService
-	 */
-	public ProxyService getService( String name )
-	{
-		return services.get( name );
-	}
+    /**
+     * Unbind all the services registered in the ProxyServiceRegistry, from all
+     * of they bound addresses.
+     * 
+     * @throws Exception
+     */
+    public synchronized void unbindAll() throws Exception
+    {
+        for ( ProxyService service : services.values() ) {
+            unbind( service );
+        }
+    }
 
-	/**
-	 * Returns a reference to the IoAcceptor used by the specified ProxyService.
-	 * 
-	 * @param serviceName
-	 *            the name of the ProxyService
-	 * @return the IoAcceptor associated with the service or null if the
-	 *         serviceName is invalid
-	 */
-	public IoAcceptor getAcceptor( String serviceName )
-	{
-		ProxyService service = services.get( serviceName );
-		if ( service == null )
-			return null;
-		else
-			return acceptors.get( service );
-	}
+    /**
+     * @return a Set containing all the registered services.
+     */
+    public Set&lt;ProxyService&gt; getAllServices()
+    {
+        return new HashSet&lt;ProxyService&gt;( services.values() );
+    }
 
-	/**
-	 * Returns a reference to the IoAcceptor used by the specified ProxyService.
-	 * 
-	 * @param service
-	 *            the ProxyService
-	 * @return the IoAcceptor associated with the service
-	 */
-	public IoAcceptor getAcceptor( ProxyService service )
-	{
-		return acceptors.get( service );
-	}
+    /**
+     * Return the instance of a ProxyService.
+     * 
+     * @param name
+     *            the name of the ProxyService
+     * @return the instance of the ProxyService
+     */
+    public ProxyService getService( String name )
+    {
+        return services.get( name );
+    }
 
-	/**
-	 * Gets a new IoAcceptor suitable for the specified ProxyService
-	 * 
-	 * @param service
-	 *            the ProxyService
-	 * @return a reference to the IoAcceptor
-	 */
-	private IoAcceptor newAcceptor( ProxyService service )
-	{
-		// First check if there's already an acceptor
-		IoAcceptor acceptor = acceptors.get( service );
-		if ( acceptor != null )
-			return acceptor;
+    /**
+     * Returns a reference to the IoAcceptor used by the specified ProxyService.
+     * 
+     * @param serviceName
+     *            the name of the ProxyService
+     * @return the IoAcceptor associated with the service or null if the
+     *         serviceName is invalid
+     */
+    public IoAcceptor getAcceptor( String serviceName )
+    {
+        ProxyService service = services.get( serviceName );
+        if ( service == null )
+            return null;
 
-		// Create a new one
-		TransportType transportType = service.getTransportType();
-		if ( transportType == TransportType.SOCKET )
-			acceptor = new SocketAcceptor(); // socketAcceptor;
-		else if ( transportType == TransportType.DATAGRAM )
-			acceptor = new DatagramAcceptor(); // datagramAcceptor;
-		else
-			acceptor = null;
+        return acceptors.get( service );
+    }
 
-		// Save the acceptor
-		acceptors.put( service, acceptor );
-		return acceptor;
-	}
+    /**
+     * Returns a reference to the IoAcceptor used by the specified ProxyService.
+     * 
+     * @param service
+     *            the ProxyService
+     * @return the IoAcceptor associated with the service
+     */
+    public IoAcceptor getAcceptor( ProxyService service )
+    {
+        return acceptors.get( service );
+    }
 
-	/**
-	 * Gets notification of changed parameters.
-	 * 
-	 * @see java.util.Observer#update(java.util.Observable, java.lang.Object)
-	 */
-	public void update( Observable o, Object arg )
-	{
-		if ( !(o instanceof Parameter) )
-			throw new IllegalArgumentException( &quot;Only observe parameters&quot; );
+    /**
+     * Gets a new IoAcceptor suitable for the specified ProxyService
+     * 
+     * @param service
+     *            the ProxyService
+     * @return a reference to the IoAcceptor
+     */
+    private IoAcceptor newAcceptor( ProxyService service )
+    {
+        // First check if there's already an acceptor
+        IoAcceptor acceptor = acceptors.get( service );
+        if ( acceptor != null )
+            return acceptor;
 
-		if ( o == Config.threadPoolSize ) {
-			// Update the thread pool size
-			threadPoolFilter.setMaximumPoolSize( Config.threadPoolSize.getValue() );
-			log.info( &quot;Changed ThreadPool size. New max size: &quot;
-					+ threadPoolFilter.getMaximumPoolSize() );
-		}
-	}
+        // Create a new one
+        TransportType transportType = service.getTransportType();
+        if ( transportType == TransportType.SOCKET )
+            acceptor = new SocketAcceptor(); // socketAcceptor;
+        else if ( transportType == TransportType.DATAGRAM )
+            acceptor = new DatagramAcceptor(); // datagramAcceptor;
+        else
+            acceptor = null;
 
-	/**
-	 * @param service 
-	 * @param service 
-	 * @return the shared thread pool filter instance
-	 */
-	public IoFilter getThreadPoolFilterInstance(ProxyService service)
-	{
-		ThreadPoolFilter filter = service.getThreadPoolFilter();
+        // Save the acceptor
+        acceptors.put( service, acceptor );
+        return acceptor;
+    }
 
-		if(filter == null)
-			filter = threadPoolFilter;
-		return filter;
-	}
+    /**
+     * Gets notification of changed parameters.
+     * 
+     * @see java.util.Observer#update(java.util.Observable, java.lang.Object)
+     */
+    public void update( Observable o, Object arg )
+    {
+        if ( !(o instanceof Parameter) )
+            throw new IllegalArgumentException( &quot;Only observe parameters&quot; );
 
-	/**
-	 * @return a reference to the (unique) ProxyServiceRegistry instance
-	 */
-	public static ProxyServiceRegistry getInstance()
-	{
-		return (ProxyServiceRegistry) Singleton.getInstance( ProxyServiceRegistry.class );
-	}
+        if ( o == Config.threadPoolSize ) {
+            // Update the thread pool size
+            threadPoolFilter.setMaximumPoolSize( Config.threadPoolSize.getValue() );
+            log.info( &quot;Changed ThreadPool size. New max size: &quot;
+                    + threadPoolFilter.getMaximumPoolSize() );
+        }
+    }
 
-	/**
-	 * Wrapper class for the IoFilterChainBuilder that always add the thread
-	 * pool filter as the filter in the chain.
-	 * &lt;p&gt;
-	 * The thread pool filter will be shared by all the services and acceptors.
-	 */
-	protected static class IoFilterChainBuilderWrapper implements IoFilterChainBuilder
-	{
+    /**
+     * @param service
+     * @param service
+     * @return the shared thread pool filter instance
+     */
+    public IoFilter getThreadPoolFilterInstance( ProxyService service )
+    {
+        ThreadPoolFilter filter = service.getThreadPoolFilter();
 
-		private final ProxyService service;
+        if ( filter == null )
+            filter = threadPoolFilter;
+        return filter;
+    }
 
-		private final IoFilterChainBuilder originalBuilder;
+    /**
+     * @return a reference to the (unique) ProxyServiceRegistry instance
+     */
+    public static ProxyServiceRegistry getInstance()
+    {
+        return (ProxyServiceRegistry) Singleton.getInstance( ProxyServiceRegistry.class );
+    }
 
-		public IoFilterChainBuilderWrapper( ProxyService service,
-				IoFilterChainBuilder originalBuilder )
-		{
-			this.service = service;
-			this.originalBuilder = originalBuilder;
-		}
+    /**
+     * Wrapper class for the IoFilterChainBuilder that always add the thread
+     * pool filter as the filter in the chain.
+     * &lt;p&gt;
+     * The thread pool filter will be shared by all the services and acceptors.
+     */
+    protected static class IoFilterChainBuilderWrapper implements IoFilterChainBuilder
+    {
 
-		public void buildFilterChain( IoFilterChain chain ) throws Exception
-		{
-			chain.getSession().setAttribute( ProxyService.SERVICE, service );
+        private final ProxyService service;
 
-			if(service.wantThreadPoolFilter()) {
-				IoFilter threadPoolFilter = ProxyServiceRegistry.getInstance()
-				.getThreadPoolFilterInstance(service);
-				chain.addFirst( threadPoolFilterNAME, threadPoolFilter );
-			}
-			originalBuilder.buildFilterChain( chain );
-		}
-	}
+        private final IoFilterChainBuilder originalBuilder;
 
+        public IoFilterChainBuilderWrapper( ProxyService service,
+                IoFilterChainBuilder originalBuilder )
+        {
+            this.service = service;
+            this.originalBuilder = originalBuilder;
+        }
+
+        /*
+         * (non-Javadoc)
+         * 
+         * @see org.apache.mina.common.IoFilterChainBuilder#buildFilterChain(org.apache.mina.common.IoFilterChain)
+         */
+        public void buildFilterChain( IoFilterChain chain ) throws Exception
+        {
+            chain.getSession().setAttribute( ProxyService.SERVICE, service );
+
+            if ( service.wantThreadPoolFilter() ) {
+                IoFilter threadPoolFilter = ProxyServiceRegistry.getInstance()
+                        .getThreadPoolFilterInstance( service );
+                chain.addFirst( threadPoolFilterNAME, threadPoolFilter );
+            }
+            originalBuilder.buildFilterChain( chain );
+        }
+    }
+
 }

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfig.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfig.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfig.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,67 +0,0 @@
-/**
- * 
- */
-package rtspproxy.config;
-
-import java.util.HashMap;
-import java.util.List;
-
-import org.dom4j.Element;
-
-import rtspproxy.lib.Side;
-
-/**
- * This class contains the configuration for an AAA filter.
- * 
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at web.de</A>)
- */
-public class AAAConfig {
-
-	// implementation class name
-	private String implClass;
-	
-	// list of configuration elements
-	private List&lt;Element&gt; configElements;
-	
-	// filter application
-	private Side side = Side.Any;
-	
-	// any additional attributes given
-	private HashMap&lt;String, String&gt; attrs = new HashMap&lt;String, String&gt;();
-	
-	/**
-	 * 
-	 */
-	AAAConfig(String implClass, Side side, List&lt;Element&gt; configElements) {
-		this.implClass = implClass;
-		this.configElements = configElements;
-		this.side = side;
-	}
-
-	public final List&lt;Element&gt; getConfigElements() {
-		return configElements;
-	}
-
-	public final String getImplClass() {
-		return implClass;
-	}
-
-	public final Side getSide() {
-		return this.side;
-	}
-	
-	final void setAttribute(String name, String value) {
-		this.attrs.put(name, value);
-	}
-	
-	public final String getAttribute(String name) {
-		return this.getAttribute(name, null);
-	}
-
-	public final String getAttribute(String name, String defValue) {
-		if(this.attrs.containsKey(name))
-			return this.attrs.get(name);
-		
-		return defValue;
-	}
-}

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfigurable.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfigurable.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/AAAConfigurable.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,27 +0,0 @@
-/**
- * 
- */
-package rtspproxy.config;
-
-import java.util.List;
-
-import org.dom4j.Element;
-
-/**
- * This interface is implemented by filters which can be configured via the XML
- * mechanism
- * 
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- */
-public interface AAAConfigurable
-{
-
-    /**
-     * configure the filter.
-     * 
-     * @param configElements
-     *            a list of dom4j elements containing the actual configuration
-     */
-    public void configure( List&lt;Element&gt; configElements ) throws Exception;
-    
-}

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/Config.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/Config.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/Config.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -18,11 +18,8 @@
 
 package rtspproxy.config;
 
-import java.util.ArrayList;
 import java.util.Collection;
-import java.util.Collections;
 import java.util.Date;
-import java.util.List;
 import java.util.Map;
 import java.util.Observable;
 import java.util.Observer;
@@ -31,7 +28,6 @@
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ConcurrentMap;
 
-import org.apache.log4j.Appender;
 import org.apache.log4j.Level;
 import org.apache.log4j.Logger;
 
@@ -78,18 +74,18 @@
 
     public static final IntegerParameter threadPoolSize = new IntegerParameter(
             &quot;threadPoolSize&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 2147483647 ), // max value
-            new Integer( 10 ), // default value
+            0, // min value
+            2147483647, // max value
+            10, // default value
             true, // mutable
             &quot;Maximum size of the thread pool. The thread pool is shared &quot;
                     + &quot;between all services found in RtspProxy.&quot; );
 
     public static final IntegerParameter proxyRtspPort = new IntegerParameter(
             &quot;proxy.rtspPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( Handler.DEFAULT_RTSP_PORT ), // default value
+            0, // min value
+            65536, // max value
+            Handler.DEFAULT_RTSP_PORT, // default value
             true, // mutable
             &quot;This is the port which the proxy will listen for &quot;
                     + &quot;RTSP connection. The default is 554, like normal RTSP servers.&quot; );
@@ -120,17 +116,17 @@
 
     public static final IntegerParameter proxyServerRtpPort = new IntegerParameter(
             &quot;proxy.server.rtpPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8000 ), // default value
+            0, // min value
+            65536, // max value
+            8000, // default value
             true, // mutable
             &quot;Port to listen for RTP packets arriving from servers.&quot; );
 
     public static final IntegerParameter proxyServerRtcpPort = new IntegerParameter(
             &quot;proxy.server.rtcp.port&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8001 ), // default value
+            0, // min value
+            65536, // max value
+            8001, // default value
             true, // mutable
             &quot;Port to listen for RTCP packets arriving from servers.&quot; );
 
@@ -142,73 +138,73 @@
 
     public static final IntegerParameter proxyServerRtpMinPort = new IntegerParameter(
             &quot;proxy.server.rtpPortrange.minPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 9000 ), // default value
+            0, // min value
+            65536, // max value
+            9000, // default value
             true, // mutable
             &quot;Port to listen for RTP packets arriving from servers.&quot; );
 
     public static final IntegerParameter proxyServerRtpMaxPort = new IntegerParameter(
             &quot;proxy.server.rtpPortrange.maxPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 9100 ), // default value
+            0, // min value
+            65536, // max value
+            9100, // default value
             true, // mutable
             &quot;Port to listen for RTP packets arriving from servers.&quot; );
 
     public static final IntegerParameter proxyServerRtpIdleTimeout = new IntegerParameter(
             &quot;proxy.server.rtpPortrange.idleTimeout&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 86400 ), // max value
-            new Integer( 3600 ), // default value
+            0, // min value
+            86400, // max value
+            3600, // default value
             true, // mutable
             &quot;Timeout an open RTP server port may linger around.&quot; );
 
     public static final IntegerParameter proxyServerRtpIdleScanInterval = new IntegerParameter(
             &quot;proxy.server.rtpPortrange.idleScanInterval&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 86400 ), // max value
-            new Integer( 1800 ), // default value
+            0, // min value
+            86400, // max value
+            1800, // default value
             true, // mutable
             &quot;Scan interval on idle RTP server ports.&quot; );
 
     public static final IntegerParameter proxyServerRtpThreadPoolSize = new IntegerParameter(
             &quot;proxy.server.rtpPortrange.threadPoolSize&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 2147483647 ), // max value
-            new Integer( 10 ), // default value
+            0, // min value
+            2147483647, // max value
+            10, // default value
             true, // mutable
             &quot;Scan interval on idle RTP server ports.&quot; );
 
     public static final IntegerParameter proxyClientRtpPort = new IntegerParameter(
             &quot;proxy.client.rtpPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8002 ), // default value
+            0, // min value
+            65536, // max value
+            8002, // default value
             true, // mutable
             &quot;Port to listen for RTP packets arriving from clients.&quot; );
 
     public static final IntegerParameter proxyClientRtcpPort = new IntegerParameter(
             &quot;proxy.client.rtcpPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8003 ), // default value
+            0, // min value
+            65536, // max value
+            8003, // default value
             true, // mutable
             &quot;Port to listen for RTCP packets arriving from clients.&quot; );
 
     public static final IntegerParameter proxyServerRdtPort = new IntegerParameter(
             &quot;proxy.server.rdtPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8020 ), // default value
+            0, // min value
+            65536, // max value
+            8020, // default value
             true, // mutable
             &quot;Port to listen for RDT packets arriving from servers.&quot; );
 
     public static final IntegerParameter proxyClientRdtPort = new IntegerParameter(
             &quot;proxy.client.rdtPort&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8022 ), // default value
+            0, // min value
+            65536, // max value
+            8022, // default value
             true, // mutable
             &quot;Port to listen for RDT packets arriving from clients.&quot; );
 
@@ -300,9 +296,9 @@
 
     public static final IntegerParameter jmxWebPort = new IntegerParameter(
             &quot;jmx.web.port&quot;, // name
-            new Integer( 0 ), // min value
-            new Integer( 65536 ), // max value
-            new Integer( 8000 ), // default value
+            0, // min value
+            65536, // max value
+            8000, // default value
             false, // mutable
             &quot;TCP port to be used for the Web Console.&quot; );
 
@@ -314,82 +310,90 @@
 
     // /////////////////////////////////////////////////////////
 
-    private static String rtspproxyHome;
+    // Authentication filter
 
-    private static String name;
+    public static final BooleanParameter filtersAuthenticationEnable = new BooleanParameter(
+            &quot;filters.authentication.enable&quot;, // name
+            false, // default value
+            false, // mutable
+            &quot;Controls the activation of the Authentication system&quot; );
 
-    private static String version;
+    public static final StringParameter filtersAuthenticationImplClass = new StringParameter(
+            &quot;filters.authentication.implClass&quot;, // name
+            &quot;rtspproxy.filter.authentication.SimpleAuthenticationProvider&quot;, // default
+            // value
+            false, // mutable
+            &quot;Implementation class for the authentication filter.&quot; );
 
-    private static String proxySignature;
+    public static final StringParameter filtersAuthenticationScheme = new StringParameter(
+            &quot;filters.authentication.scheme&quot;, // name
+            &quot;Basic&quot;, // default value
+            false, // mutable
+            &quot;Authentication scheme to be used. Can be 'Basic' or 'Digest'.&quot; );
 
-    private static Date startDate;
+    // /////////////////////////////////////////////////////////
 
+    // IP address filter
+
+	public static final BooleanParameter filtersIpAddressEnable = new BooleanParameter(
+            &quot;filters.ipaddress.enable&quot;, // name
+            false, // default value
+            false, // mutable
+            &quot;Controls the activation of the IP address filter.&quot; );
+
+    public static final StringParameter filtersIpAddressImplClass = new StringParameter(
+            &quot;filters.ipaddress.implClass&quot;, // name
+            &quot;rtspproxy.filter.ipaddress.SimpleIpAddressProvider&quot;, // default
+                                                                    // value
+            false, // mutable
+            &quot;Implementation class for the IP address filter.&quot; );
+
     // /////////////////////////////////////////////////////////
 
-    // filter configurations from XML
-    private static List&lt;AAAConfig&gt; authenticationFilters = new ArrayList&lt;AAAConfig&gt;();
+    // Accounting filter
 
-    // filter configurations from XML
-    private static List&lt;AAAConfig&gt; ipAddressFilters = new ArrayList&lt;AAAConfig&gt;();
+    public static final BooleanParameter filtersAccountingEnable = new BooleanParameter(
+            &quot;filters.accounting.enable&quot;, // name
+            false, // default value
+            false, // mutable
+            &quot;Controls the activation of the Accounting system&quot; );
 
-    // filter configurations from XML
-    private static List&lt;AAAConfig&gt; accountingFilters = new ArrayList&lt;AAAConfig&gt;();
+    public static final StringParameter filtersAccountingImplClass = new StringParameter(
+            &quot;filters.accounting.implClass&quot;, // name
+            &quot;rtspproxy.filter.accounting.SimpleAccountingProvider&quot;, // default value
+            false, // mutable
+            &quot;Implementation class for the accounting filter.&quot; );
 
-    // filter configurations from XML
-    private static List&lt;AAAConfig&gt; urlRewritingFilters = new ArrayList&lt;AAAConfig&gt;();
 
-    private static List&lt;AAAConfig&gt; controlFilters = new ArrayList&lt;AAAConfig&gt;();
+    // /////////////////////////////////////////////////////////
 
-    static void addAuthenticationFilter( AAAConfig config )
-    {
-        authenticationFilters.add( config );
-    }
+    // Rewrite filter
 
-    static void addIpAddressFilter( AAAConfig config )
-    {
-        ipAddressFilters.add( config );
-    }
+    public static final BooleanParameter filtersRewriteEnable = new BooleanParameter(
+            &quot;filters.rewrite.enable&quot;, // name
+            false, // default value
+            true, // mutable
+            &quot;Controls the activation of the Rewrite system&quot; );
 
-    static void addAccountingFilter( AAAConfig config )
-    {
-        accountingFilters.add( config );
-    }
+    public static final StringParameter filtersRewriteImplClass = new StringParameter(
+            &quot;filters.rewrite.implClass&quot;, // name
+            &quot;rtspproxy.filter.authentication.SimpleAuthenticationProvider&quot;, // default
+            // value
+            true, // mutable
+            &quot;Implementation class for the authentication filter.&quot; );
 
-    static void addUrlRewritingFilter( AAAConfig config )
-    {
-        urlRewritingFilters.add( config );
-    }
+    // /////////////////////////////////////////////////////////
 
-    public static void addControlFilter( AAAConfig aaa )
-    {
-        controlFilters.add( aaa );
-    }
+    private static String rtspproxyHome;
 
-    public static List&lt;AAAConfig&gt; getAuthenticationFilters()
-    {
-        return Collections.unmodifiableList( authenticationFilters );
-    }
+    private static String name;
 
-    public static List&lt;AAAConfig&gt; getIpAddressFilters()
-    {
-        return Collections.unmodifiableList( ipAddressFilters );
-    }
+    private static String version;
 
-    public static List&lt;AAAConfig&gt; getAccountingFilters()
-    {
-        return Collections.unmodifiableList( accountingFilters );
-    }
+    private static String proxySignature;
 
-    public static List&lt;AAAConfig&gt; getUrlRewritingFilters()
-    {
-        return Collections.unmodifiableList( urlRewritingFilters );
-    }
+    private static Date startDate;
 
-    public static List&lt;AAAConfig&gt; getControlFilters()
-    {
-        return Collections.unmodifiableList( controlFilters );
-    }
-
     // /////////////////////////////////////////////////////////
 
     public Config()

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListElementParameter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListElementParameter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListElementParameter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -5,7 +5,7 @@
  *   the Free Software Foundation; either version 2 of the License, or     *
  *   (at your option) any later version.                                   *
  *                                                                         *
- *   Copyright (C) 2005 - Matteo Merli - <A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">matteo.merli at gmail.com</A>            *
+ *   Copyright (C) 2006 - Matteo Merli - <A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">matteo.merli at gmail.com</A>            *
  *                                                                         *
  ***************************************************************************/
 
@@ -17,11 +17,17 @@
  */
 package rtspproxy.config;
 
+import org.apache.commons.configuration.Configuration;
+
 /**
  * @author Matteo Merli
  * 
  */
 public interface ListElementParameter
 {
+
+    public boolean readConfiguration( Configuration configuration, String prefix );
     
+    public String toString();
+    
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListParameter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListParameter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListParameter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -3,6 +3,7 @@
  */
 package rtspproxy.config;
 
+import java.util.ArrayList;
 import java.util.List;
 
 import org.apache.commons.configuration.Configuration;
@@ -13,21 +14,26 @@
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
  * 
  */
-public class ListParameter&lt;T&gt; extends Parameter
+public class ListParameter&lt;T extends ListElementParameter&gt; extends Parameter
 {
 
     private static Logger log = LoggerFactory.getLogger( ListParameter.class );
 
-    private List&lt;T&gt; list;
+    private Class&lt;T&gt; parameterClass;
 
+    private List&lt;T&gt; list = new ArrayList&lt;T&gt;();
+
     /**
      * @param name
      * @param mutable
      * @param description
      */
-    public ListParameter( String name, boolean mutable, String description )
+    public ListParameter( String name, boolean mutable, Class&lt;T&gt; parameterClass,
+            String description )
     {
         super( name, mutable, description );
+
+        this.parameterClass = parameterClass;
     }
 
     @Override
@@ -35,6 +41,11 @@
     {
         return list;
     }
+    
+    public List&lt;T&gt; getElementsList()
+    {
+        return list;
+    }
 
     @Override
     public String getStringValue()
@@ -51,24 +62,38 @@
     @Override
     public void readConfiguration( Configuration configuration )
     {
-        List elements = configuration.getList( name );
-        if ( elements == null ) {
-            log.debug( &quot;Elements not found for key '{}'&quot;, name );
-            return;
-        }
+        boolean res;
+        T element = null;
+        String prefix;
 
-        for ( Object element : elements ) {
-            log.info( &quot;ELEMENT: {}&quot;, element );
+        for ( int i = 0; /**/; i++ ) {
+            
+            try {
+                element = parameterClass.newInstance();
+            } catch ( Exception e ) {
+                log.error( &quot;Cannot instantiate class: {}&quot;, parameterClass.getName() );
+                return;
+            }
+            
+            prefix = name + &quot;(&quot; + i + &quot;)&quot;;
+            res = element.readConfiguration( configuration, prefix );
+
+            if ( res == false )
+                // end of list reached
+                break;
+            
+            list.add( element );
         }
     }
 
     @Override
+    @SuppressWarnings(&quot;unchecked&quot;)
     public void setObjectValue( Object object )
     {
         if ( !(object instanceof List) ) {
             throw new IllegalArgumentException( &quot;Only accept a List parameter.&quot; );
         }
-        
-        list = (List&lt;T&gt;)object;
+
+        list = (List) object;
     }
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/ListParameter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/XMLConfigReader.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/XMLConfigReader.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/XMLConfigReader.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -10,9 +10,9 @@
  ***************************************************************************/
 
 /*
- * $Id: Main.java 378 2006-01-06 20:36:11Z rbieniek $
+ * $Id$
  * 
- * $URL: <A HREF="https://svn.berlios.de/svnroot/repos/rtspproxy/trunk/RTSPProxy-App/src/main/java/rtspproxy/Main.java">https://svn.berlios.de/svnroot/repos/rtspproxy/trunk/RTSPProxy-App/src/main/java/rtspproxy/Main.java</A> $
+ * $URL$
  * 
  */
 package rtspproxy.config;
@@ -25,6 +25,7 @@
 import java.io.Reader;
 import java.util.NoSuchElementException;
 
+import org.apache.commons.configuration.Configuration;
 import org.apache.commons.configuration.ConfigurationException;
 import org.apache.commons.configuration.XMLConfiguration;
 import org.dom4j.DocumentException;
@@ -35,14 +36,16 @@
  * This class implements a parser for XML configuration files.
  * 
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- * @todo validate the parsed configuration file by a schema.
  */
-public class XMLConfigReader
+public final class XMLConfigReader
 {
 
-    // logger
     private static final Logger log = LoggerFactory.getLogger( XMLConfigReader.class );
 
+   
+    private static final XMLConfiguration configuration = new XMLConfiguration(); 
+
+
     /**
      * read the configuration file.
      * 
@@ -53,9 +56,9 @@
      * @throws DocumentException
      *             parsing the config file failed.
      */
-    public final void readConfig( String fileName ) throws FileNotFoundException
+    public void readConfig( String fileName ) throws FileNotFoundException
     {
-        log.debug( &quot;Reading configuration file={}&quot;, fileName );
+        log.debug( &quot;Reading configuration file='{}'&quot;, fileName );
         File file = new File( fileName );
 
         if ( file.canRead() ) {
@@ -69,9 +72,8 @@
      * @param is
      *            the input stream to read the configuration from.
      */
-    public final void readConfig( Reader reader )
+    public void readConfig( Reader reader )
     {
-        XMLConfiguration configuration = new XMLConfiguration();
         try {
             configuration.load( reader );
         } catch ( ConfigurationException e ) {
@@ -93,4 +95,9 @@
 
         Config.updateDebugSettings();
     }
+    
+    public static Configuration getConfiguration()
+    {
+    	return configuration;    
+    }
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/config/XMLConfigReader.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterBase.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterBase.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterBase.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -3,74 +3,58 @@
  */
 package rtspproxy.filter;
 
-import java.util.List;
-
 import javax.management.ObjectName;
 
+import org.apache.commons.configuration.Configuration;
 import org.apache.mina.common.IoFilterAdapter;
-import org.dom4j.Element;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import rtspproxy.Reactor;
-import rtspproxy.config.AAAConfigurable;
-import rtspproxy.lib.Side;
 
 /**
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
  * 
  */
-public class FilterBase extends IoFilterAdapter
+public abstract class FilterBase&lt;T extends GenericProvider&gt; extends IoFilterAdapter
 {
 
-    private static Logger logger = LoggerFactory.getLogger( FilterBase.class );
+    private static Logger log = LoggerFactory.getLogger( FilterBase.class );
 
-    // filter name
-    private String filterName;
+    /** running flag */
+    private boolean isRunning = true;
 
-    // class name
-    private String className;
+    /** MBean name assigned by JMX interface */
+    private ObjectName mbeanName;
 
-    // filter type
-    private String typeName;
+    /** chain name of filter */
+    private String chainName;
 
-    // running flag
-    protected boolean running = true;
+    // Abstract methods
+    public abstract String getName();
 
-    // side
-    private Side side;
+    public String getProviderClassName() { return null; }
 
-    // MBean name assigned by JMX interface
-    private ObjectName mbeanName;
+    protected Class&lt;T&gt; getProviderInterface() { return null; }
 
-    // chain name of filter
-    private String chainName;
+    protected void setProvider( T provider ) {}
 
     /**
+     * Subclasses can overload the method to read theyr own configuration
+     * parameters.
      * 
+     * @param configuration A {Configuration} object to read from.
      */
-    public FilterBase( String filterName, String className, String typeName )
+    protected void doConfigure( Configuration configuration )
     {
-        this.filterName = filterName;
-        this.className = className;
-        this.typeName = typeName;
     }
 
     /**
-     * 
-     */
-    public FilterBase( String filterName, String typeName )
-    {
-        this.filterName = filterName;
-        this.typeName = typeName;
-    }
-
-    /**
      * query running flag
      */
     public final boolean isRunning()
     {
-        return this.running;
+        return isRunning;
     }
 
     /**
@@ -78,8 +62,8 @@
      */
     public final void suspend()
     {
-        this.running = false;
-        logger.info( getChainName() + &quot; suspended&quot; );
+        isRunning = false;
+        log.info( &quot;{} suspended&quot;, getChainName() );
     }
 
     /**
@@ -87,8 +71,8 @@
      */
     public final void resume()
     {
-        this.running = true;
-        logger.info( getChainName() + &quot; resumed&quot; );
+        isRunning = true;
+        log.info( &quot;{} resumed&quot;, getChainName() );
     }
 
     /**
@@ -100,22 +84,6 @@
     }
 
     /**
-     * get the side
-     */
-    public Side getSide()
-    {
-        return this.side;
-    }
-
-    /**
-     * set the side
-     */
-    public void setSide( Side side )
-    {
-        this.side = side;
-    }
-
-    /**
      * @return Returns the mbeanName.
      */
     public ObjectName getMbeanName()
@@ -138,100 +106,78 @@
     }
 
     /**
-     * @return Returns the className.
-     */
-    public String getClassName()
-    {
-        return className;
-    }
-
-    /**
-     * @return Returns the typeName.
-     */
-    public String getTypeName()
-    {
-        return typeName;
-    }
-
-    /**
      * get the chain name for the filter.
      */
     public String getChainName()
     {
-
         if ( this.chainName == null ) {
-            StringBuffer buf = new StringBuffer( this.filterName );
+            StringBuilder buf = new StringBuilder();
 
+            buf.append( getName() );
             buf.append( '/' );
-            buf.append( this.typeName );
-            if ( this.className != null ) {
+            buf.append( getProviderInterface() );
+            if ( getProviderClassName() != null ) {
                 buf.append( '/' );
-                buf.append( this.className );
+                buf.append( getProviderClassName() );
             }
-
             this.chainName = buf.toString();
         }
+
         return this.chainName;
     }
 
-    /**
-     * load a provider class, instantiate an object, configure and init it.
-     * 
-     * @param className
-     *            the name of the provider class to load
-     * @param requiredInterface
-     *            the provider interface the loaded class should implement. This
-     *            implementation assumes that the interface is a sub-interface
-     *            of GenericProvider
-     * @param configElements
-     *            the configuration elements used to configure the loaded
-     *            provider
-     */
-    protected GenericProvider loadConfigInitProvider( String className,
-            Class requiredInterface, List&lt;Element&gt; configElements )
+    @SuppressWarnings(&quot;unchecked&quot;)
+    public final void configure( Configuration configuration )
     {
-        GenericProvider provider = null;
-        String providerName = requiredInterface.getSimpleName();
+        // Configure the concrete class implementation
+        doConfigure( configuration );
+
         Class providerClass;
+	String className = getProviderClassName(); 
+	if ( className == null ) {
+		// The filter does not have a provider 
+		// system. Ignore it.
+		return;
+	}
+
         try {
             providerClass = Class.forName( className );
 
         } catch ( Throwable t ) {
-            logger.error( &quot;Invalid &quot; + providerName + &quot;class: &quot; + className, t );
+            log.error( &quot;Class not found: {}&quot;, className );
             Reactor.stop();
-            return null;
+            return;
         }
 
-        // Check if the class implements the IpAddressProvider interfaces
+        // Check if the class implements the required interface
         boolean found = false;
+        Class&lt;T&gt; requiredInterface = getProviderInterface();
         for ( Class interFace : providerClass.getInterfaces() ) {
-            if ( requiredInterface.equals( interFace ) ) {
+            if ( interFace.equals( requiredInterface ) ) {
                 found = true;
                 break;
             }
         }
 
         if ( !found ) {
-            logger.error( &quot;Class ({}) does not implement the {} interface.&quot;, providerClass,
-                    providerName );
+            log.error( &quot;Class ({}) does not implement the {} interface.&quot;, providerClass,
+                    requiredInterface );
             Reactor.stop();
-            return null;
+            return;
         }
 
+	// Instanciate the provider and configure it.
         try {
-            provider = (GenericProvider) providerClass.newInstance();
+            T provider = (T) providerClass.newInstance();
+            setProvider( provider );
+            provider.configure( configuration );
+            provider.start();
 
-            if ( provider instanceof AAAConfigurable )
-                ((AAAConfigurable) provider).configure( configElements );
-
-            provider.init();
-
         } catch ( Exception e ) {
-            logger.error( &quot;Error starting &quot; + providerName + &quot;: &quot; + e );
+            log.error( &quot;Error instanciaing class '{}'&quot;, providerClass );
             Reactor.stop();
-            return null;
+            return;
         }
-
-        return provider;
     }
+
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterBase.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterRegistry.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterRegistry.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterRegistry.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -10,249 +10,167 @@
  ***************************************************************************/
 
 /*
- * $Id: RtspFilters.java 406 2006-01-27 00:28:56Z rbieniek $
+ * $Id$
  * 
- * $URL: <A HREF="https://svn.berlios.de/svnroot/repos/rtspproxy/trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java">https://svn.berlios.de/svnroot/repos/rtspproxy/trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java</A> $
+ * $URL$
  * 
  */
 
 package rtspproxy.filter;
 
-import java.util.Collections;
-import java.util.LinkedList;
-import java.util.List;
-
+import org.apache.commons.configuration.Configuration;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import rtspproxy.Reactor;
-import rtspproxy.config.AAAConfig;
 import rtspproxy.config.Config;
+import rtspproxy.config.XMLConfigReader;
 import rtspproxy.filter.accounting.AccountingFilter;
 import rtspproxy.filter.authentication.AuthenticationFilter;
-import rtspproxy.filter.control.ClientControlFilter;
-import rtspproxy.filter.control.ServerControlFilter;
 import rtspproxy.filter.ipaddress.IpAddressFilter;
-import rtspproxy.filter.rewrite.ClientUrlRewritingFilter;
-import rtspproxy.filter.rewrite.ServerUrlRewritingFilter;
 import rtspproxy.filter.rewrite.UrlRewritingFilter;
 import rtspproxy.jmx.JmxAgent;
-import rtspproxy.lib.Side;
 import rtspproxy.lib.Singleton;
+import rtspproxy.lib.Side;
 
 /**
- * Filter registry. This registry is populated from the configuration on reactor startup
+ * Filter registry. This registry is populated from the configuration on reactor
+ * startup
  * 
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
  */
-public class FilterRegistry extends Singleton {
+public class FilterRegistry extends Singleton
+{
 
-	private static Logger logger = LoggerFactory.getLogger(FilterRegistry.class);
+    private static Logger log = LoggerFactory.getLogger( FilterRegistry.class );
 
-	// client side address filters
-	private List&lt;IpAddressFilter&gt; clientAddressFilters = new LinkedList&lt;IpAddressFilter&gt;();
-	
-	// server side address filters
-	private List&lt;IpAddressFilter&gt; serverAddressFilters = new LinkedList&lt;IpAddressFilter&gt;();
+    private IpAddressFilter clientAddressFilter = null;
 
-	// client side authentication filters
-	private List&lt;AuthenticationFilter&gt; clientAuthenticationFilters = new LinkedList&lt;AuthenticationFilter&gt;();
-	
-	// client side accounting filter
-	private List&lt;AccountingFilter&gt; clientAccountingFilters = new LinkedList&lt;AccountingFilter&gt;();
-	
-	// server side accounting filter
-	private List&lt;AccountingFilter&gt; serverAccountingFilters = new LinkedList&lt;AccountingFilter&gt;();
-	
-	// client side rewriting filters
-	private List&lt;UrlRewritingFilter&gt; clientUrlRewritingFilters = new LinkedList&lt;UrlRewritingFilter&gt;();
-	
-	// server side rewriting filters
-	private List&lt;UrlRewritingFilter&gt; serverUrlRewritingFilters = new LinkedList&lt;UrlRewritingFilter&gt;();
-	
-	// client side control traffic filters
-	private List&lt;ClientControlFilter&gt; clientControlFilters = new LinkedList&lt;ClientControlFilter&gt;();
-	
-	// client side control traffic filters
-	private List&lt;ServerControlFilter&gt; serverControlFilters = new LinkedList&lt;ServerControlFilter&gt;();
-	
-	/**
-	 * 
-	 */
-	public FilterRegistry() {
-	}
+    private IpAddressFilter serverAddressFilter = null;
 
-	/**
-	 * get the active registry instance
-	 */
-	public static FilterRegistry getInstance() {
-		return (FilterRegistry)Singleton.getInstance(FilterRegistry.class);
-	}
-	
-	// flag to determine if already populated
-	private boolean populated = false;
-	
-	/**
-	 * populate from configuration
-	 */
-	public void populateRegistry() {
-		if(this.populated) {
-			logger.debug(&quot;filter registry already populated&quot;);
-			return;
-		}
-		
-		try {
-			for(AAAConfig filterConfig : Config.getIpAddressFilters()) {
-				IpAddressFilter ipAddressFilter = new IpAddressFilter(filterConfig.getImplClass(), 
-						filterConfig.getConfigElements());
-				
-				ipAddressFilter.setSide(filterConfig.getSide());
-				registerFilterMBean(ipAddressFilter);
+    private AuthenticationFilter authenticationFilter = null;
 
-				if(filterConfig.getSide() == Side.Client) {
-					this.clientAddressFilters.add(ipAddressFilter);
-				} else if(filterConfig.getSide() == Side.Server) {
-					this.serverAddressFilters.add(ipAddressFilter);
-				} else {
-					this.clientAddressFilters.add(ipAddressFilter);
-					this.serverAddressFilters.add(ipAddressFilter);
-				}
-			}
-			
-			for(AAAConfig filterConfig : Config.getAuthenticationFilters()) {
-				if(filterConfig.getSide() == Side.Client) {
-					AuthenticationFilter authFilter = new AuthenticationFilter(filterConfig.getImplClass(), 
-							filterConfig.getAttribute(&quot;scheme&quot;, &quot;Basic&quot;),
-							filterConfig.getConfigElements());
-					
-					authFilter.setSide(filterConfig.getSide());
-					registerFilterMBean(authFilter);
+    private AccountingFilter accountingFilter = null;
 
-					this.clientAuthenticationFilters.add(authFilter);
-				}
-			}
-			
-			for(AAAConfig filterConfig : Config.getAccountingFilters()) {
-				AccountingFilter accountingFilter = new AccountingFilter(filterConfig.getImplClass(), 
-						filterConfig.getConfigElements());
-				
-				accountingFilter.setSide(filterConfig.getSide());
-				registerFilterMBean(accountingFilter);
+    private UrlRewritingFilter clientRewritingFilter = null;
 
-				if(filterConfig.getSide() == Side.Client) {
-					this.clientAccountingFilters.add(accountingFilter);
-				} else if(filterConfig.getSide() == Side.Server) {
-					this.serverAccountingFilters.add(accountingFilter);
-				} else {
-					this.clientAccountingFilters.add(accountingFilter);
-					this.serverAccountingFilters.add(accountingFilter);
-				}
-			}
+    private UrlRewritingFilter serverRewritingFilter = null;
 
-			for(AAAConfig filterConfig : Config.getUrlRewritingFilters()) {
-				UrlRewritingFilter urlRewritingFilter;
-				
-				urlRewritingFilter = new ClientUrlRewritingFilter(filterConfig.getImplClass(), 
-						filterConfig.getConfigElements());			
-				urlRewritingFilter.setSide(Side.Client);
-				registerFilterMBean(urlRewritingFilter);
-				this.clientUrlRewritingFilters.add(urlRewritingFilter);
+    /**
+     * Get the active registry instance
+     */
+    public static FilterRegistry getInstance()
+    {
+        return (FilterRegistry) Singleton.getInstance( FilterRegistry.class );
+    }
 
-				urlRewritingFilter = new ServerUrlRewritingFilter(filterConfig.getImplClass(), 
-						filterConfig.getConfigElements());			
-				urlRewritingFilter.setSide(Side.Server);
-				registerFilterMBean(urlRewritingFilter);
-				this.serverUrlRewritingFilters.add(urlRewritingFilter);
-			}
+    // flag to determine if already populated
+    private boolean populated = false;
 
-			for(AAAConfig filterConfig : Config.getControlFilters()) {
-				if(filterConfig.getSide() == Side.Client) {
-					ClientControlFilter filter = new ClientControlFilter(filterConfig.getImplClass(),
-							filterConfig.getConfigElements());
-					
-					filter.setSide(Side.Client);
-					registerFilterMBean(filter);
-					this.clientControlFilters.add(filter);
-				} else {
-					ServerControlFilter filter = new ServerControlFilter(filterConfig.getImplClass(),
-							filterConfig.getConfigElements());
-					
-					filter.setSide(Side.Client);
-					registerFilterMBean(filter);
-					this.serverControlFilters.add(filter);
-				}
-			}
-			
-		} catch (Throwable t) {
-			logger.error(&quot;failed to populate filter registry&quot;, t);	
-			
-			Reactor.stop();
-			System.exit(-1);
-		}
-		
-		this.populated = true;
-	}
-	
-	private void registerFilterMBean(FilterBase filter) {
-		if(Config.jmxEnable.getValue())
-			JmxAgent.getInstance().registerFilter(filter);
-	}
+    /**
+     * populate from configuration
+     */
+    public void populateRegistry()
+    {
+        log.debug( &quot;Populate filter registry.&quot; );
 
-	/**
-	 * @return Returns the clientAddressFilters.
-	 */
-	public List&lt;IpAddressFilter&gt; getClientAddressFilters() {
-		return Collections.unmodifiableList(clientAddressFilters);
-	}
+        if ( populated ) {
+            log.debug( &quot;Filter registry already populated.&quot; );
+            return;
+        }
 
-	/**
-	 * @return Returns the serverAddressFilters.
-	 */
-	public List&lt;IpAddressFilter&gt; getServerAddressFilters() {
-		return Collections.unmodifiableList(serverAddressFilters);
-	}
+        Configuration config = XMLConfigReader.getConfiguration();
 
-	/**
-	 * @return Returns the clientAuthenticationFilters.
-	 */
-	public List&lt;AuthenticationFilter&gt; getClientAuthenticationFilters() {
-		return Collections.unmodifiableList(clientAuthenticationFilters);
-	}
+        if ( Config.filtersAuthenticationEnable.getValue() ) {
+            authenticationFilter = new AuthenticationFilter();
+            authenticationFilter.configure( config );
+            registerFilterMBean( authenticationFilter );
+        }
 
-	/**
-	 * @return Returns the clientAccountingFilters.
-	 */
-	public List&lt;AccountingFilter&gt; getClientAccountingFilters() {
-		return Collections.unmodifiableList(clientAccountingFilters);
-	}
+        if ( Config.filtersIpAddressEnable.getValue() ) {
+            clientAddressFilter = new IpAddressFilter( Side.Client );
+            clientAddressFilter.configure( config );
+            registerFilterMBean( clientAddressFilter );
 
-	/**
-	 * @return Returns the serverAccountingFilters.
-	 */
-	public List&lt;AccountingFilter&gt; getServerAccountingFilters() {
-		return Collections.unmodifiableList(serverAccountingFilters);
-	}
+            serverAddressFilter = new IpAddressFilter( Side.Server );
+            serverAddressFilter.configure( config );
+            registerFilterMBean( serverAddressFilter );         
+        }
 
-	public List&lt;UrlRewritingFilter&gt; getClientUrlRewritingFilters() {
-		return Collections.unmodifiableList(clientUrlRewritingFilters);
-	}
+        if ( Config.filtersRewriteEnable.getValue() ) {
+            clientRewritingFilter = new UrlRewritingFilter( Side.Client );
+            clientRewritingFilter.configure( config );
+            registerFilterMBean( clientRewritingFilter );
 
-	public List&lt;UrlRewritingFilter&gt; getServerUrlRewritingFilters() {
-		return Collections.unmodifiableList(serverUrlRewritingFilters);
-	}
+            serverRewritingFilter = new UrlRewritingFilter( Side.Server );
+            serverRewritingFilter.configure( config );
+            registerFilterMBean( serverRewritingFilter );
+        }
 
-	/**
-	 * @return Returns the clientControlFilters.
-	 */
-	public List&lt;ClientControlFilter&gt; getClientControlFilters() {
-		return Collections.unmodifiableList(clientControlFilters);
-	}
+        try {
+            // TODO: XXXXX
 
-	/**
-	 * @return Returns the serverControlFilters.
-	 */
-	public List&lt;ServerControlFilter&gt; getServerControlFilters() {
-		return Collections.unmodifiableList(serverControlFilters);
-	}
-	
+        } catch ( Throwable t ) {
+            log.error( &quot;Failed to populate filter registry&quot;, t );
+
+            Reactor.stop();
+        }
+
+        this.populated = true;
+    }
+
+    private void registerFilterMBean( FilterBase filter )
+    {
+        if ( Config.jmxEnable.getValue() )
+            JmxAgent.getInstance().registerFilter( filter );
+    }
+
+    /**
+     * @return the accountingFilter
+     */
+    public AccountingFilter getAccountingFilter()
+    {
+        return accountingFilter;
+    }
+
+    /**
+     * @return the addressFilter
+     */
+    public IpAddressFilter getClientAddressFilter()
+    {
+        return clientAddressFilter;
+    }
+
+    /**
+     * @return the server address filter
+     */
+    public IpAddressFilter getServerAddressFilter()
+    {
+        return serverAddressFilter;
+    }
+
+    /**
+     * @return the authenticationFilter
+     */
+    public AuthenticationFilter getAuthenticationFilter()
+    {
+        return authenticationFilter;
+    }
+
+    /**
+     * @return the rewritingFilter
+     */
+    public UrlRewritingFilter getClientRewritingFilter()
+    {
+        return clientRewritingFilter;
+    }
+
+    /**
+     * @return the rewritingFilter
+     */
+    public UrlRewritingFilter getServerRewritingFilter()
+    {
+        return serverRewritingFilter;
+    }
+
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/FilterRegistry.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProvider.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -3,6 +3,8 @@
  */
 package rtspproxy.filter;
 
+import org.apache.commons.configuration.Configuration;
+
 /**
  * Generic interface used as a parent interface to specific filter provider definitions.
  * 
@@ -17,11 +19,13 @@
 	 * 
 	 * @throws Exception
 	 */
-	public void init() throws Exception;
+	public void start() throws Exception;
 
 	/**
 	 * Called once at service shutdown.
 	 */
-	public void shutdown();
+	public void stop();
+    
+    public void configure( Configuration configuration ) throws Exception;
 
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProvider.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProviderAdapter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProviderAdapter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/GenericProviderAdapter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,27 +0,0 @@
-/**
- * 
- */
-package rtspproxy.filter;
-
-/**
- * Default implementation of the GenericProivder interface. Provides empty default 
- * implementations.
- * 
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
- */
-public class GenericProviderAdapter implements GenericProvider {
-
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.GenericProvider#init()
-	 */
-	public void init() throws Exception {
-	}
-
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.GenericProvider#shutdown()
-	 */
-	public void shutdown() {
-	}
-
-}

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspClientFilters.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspClientFilters.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspClientFilters.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -36,8 +36,8 @@
 		addRtspCodecFilter( chain );
 		addAuthenticationFilter( chain );
 		addRewriteFilter( chain, Side.Client );
-		addAccountingFilter( chain, Side.Client );
-		addControlFilter( chain, Side.Client );
+		addAccountingFilter( chain );
+		addControlFilter( chain );
 	}
 
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspFilters.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -18,8 +18,6 @@
 
 package rtspproxy.filter;
 
-import java.util.List;
-
 import org.apache.mina.common.IoFilter;
 import org.apache.mina.common.IoFilterChain;
 import org.apache.mina.common.IoFilterChainBuilder;
@@ -31,9 +29,6 @@
 import rtspproxy.ProxyServiceRegistry;
 import rtspproxy.filter.accounting.AccountingFilter;
 import rtspproxy.filter.authentication.AuthenticationFilter;
-import rtspproxy.filter.control.ClientControlFilter;
-import rtspproxy.filter.control.ControlFilter;
-import rtspproxy.filter.control.ServerControlFilter;
 import rtspproxy.filter.ipaddress.IpAddressFilter;
 import rtspproxy.filter.rewrite.UrlRewritingFilter;
 import rtspproxy.lib.Side;
@@ -69,7 +64,7 @@
 
     private static final IoFilter codecFilter = new ProtocolCodecFilter( codecFactory );
 
-    public static final String rtspCodecNAME = &quot;rtspCodec&quot;;
+    private static final String rtspCodecNAME = &quot;rtspCodec&quot;;
 
     /**
      * IP Address filter.
@@ -80,20 +75,17 @@
      */
     protected void addIpAddressFilter( IoFilterChain chain, Side side )
     {
-        // XXX: disabled
-        /*
-         * List&lt;IpAddressFilter&gt; filters;
-         * 
-         * if(side == Side.Client) filters =
-         * FilterRegistry.getInstance().getClientAddressFilters(); else filters =
-         * FilterRegistry.getInstance().getServerAddressFilters();
-         * 
-         * for(IpAddressFilter ipAddressFilter : filters) {
-         * 
-         * chain.addAfter( ProxyServiceRegistry.threadPoolFilterNAME,
-         * ipAddressFilter.getChainName(), ipAddressFilter );
-         *  }
-         */
+        IpAddressFilter filter;
+	if ( side == Side.Client )
+		filter = FilterRegistry.getInstance().getClientAddressFilter();
+	else
+		filter = FilterRegistry.getInstance().getServerAddressFilter();
+
+	if ( filter == null )
+		return;
+
+	chain.addAfter( ProxyServiceRegistry.threadPoolFilterNAME, filter.getChainName(),
+                filter );
     }
 
     /**
@@ -110,74 +102,54 @@
      */
     protected void addAuthenticationFilter( IoFilterChain chain )
     {
-        for ( AuthenticationFilter authenticationFilter : FilterRegistry.getInstance()
-                .getClientAuthenticationFilters() ) {
-            chain.addAfter( rtspCodecNAME, authenticationFilter.getChainName(),
-                    authenticationFilter );
-        }
-    }
+        AuthenticationFilter filter = FilterRegistry.getInstance()
+                .getAuthenticationFilter();
 
-    protected void addAccountingFilter( IoFilterChain chain, Side side )
-    {
-        // XXX: disabled
-        /*
-        List&lt;AccountingFilter&gt; filters;
+	if ( filter == null )
+		return;
 
-        if ( side == Side.Client ) {
-            filters = FilterRegistry.getInstance().getClientAccountingFilters();
+        chain.addAfter( rtspCodecNAME, filter.getChainName(), filter );
+    }
 
-            for ( AccountingFilter accountingFilter : filters ) {
-                chain.addAfter( rtspCodecNAME, accountingFilter.getChainName(),
-                        accountingFilter );
-            }
-        } else {
-            filters = FilterRegistry.getInstance().getServerAccountingFilters();
-
-            for ( AccountingFilter accountingFilter : filters ) {
-                chain.addAfter( rtspCodecNAME, accountingFilter.getChainName(),
-                        accountingFilter );
-            }
-        }
-        */
+    protected void addAccountingFilter( IoFilterChain chain )
+    {
+	AccountingFilter filter = FilterRegistry.getInstance().getAccountingFilter();
+    
+	if ( filter == null )
+		return;
+    
+	chain.addAfter( rtspCodecNAME, filter.getChainName(), filter ); 
     }
 
     protected void addRewriteFilter( IoFilterChain chain, Side side )
     {
-        // XXX: disabled
-        /*
-        List&lt;UrlRewritingFilter&gt; filters;
-
-        if ( side == Side.Client )
-            filters = FilterRegistry.getInstance().getClientUrlRewritingFilters();
-        else
-            filters = FilterRegistry.getInstance().getServerUrlRewritingFilters();
-
-        for ( UrlRewritingFilter urlRewritingFilter : filters ) {
-
-            chain.addAfter( rtspCodecNAME, urlRewritingFilter.getChainName(),
-                    urlRewritingFilter );
-        }
-        */
+	UrlRewritingFilter filter;
+	
+	if ( side == Side.Client )
+		filter = FilterRegistry.getInstance().getClientRewritingFilter();
+	else
+		filter = FilterRegistry.getInstance().getServerRewritingFilter();
+	
+	if ( filter == null )
+		return;
+          
+         chain.addAfter( rtspCodecNAME, filter.getChainName(), filter ); 
     }
 
-    protected void addControlFilter( IoFilterChain chain, Side side )
+    protected void addControlFilter( IoFilterChain chain )
     {
-        if ( side == Side.Client ) {
-            List&lt;ClientControlFilter&gt; filters = FilterRegistry.getInstance()
-                    .getClientControlFilters();
-
-            for ( ControlFilter controlFilter : filters ) {
-                chain.addAfter( rtspCodecNAME, controlFilter.getChainName(),
-                        controlFilter );
-            }
-        } else {
-            List&lt;ServerControlFilter&gt; filters = FilterRegistry.getInstance()
-                    .getServerControlFilters();
-
-            for ( ControlFilter controlFilter : filters ) {
-                chain.addAfter( rtspCodecNAME, controlFilter.getChainName(),
-                        controlFilter );
-            }
-        }
+        // XXX: disabled
+        /*
+         * if ( side == Side.Client ) { List&lt;ClientControlFilter&gt; filters =
+         * FilterRegistry.getInstance() .getClientControlFilters();
+         * 
+         * for ( ControlFilter controlFilter : filters ) { chain.addAfter(
+         * rtspCodecNAME, controlFilter.getChainName(), controlFilter ); } }
+         * else { List&lt;ServerControlFilter&gt; filters =
+         * FilterRegistry.getInstance() .getServerControlFilters();
+         * 
+         * for ( ControlFilter controlFilter : filters ) { chain.addAfter(
+         * rtspCodecNAME, controlFilter.getChainName(), controlFilter ); } }
+         */
     }
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspServerFilters.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspServerFilters.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/RtspServerFilters.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -35,8 +35,8 @@
 		addIpAddressFilter( chain, Side.Server );
 		addRtspCodecFilter( chain );
 		addRewriteFilter( chain, Side.Server );
-		addAccountingFilter( chain, Side.Server );
-		addControlFilter ( chain, Side.Server );
+		addAccountingFilter( chain );
+		addControlFilter ( chain );
 	}
 
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,13 +1,11 @@
 package rtspproxy.filter.accounting;
 
-import java.util.List;
-
 import org.apache.mina.common.IdleStatus;
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import rtspproxy.config.Config;
 import rtspproxy.filter.FilterBase;
 import rtspproxy.rtsp.RtspMessage;
 
@@ -15,97 +13,165 @@
  * 
  * @author Matteo Merli
  */
-public class AccountingFilter extends FilterBase
+public class AccountingFilter extends FilterBase&lt;AccountingProvider&gt;
 {
 
-	private static Logger log = LoggerFactory.getLogger( AccountingFilter.class );
+    private static Logger log = LoggerFactory.getLogger( AccountingFilter.class );
 
-	public static final String FilterNAME = &quot;accountingFilter&quot;;
+    public static final String FilterNAME = &quot;accountingFilter&quot;;
 
-	private AccountingProvider provider = null;
+    private AccountingProvider provider = null;
 
-	public AccountingFilter(String className, List&lt;Element&gt; configElements)
-	{
-		super(FilterNAME, className, &quot;accounting&quot;);
-		
-		this.provider = (AccountingProvider)loadConfigInitProvider(className, AccountingProvider.class,
-				configElements);
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getName()
+     */
+    @Override
+    public String getName()
+    {
+        return FilterNAME;
+    }
 
-	@Override
-	public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
-			throws Exception
-	{
-		if ( provider != null &amp;&amp; isRunning()) {
-			if ( message instanceof RtspMessage )
-				provider.messageReceived( session, (RtspMessage) message );
-			else
-				log.error( &quot;Expecting a RtspMessage. Received a &quot;
-						+ message.getClass().getName() );
-		}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#setProvider(rtspproxy.filter.GenericProvider)
+     */
+    @Override
+    public void setProvider( AccountingProvider provider )
+    {
+        this.provider = provider;
+    }
 
-		// Forward message
-		nextFilter.messageReceived( session, message );
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderInterface()
+     */
+    @Override
+    public Class&lt;AccountingProvider&gt; getProviderInterface()
+    {
+        return AccountingProvider.class;
+    }
 
-	@Override
-	public void messageSent( NextFilter nextFilter, IoSession session, Object message )
-			throws Exception
-	{
-		if ( provider != null  &amp;&amp; isRunning()) {
-			if ( message instanceof RtspMessage )
-				provider.messageSent( session, (RtspMessage) message );
-			else
-				log.error( &quot;Expecting a RtspMessage. Received a &quot;
-						+ message.getClass().getName() );
-		}
-		
-		// Forward message
-		nextFilter.messageSent( session, message );
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderClassName()
+     */
+    @Override
+    public String getProviderClassName()
+    {
+        return Config.filtersAccountingImplClass.getValue();
+    }
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionClosed(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession)
-	 */
-	@Override
-	public void sessionClosed(NextFilter nextFilter, IoSession session) throws Exception {
-		if ( provider != null  &amp;&amp; isRunning())
-			provider.sessionClosed( session );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#messageReceived(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession, java.lang.Object)
+     */
+    @Override
+    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() ) {
+            if ( message instanceof RtspMessage )
+                provider.messageReceived( session, (RtspMessage) message );
+            else
+                log.error( &quot;Expecting a RtspMessage. Received a &quot;
+                        + message.getClass().getName() );
+        }
 
-		super.sessionClosed(nextFilter, session);
-	}
+        // Forward message
+        nextFilter.messageReceived( session, message );
+    }
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionCreated(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession)
-	 */
-	@Override
-	public void sessionCreated(NextFilter nextFilter, IoSession session) throws Exception {
-		if ( provider != null &amp;&amp; isRunning() )
-			provider.sessionCreated( session );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#messageSent(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession, java.lang.Object)
+     */
+    @Override
+    public void messageSent( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() ) {
+            if ( message instanceof RtspMessage )
+                provider.messageSent( session, (RtspMessage) message );
+            else
+                log.error( &quot;Expecting a RtspMessage. Received a &quot;
+                        + message.getClass().getName() );
+        }
 
-		super.sessionCreated(nextFilter, session);
-	}
+        // Forward message
+        nextFilter.messageSent( session, message );
+    }
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionIdle(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession, org.apache.mina.common.IdleStatus)
-	 */
-	@Override
-	public void sessionIdle(NextFilter nextFilter, IoSession session, IdleStatus status) throws Exception {
-		if ( provider != null &amp;&amp; isRunning() )
-			provider.sessionIdle( session, status );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionClosed(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionClosed( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() )
+            provider.sessionClosed( session );
 
-		super.sessionIdle(nextFilter, session, status);
-	}
+        super.sessionClosed( nextFilter, session );
+    }
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionOpened(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession)
-	 */
-	@Override
-	public void sessionOpened(NextFilter nextFilter, IoSession session) throws Exception {
-		if ( provider != null &amp;&amp; isRunning() )
-			provider.sessionOpened( session );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionCreated(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionCreated( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() )
+            provider.sessionCreated( session );
 
-		super.sessionOpened(nextFilter, session);
-	}
+        super.sessionCreated( nextFilter, session );
+    }
 
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionIdle(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession, org.apache.mina.common.IdleStatus)
+     */
+    @Override
+    public void sessionIdle( NextFilter nextFilter, IoSession session, IdleStatus status )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() )
+            provider.sessionIdle( session, status );
+
+        super.sessionIdle( nextFilter, session, status );
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionOpened(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionOpened( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        if ( provider != null &amp;&amp; isRunning() )
+            provider.sessionOpened( session );
+
+        super.sessionOpened( nextFilter, session );
+    }
+
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingProviderAdapter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingProviderAdapter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingProviderAdapter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -6,58 +6,80 @@
 import org.apache.mina.common.IdleStatus;
 import org.apache.mina.common.IoSession;
 
-import rtspproxy.filter.GenericProviderAdapter;
 import rtspproxy.rtsp.RtspMessage;
 
 /**
- * Default implementation of the AccountingProvider interface.
- * Provides no-op method implementations.
+ * Default implementation of the AccountingProvider interface. Provides no-op
+ * method implementations.
  * 
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
+ * 
  */
-public class AccountingProviderAdapter extends GenericProviderAdapter implements AccountingProvider {
+public abstract class AccountingProviderAdapter implements AccountingProvider
+{
 
-	/**
-	 * 
-	 */
-	public AccountingProviderAdapter() {
-	}
+    /**
+     * 
+     */
+    public AccountingProviderAdapter()
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#messageReceived(org.apache.mina.common.IoSession, rtspproxy.rtsp.RtspMessage)
-	 */
-	public void messageReceived(IoSession session, RtspMessage message) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#messageReceived(org.apache.mina.common.IoSession,
+     *      rtspproxy.rtsp.RtspMessage)
+     */
+    public void messageReceived( IoSession session, RtspMessage message )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#messageSent(org.apache.mina.common.IoSession, rtspproxy.rtsp.RtspMessage)
-	 */
-	public void messageSent(IoSession session, RtspMessage message) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#messageSent(org.apache.mina.common.IoSession,
+     *      rtspproxy.rtsp.RtspMessage)
+     */
+    public void messageSent( IoSession session, RtspMessage message )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#sessionCreated(org.apache.mina.common.IoSession)
-	 */
-	public void sessionCreated(IoSession session) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#sessionCreated(org.apache.mina.common.IoSession)
+     */
+    public void sessionCreated( IoSession session )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#sessionOpened(org.apache.mina.common.IoSession)
-	 */
-	public void sessionOpened(IoSession session) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#sessionOpened(org.apache.mina.common.IoSession)
+     */
+    public void sessionOpened( IoSession session )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#sessionClosed(org.apache.mina.common.IoSession)
-	 */
-	public void sessionClosed(IoSession session) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#sessionClosed(org.apache.mina.common.IoSession)
+     */
+    public void sessionClosed( IoSession session )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.accounting.AccountingProvider#sessionIdle(org.apache.mina.common.IoSession, org.apache.mina.common.IdleStatus)
-	 */
-	public void sessionIdle(IoSession session, IdleStatus status) {
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.accounting.AccountingProvider#sessionIdle(org.apache.mina.common.IoSession,
+     *      org.apache.mina.common.IdleStatus)
+     */
+    public void sessionIdle( IoSession session, IdleStatus status )
+    {
+    }
 
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/accounting/AccountingProviderAdapter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/AuthenticationFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/AuthenticationFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/AuthenticationFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -18,17 +18,15 @@
 
 package rtspproxy.filter.authentication;
 
-import java.util.Arrays;
 import java.util.HashMap;
-import java.util.List;
 import java.util.Map;
 
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import rtspproxy.Reactor;
+import rtspproxy.config.Config;
 import rtspproxy.filter.FilterBase;
 import rtspproxy.filter.authentication.scheme.AuthenticationScheme;
 import rtspproxy.filter.authentication.scheme.BasicAuthentication;
@@ -42,14 +40,14 @@
 /**
  * @author Matteo Merli
  */
-public class AuthenticationFilter extends FilterBase
+public class AuthenticationFilter extends FilterBase&lt;AuthenticationProvider&gt;
 {
 
     private static Logger log = LoggerFactory.getLogger( AuthenticationFilter.class );
 
-    public static final String FilterNAME = &quot;authenticationFilter&quot;;
+    private static final String FilterNAME = &quot;authenticationFilter&quot;;
 
-    public static final String ATTR = AuthenticationFilter.class.getName() + &quot;Attr&quot;;
+    private static final String ATTR = AuthenticationFilter.class.getName() + &quot;Attr&quot;;
 
     private static final Map&lt;String, Class&gt; schemeRegistry = new HashMap&lt;String, Class&gt;();
 
@@ -59,33 +57,30 @@
         schemeRegistry.put( &quot;digest&quot;, DigestAuthentication.class );
     }
 
-    /**
-     * Backend provider.
-     */
+    /** Backend provider. */
     private AuthenticationProvider provider;
 
     /** Different authentication schemes implementation */
     private AuthenticationScheme scheme = null;
 
+	public static String getAttrName()
+	{
+		return ATTR;
+	}
+
     /**
      * Construct a new AuthenticationFilter. Looks at the configuration to load
      * the choseen backend implementation.
      */
-    public AuthenticationFilter( String className, String schemeName,
-            List&lt;Element&gt; configElements )
+    public AuthenticationFilter()
     {
-        super( FilterNAME, className, &quot;authentication&quot; );
-
-        this.provider = (AuthenticationProvider) loadConfigInitProvider( className,
-                AuthenticationProvider.class, configElements );
-
         // Validate the choosen authentication scheme
+        String schemeName = Config.filtersAuthenticationScheme.getValue();
         Class schemeClass = schemeRegistry.get( schemeName.toLowerCase() );
         if ( schemeClass == null ) {
             // scheme not found
-            log.error( &quot;Authentication Scheme not found: &quot; + schemeName
-                    + &quot;. Valid values are: &quot;
-                    + Arrays.toString( schemeRegistry.keySet().toArray() ) );
+            log.error( &quot;Authentication Scheme not found: {}. Valid values are: {}&quot;,
+                    schemeName, schemeRegistry.keySet() );
             Reactor.stop();
             return;
         }
@@ -94,85 +89,129 @@
         try {
             scheme = (AuthenticationScheme) schemeClass.newInstance();
         } catch ( Exception e ) {
+            log.error( &quot;Error instanciating class: {}&quot;, schemeClass );
         }
+    }
 
-        log.info( &quot;Using AuthenticationFilter &quot; + scheme.getName() + &quot; (&quot; + className
-                + &quot;)&quot; );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getName()
+     */
+    @Override
+    public String getName()
+    {
+        return FilterNAME;
     }
 
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderClassName()
+     */
     @Override
-    public void messageReceived( final NextFilter nextFilter, final IoSession session,
-            final Object message ) throws Exception
+    public String getProviderClassName()
     {
+        return Config.filtersAuthenticationImplClass.getValue();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderInterface()
+     */
+    @Override
+    protected Class&lt;AuthenticationProvider&gt; getProviderInterface()
+    {
+        return AuthenticationProvider.class;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#setProvider(rtspproxy.filter.GenericProvider)
+     */
+    @Override
+    protected void setProvider( AuthenticationProvider provider )
+    {
+        this.provider = provider;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#messageReceived(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession, java.lang.Object)
+     */
+    @Override
+    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
         if ( !(message instanceof RtspRequest) ) {
             // Shouldn't happen
-            log.warn( &quot;Object message is not a RTSP message&quot; );
+            log.warn( &quot;Object message is not a RTSP request&quot; );
             return;
         }
 
-        if ( isRunning() ) {
-            if ( session.getAttribute( ATTR ) != null ) {
-                // Client already autheticated
-                log.debug( &quot;Already authenticaed: {}&quot;, session.getAttribute( ATTR ) );
-                nextFilter.messageReceived( session, message );
-            }
+        if ( session.getAttribute( ATTR ) != null ) {
+            // Client already autheticated
+            log.debug( &quot;Already authenticaed: {}&quot;, session.getAttribute( ATTR ) );
+            nextFilter.messageReceived( session, message );
+        }
 
-            final String authString = ((RtspMessage) message)
-                    .getHeader( &quot;Proxy-Authorization&quot; );
-            if ( authString == null ) {
-                log.debug( &quot;RTSP message: \n{}&quot;, message );
-                final RtspResponse response = RtspResponse
-                        .errorResponse( RtspCode.ProxyAuthenticationRequired );
-                
-                response.setHeader( &quot;Proxy-Authenticate&quot;, scheme.getName() + &quot; &quot;
-                        + scheme.getChallenge() );
+        String authString = ((RtspMessage) message).getHeader( &quot;Proxy-Authorization&quot; );
 
-                log.debug( &quot;Sending RTSP message: \n{}&quot;, response );
+        if ( authString == null ) {
+            log.debug( &quot;RTSP message: \n{}&quot;, message );
+            final RtspResponse response = RtspResponse
+                    .errorResponse( RtspCode.ProxyAuthenticationRequired );
 
-                session.write( response );
-                return;
-            }
+            response.setHeader( &quot;Proxy-Authenticate&quot;, scheme.getName() + &quot; &quot;
+                    + scheme.getChallenge() );
 
-            if ( !validateAuthenticationScheme( authString ) ) {
-                final RtspResponse response = RtspResponse
-                        .errorResponse( RtspCode.BadRequest );
+            log.debug( &quot;Client MUST athenticate to Proxy: \n{}&quot;, response );
+            session.write( response );
+            return;
+        }
 
-                session.write( response );
-                return;
-            }
+        if ( !validateAuthenticationScheme( authString ) ) {
+            log.debug( &quot;Authentication scheme not valid: {}&quot;, authString );
+            RtspResponse response = RtspResponse.errorResponse( RtspCode.BadRequest );
+            session.write( response );
+            return;
+        }
 
-            log.debug( &quot;RTSP message: \n{}&quot;, message );
+        log.debug( &quot;RTSP message: \n{}&quot;, message );
 
-            // Check the authentication credentials
-            final Credentials credentials = scheme.getCredentials( (RtspMessage) message );
+        // Check the authentication credentials
+        final Credentials credentials = scheme.getCredentials( (RtspMessage) message );
 
-            boolean authenticationOk = false;
-            if ( credentials != null ) {
-                final String password = provider.getPassword( credentials.getUserName() );
-                if ( password != null )
-                    if ( scheme.computeAuthentication( credentials, password ) == true )
-                        authenticationOk = true;
+        boolean authenticationOk = false;
+        if ( credentials != null ) {
+            String password = provider.getPassword( credentials.getUserName() );
+            if ( password != null &amp;&amp; scheme.computeAuthentication( credentials, password ) ) {
+                authenticationOk = true;
             }
+        }
 
-            if ( !authenticationOk ) {
-                log.warn( &quot;Authentication failed for user: {}&quot;, credentials );
-                final RtspResponse response = RtspResponse
-                        .errorResponse( RtspCode.ProxyAuthenticationRequired );
-                response.setHeader( &quot;Proxy-Authenticate&quot;, scheme.getName() + &quot; &quot;
-                        + scheme.getChallenge() );
+        if ( !authenticationOk ) {
+            log.info( &quot;Authentication failed for user: {}&quot;, credentials );
+            RtspResponse response = RtspResponse
+                    .errorResponse( RtspCode.ProxyAuthenticationRequired );
+            response.setHeader( &quot;Proxy-Authenticate&quot;, scheme.getName() + &quot; &quot;
+                    + scheme.getChallenge() );
 
-                session.write( response );
-                return;
-            }
+            session.write( response );
+            return;
+        }
 
-            log.debug( &quot;Authentication succesfull for user: {}&quot;, credentials );
+        log.debug( &quot;Authentication successfull for user: {}&quot;, credentials );
 
-            /*
-             * Mark the session with an &quot;authenticated&quot; attribute. This will
-             * prevent the check for the credentials for every message received.
-             */
-            session.setAttribute( ATTR, credentials.getUserName() );
-        }
+        /*
+         * Mark the session with an &quot;authenticated&quot; attribute. This will prevent
+         * the check for the credentials for every message received.
+         */
+        session.setAttribute( ATTR, credentials.getUserName() );
 
         // Forward message
         nextFilter.messageReceived( session, message );
@@ -182,7 +221,7 @@
      * Gets the authentication scheme stated by the client.
      * 
      * @param authString
-     * @return
+     * @return true if the authentication scheme selected is valid
      */
     private boolean validateAuthenticationScheme( String authString )
     {

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme/BasicAuthentication.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme/BasicAuthentication.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme/BasicAuthentication.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -36,8 +36,10 @@
 
 	private static Logger log = LoggerFactory.getLogger( BasicAuthentication.class );
 
-	private String realm;
+	private static final String NAME = &quot;Basic&quot;;
 
+	private final String realm;
+
 	public BasicAuthentication()
 	{
 		// Initiazialize the realm string
@@ -47,7 +49,7 @@
 
 	public String getName()
 	{
-		return &quot;Basic&quot;;
+		return NAME;
 	}
 
 	public Credentials getCredentials( RtspMessage message )

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ClientControlFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ClientControlFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ClientControlFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,67 +0,0 @@
-/**
- * 
- */
-package rtspproxy.filter.control;
-
-import java.util.List;
-
-import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import rtspproxy.rtsp.RtspRequest;
-import rtspproxy.rtsp.RtspResponse;
-
-/**
- * control filter to be applied on the client side.
- * 
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
- */
-public class ClientControlFilter extends ControlFilter {
-
-	private static Logger log = LoggerFactory.getLogger(ClientControlFilter.class);
-
-	/**
-	 * @param className
-	 * @param configElements
-	 * @param typeName
-	 */
-	public ClientControlFilter(String className, List&lt;Element&gt; configElements) {
-		super(className, configElements, &quot;clientControl&quot;);
-	}
-
-	@Override
-	public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
-			throws Exception
-	{
-		if ( provider != null &amp;&amp; isRunning()) {
-			if ( message instanceof RtspRequest )
-				provider.processRequest(session, (RtspRequest)message);
-			else
-				log.error( &quot;Expecting a RtspRequest. Received a &quot;
-						+ message.getClass().getName() );
-		}
-
-		// Forward message
-		nextFilter.messageReceived( session, message );
-	}
-
-	@Override
-	public void messageSent( NextFilter nextFilter, IoSession session, Object message )
-			throws Exception
-	{
-		if ( provider != null  &amp;&amp; isRunning()) {
-			if(message instanceof RtspResponse)
-				provider.processResponse(session, (RtspResponse)message);
-			else
-				log.error( &quot;Expecting a RtspResponse. Received a &quot;
-						+ message.getClass().getName() );
-		}
-		
-		// Forward message
-		nextFilter.messageSent( session, message );
-	}
-
-}

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -5,52 +5,98 @@
 
 import java.util.List;
 
+import org.apache.commons.configuration.Configuration;
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 import rtspproxy.filter.FilterBase;
+import rtspproxy.lib.Side;
+import rtspproxy.rtsp.RtspRequest;
+import rtspproxy.rtsp.RtspResponse;
 
 /**
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
+ * 
  */
-public class ControlFilter extends FilterBase 
-{	
-	public static final String FilterNAME = &quot;controlFilter&quot;;
+public class ControlFilter extends FilterBase&lt;ControlProvider&gt;
+{
 
-	protected ControlProvider provider;
-	
-	/**
-	 * @param filterName
-	 * @param className
-	 * @param typeName
-	 */
-	protected ControlFilter(String className, List&lt;Element&gt; configElements, String typeName) {
-		super(FilterNAME, className, typeName);
-		
-		this.provider = (ControlProvider)loadConfigInitProvider(className, ControlProvider.class, configElements);
-	}
+    private static Logger log = LoggerFactory.getLogger( ControlFilter.class );
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionClosed(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession)
-	 */
-	@Override
-	public void sessionClosed(NextFilter nextFilter, IoSession session) throws Exception {
-		if ( provider != null  &amp;&amp; isRunning())
-			provider.sessionClosed( session );
+    public static final String FilterNAME = &quot;controlFilter&quot;;
 
-		nextFilter.sessionClosed(session);
-	}
+    private List&lt;ControlProvider&gt; providers;
 
-	/* (non-Javadoc)
-	 * @see org.apache.mina.common.IoFilterAdapter#sessionOpened(org.apache.mina.common.IoFilter.NextFilter, org.apache.mina.common.IoSession)
-	 */
-	@Override
-	public void sessionOpened(NextFilter nextFilter, IoSession session) throws Exception {
-		if ( provider != null &amp;&amp; isRunning() )
-			provider.sessionOpened( session );
+    private Side side = Side.Client;
 
-		nextFilter.sessionOpened(session);
-	}
+    @Override
+    public String getName()
+    {
+        return FilterNAME;
+    }
 
+    public ControlFilter( Side side )
+    {
+        this.side = side;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionClosed(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionClosed( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        for ( ControlProvider provider : providers )
+            provider.sessionClosed( session );
+
+        nextFilter.sessionClosed( session );
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionOpened(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionOpened( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        for ( ControlProvider provider : providers )
+            provider.sessionOpened( session );
+
+        nextFilter.sessionOpened( session );
+    }
+
+    @Override
+    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
+        if ( message instanceof RtspRequest ) {
+            for ( ControlProvider provider : providers )
+                provider.receivedRequest( session, (RtspRequest) message );
+        } else if ( message instanceof RtspResponse ) {
+            for ( ControlProvider provider : providers )
+                provider.receivedResponse( session, (RtspResponse) message );
+        } else {
+            log.error( &quot;Expecting a RtspRequest. Received a {}&quot;, message.getClass()
+                    .getName() );
+        }
+
+        // Forward message
+        nextFilter.messageReceived( session, message );
+    }
+
+    @Override
+    public void doConfigure( Configuration configuration )
+    {
+        log.debug( &quot;Configuring control filter.&quot; );
+        // TODO: implement it!
+    }
+
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlFilter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProvider.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -26,20 +26,25 @@
 	/**
 	 * process a request
 	 */
-	public void processRequest(IoSession session, RtspRequest request);
+	public void receivedRequest( IoSession session, RtspRequest request );
+
+	public void sendRequest( IoSession session, RtspRequest request );
 	
 	/**
 	 * process a response
 	 */
-	public void processResponse(IoSession session, RtspResponse response);
+	public void receivedResponse( IoSession session, RtspResponse response );
+
+	public void sendResponse( IoSession session, RtspResponse response );
 	
 	/**
 	 * session gets opened
 	 */
-	public void sessionOpened(IoSession session);
+	public void sessionOpened( IoSession session );
 	
 	/**
 	 * session gets closed
 	 */
-	public void sessionClosed(IoSession session);
+	public void sessionClosed( IoSession session );
+	
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProvider.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProviderAdapter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProviderAdapter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProviderAdapter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -9,60 +9,69 @@
 import rtspproxy.rtsp.RtspResponse;
 
 /**
- * Default implementation of the ControlProvider interface. All method bodies are empty and
- * do nothing. 
+ * Default implementation of the ControlProvider interface. All method bodies
+ * are empty and do nothing.
  * 
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
+ * 
  */
-public class ControlProviderAdapter implements ControlProvider {
+public abstract class ControlProviderAdapter implements ControlProvider
+{
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.control.ControlProvider#processRequest(org.apache.mina.common.IoSession, rtspproxy.rtsp.RtspRequest)
-	 */
-	public void processRequest(IoSession session, RtspRequest request) {
-		// TODO Auto-generated method stub
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.control.ControlProvider#processRequest(org.apache.mina.common.IoSession,
+     *      rtspproxy.rtsp.RtspRequest)
+     */
+    public void processRequest( IoSession session, RtspRequest request )
+    {
+    }
 
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.control.ControlProvider#processResponse(org.apache.mina.common.IoSession,
+     *      rtspproxy.rtsp.RtspResponse)
+     */
+    public void processResponse( IoSession session, RtspResponse response )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.control.ControlProvider#processResponse(org.apache.mina.common.IoSession, rtspproxy.rtsp.RtspResponse)
-	 */
-	public void processResponse(IoSession session, RtspResponse response) {
-		// TODO Auto-generated method stub
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.control.ControlProvider#sessionOpened(org.apache.mina.common.IoSession)
+     */
+    public void sessionOpened( IoSession session )
+    {
+    }
 
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.control.ControlProvider#sessionClosed(org.apache.mina.common.IoSession)
+     */
+    public void sessionClosed( IoSession session )
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.control.ControlProvider#sessionOpened(org.apache.mina.common.IoSession)
-	 */
-	public void sessionOpened(IoSession session) {
-		// TODO Auto-generated method stub
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#init()
+     */
+    public void start() throws Exception
+    {
+    }
 
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.GenericProvider#shutdown()
+     */
+    public void stop()
+    {
+    }
 
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.control.ControlProvider#sessionClosed(org.apache.mina.common.IoSession)
-	 */
-	public void sessionClosed(IoSession session) {
-		// TODO Auto-generated method stub
-
-	}
-
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.GenericProvider#init()
-	 */
-	public void init() throws Exception {
-		// TODO Auto-generated method stub
-
-	}
-
-	/* (non-Javadoc)
-	 * @see rtspproxy.filter.GenericProvider#shutdown()
-	 */
-	public void shutdown() {
-		// TODO Auto-generated method stub
-
-	}
-
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ControlProviderAdapter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ServerControlFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ServerControlFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/control/ServerControlFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,67 +0,0 @@
-/**
- * 
- */
-package rtspproxy.filter.control;
-
-import java.util.List;
-
-import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import rtspproxy.rtsp.RtspRequest;
-import rtspproxy.rtsp.RtspResponse;
-
-/**
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- * 
- */
-public class ServerControlFilter extends ControlFilter
-{
-
-    private static Logger log = LoggerFactory.getLogger( ClientControlFilter.class );
-
-    /**
-     * @param className
-     * @param configElements
-     * @param typeName
-     */
-    public ServerControlFilter( String className, List&lt;Element&gt; configElements )
-    {
-        super( className, configElements, &quot;serverControl&quot; );
-    }
-
-    @Override
-    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
-            throws Exception
-    {
-        if ( provider != null &amp;&amp; isRunning() ) {
-            if ( message instanceof RtspResponse )
-                provider.processResponse( session, (RtspResponse) message );
-            else
-                log.error( &quot;Expecting a RtspResponse. Received a {}&quot;, message.getClass()
-                        .getName() );
-        }
-
-        // Forward message
-        nextFilter.messageReceived( session, message );
-    }
-
-    @Override
-    public void messageSent( NextFilter nextFilter, IoSession session, Object message )
-            throws Exception
-    {
-        if ( provider != null &amp;&amp; isRunning() ) {
-            if ( message instanceof RtspRequest )
-                provider.processRequest( session, (RtspRequest) message );
-            else
-                log.error( &quot;Expecting a Rtsprequest. Received a {}&quot;,
-                        message.getClass().getName() );
-        }
-
-        // Forward message
-        nextFilter.messageSent( session, message );
-    }
-
-}

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -19,69 +19,126 @@
 package rtspproxy.filter.ipaddress;
 
 import java.net.InetSocketAddress;
-import java.util.List;
 
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import rtspproxy.config.Config;
 import rtspproxy.filter.FilterBase;
+import rtspproxy.lib.Side;
 
 /**
  * @author Matteo Merli
- *
+ * 
  */
-public class IpAddressFilter extends FilterBase
+public class IpAddressFilter extends FilterBase&lt;IpAddressProvider&gt;
 {
 
-	private static Logger log = LoggerFactory.getLogger( IpAddressFilter.class );
-	
-	public static final String FilterNAME = &quot;ipAddressFilter&quot;;
+    private static Logger log = LoggerFactory.getLogger( IpAddressFilter.class );
 
-	private IpAddressProvider provider;
+    private static final String FilterNAME = &quot;ipAddressFilter&quot;;
 
-	public IpAddressFilter(String className, List&lt;Element&gt; configElements)
-	{
-		super(FilterNAME, className, &quot;ipaddress&quot;);
-		
-		this.provider = (IpAddressProvider)loadConfigInitProvider(className, IpAddressProvider.class,
-				configElements);
-	}
+    private IpAddressProvider provider = null;
 
-	@Override
-	public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
-			throws Exception
-	{
-		if(!isRunning()) {
-			// forward because filter is suspended
-			nextFilter.messageReceived( session, message );			
-		} else if ( !provider.isBlocked( ( (InetSocketAddress) session.getRemoteAddress() ).getAddress() ) ) {
-			// forward if not blocked
-			nextFilter.messageReceived( session, message );
-		} else {
-			blockSession( session );
-		}
-	}
+    private Side side = Side.Client;
 
-	@Override
-	public void sessionCreated( NextFilter nextFilter, IoSession session )
-			throws Exception
-	{
-		if(!isRunning()) {
-			// forward because filter is suspended
-			nextFilter.sessionCreated( session );
-		} else if ( !provider.isBlocked( ( (InetSocketAddress) session.getRemoteAddress() ).getAddress() ) ) {
-			// forward if not blocked
-			nextFilter.sessionCreated( session );
-		} else {
-			blockSession( session );
-		}
-	}
+    public IpAddressFilter( Side side )
+    {
+	this.side = side;
+    }
 
-	protected void blockSession( IoSession session )
-	{
-		log.info( &quot;Blocked connection from : &quot; + session.getRemoteAddress() );
-		session.close();
-	}
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getName()
+     */
+    @Override
+    public String getName()
+    {
+        return FilterNAME;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderClassName()
+     */
+    @Override
+    public String getProviderClassName()
+    {
+        return Config.filtersIpAddressImplClass.getValue();
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderInterface()
+     */
+    @Override
+    protected Class&lt;IpAddressProvider&gt; getProviderInterface()
+    {
+        return IpAddressProvider.class;
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#setProvider(rtspproxy.filter.GenericProvider)
+     */
+    @Override
+    protected void setProvider( IpAddressProvider provider )
+    {
+        this.provider = provider;
+	this.provider.setSide( side );
+    }
+
+    @Override
+    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
+	log.debug( &quot;Testing address: {}&quot;, session.getRemoteAddress() );
+
+        if ( !isRunning() ) {
+            // forward because filter is suspended
+            nextFilter.messageReceived( session, message );
+
+        } else if ( !provider.isBlocked( ((InetSocketAddress) session.getRemoteAddress())
+                .getAddress() ) ) {
+            // forward if not blocked
+            nextFilter.messageReceived( session, message );
+
+        } else {
+            blockSession( session );
+        }
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see org.apache.mina.common.IoFilterAdapter#sessionCreated(org.apache.mina.common.IoFilter.NextFilter,
+     *      org.apache.mina.common.IoSession)
+     */
+    @Override
+    public void sessionCreated( NextFilter nextFilter, IoSession session )
+            throws Exception
+    {
+        if ( !isRunning() ) {
+            // forward because filter is suspended
+            nextFilter.sessionCreated( session );
+            
+        } else if ( !provider.isBlocked( ((InetSocketAddress) session.getRemoteAddress())
+                .getAddress() ) ) {
+            // forward if not blocked
+            nextFilter.sessionCreated( session );
+        } else {
+            blockSession( session );
+        }
+    }
+
+    protected void blockSession( IoSession session )
+    {
+        log.info( &quot;Blocked connection from : {}&quot;, session.getRemoteAddress() );
+        session.close();
+    }
 }

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressProvider.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/ipaddress/IpAddressProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -21,12 +21,15 @@
 import java.net.InetAddress;
 
 import rtspproxy.filter.GenericProvider;
+import rtspproxy.lib.Side;
 
 /**
  * @author Matteo Merli
  */
 public interface IpAddressProvider extends GenericProvider
 {
+    
+    public void setSide( Side side );
 
 	public boolean isBlocked( InetAddress address );
 	

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ClientUrlRewritingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ClientUrlRewritingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ClientUrlRewritingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,64 +0,0 @@
-/**
- * 
- */
-package rtspproxy.filter.rewrite;
-
-import java.util.List;
-
-import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import rtspproxy.rtsp.RtspMessage;
-import rtspproxy.rtsp.RtspRequest;
-
-/**
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
- */
-public class ClientUrlRewritingFilter extends UrlRewritingFilter {
-
-	/**
-	 * Logger for this class
-	 */
-	private static final Logger logger = LoggerFactory.getLogger(ClientUrlRewritingFilter.class);
-
-	public ClientUrlRewritingFilter(String className, List&lt;Element&gt; configElements) throws Exception {
-		super(className, configElements);
-	}
-
-	/*
-	 * (non-Javadoc)
-	 * 
-	 * @see org.apache.mina.common.IoFilterAdapter#messageReceived(org.apache.mina.common.IoFilter.NextFilter,
-	 *      org.apache.mina.common.IoSession, java.lang.Object)
-	 */
-	@Override
-	public void messageReceived(NextFilter nextFilter, IoSession session,
-			Object message) throws Exception {
-		boolean passOn = true;
-		
-		logger.debug(&quot;Received (pre-rewriting) message:\n&quot; + message);
-
-		if (isRunning()) {
-			if (message instanceof RtspMessage) {
-				RtspMessage rtspMessage = (RtspMessage) message;
-
-				if (rtspMessage.getType() == RtspMessage.Type.TypeRequest)
-					passOn = processRequest(session, (RtspRequest)rtspMessage);
-			} else {
-					logger.error(&quot;Expecting a RtspMessage. Received a &quot;
-						+ message.getClass().getName());
-			}
-
-		}
-		if(passOn) {
-			logger.debug(&quot;Sent (post-rewriting) message:\n&quot; + message);
-
-			nextFilter.messageReceived(session, message);
-		}
-	}
-
-
-}

Deleted: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ServerUrlRewritingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ServerUrlRewritingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/ServerUrlRewritingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,61 +0,0 @@
-/**
- * 
- */
-package rtspproxy.filter.rewrite;
-
-import java.util.List;
-
-import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import rtspproxy.rtsp.RtspMessage;
-import rtspproxy.rtsp.RtspResponse;
-
-/**
- * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
- */
-public class ServerUrlRewritingFilter extends UrlRewritingFilter {
-
-	/**
-	 * Logger for this class
-	 */
-	private static final Logger logger = LoggerFactory.getLogger(ServerUrlRewritingFilter.class);
-
-	/**
-	 * 
-	 */
-	public ServerUrlRewritingFilter(String className, List&lt;Element&gt; configElements) throws Exception {
-		super(className, configElements);
-	}
-	
-	/*
-	 * (non-Javadoc)
-	 * 
-	 * @see org.apache.mina.common.IoFilterAdapter#messageReceived(org.apache.mina.common.IoFilter.NextFilter,
-	 *      org.apache.mina.common.IoSession, java.lang.Object)
-	 */
-	@Override
-	public void messageReceived(NextFilter nextFilter, IoSession session,
-			Object message) throws Exception {
-		logger.debug(&quot;Received (pre-rewriting) message:\n&quot; + message);
-
-		if (isRunning()) {
-			if (message instanceof RtspMessage) {
-				RtspMessage rtspMessage = (RtspMessage) message;
-
-				if (rtspMessage.getType() == RtspMessage.Type.TypeResponse)
-					processResponse((RtspResponse) rtspMessage);
-			} else {
-					logger.error(&quot;Expecting a RtspMessage. Received a &quot;
-						+ message.getClass().getName());
-			}
-			logger.debug(&quot;Sent (post-rewriting) message:\n&quot; + message);
-
-		}
-		nextFilter.messageReceived(session, message);
-	}
-
-}

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -6,20 +6,22 @@
 import java.net.MalformedURLException;
 import java.net.URL;
 import java.util.HashMap;
-import java.util.List;
+import java.util.Map;
 
 import javax.management.MBeanServer;
 import javax.management.ObjectName;
 
 import org.apache.mina.common.IoSession;
-import org.dom4j.Element;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import rtspproxy.config.Config;
 import rtspproxy.filter.FilterBase;
 import rtspproxy.jmx.JmxManageable;
 import rtspproxy.jmx.JmxManageable2;
+import rtspproxy.lib.Side;
 import rtspproxy.proxy.ProxyHandler;
+import rtspproxy.rtsp.RtspMessage;
 import rtspproxy.rtsp.RtspRequest;
 import rtspproxy.rtsp.RtspResponse;
 
@@ -27,43 +29,81 @@
  * @author bieniekr
  * 
  */
-public abstract class UrlRewritingFilter extends FilterBase implements JmxManageable
+public class UrlRewritingFilter extends FilterBase&lt;UrlRewritingProvider&gt;
 {
 
-    /**
-     * Logger for this class
-     */
+    /** Logger for this class */
     private static Logger log = LoggerFactory.getLogger( UrlRewritingFilter.class );
 
-    public static final String FilterNAME = &quot;rewriting&quot;;
+    private static final String FilterNAME = &quot;rewriting&quot;;
 
-    // the filter instance
-    protected UrlRewritingProvider provider;
+    /** the filter backend instance */
+    private UrlRewritingProvider provider;
 
     // list of exposed session attributes
     private String[] exposedAttributes;
 
+    private Side side;
+
     /**
      * construct the IoFilter around the filter class denoted by the clazz name
      * parameter.
      */
-    public UrlRewritingFilter( String className, List&lt;Element&gt; configElements )
-            throws Exception
+    public UrlRewritingFilter( Side side )
     {
-        super( FilterNAME, className, &quot;rewriting&quot; );
+        this.side = side;
+        // this.exposedAttributes = this.provider.getWantedSessionAttributes();
+        // if ( this.exposedAttributes == null )
+        this.exposedAttributes = new String[0];
+    }
 
-        this.provider = (UrlRewritingProvider) loadConfigInitProvider( className,
-                UrlRewritingProvider.class, configElements );
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getName()
+     */
+    @Override
+    public String getName()
+    {
+        return FilterNAME;
+    }
 
-        this.exposedAttributes = this.provider.getWantedSessionAttributes();
-        if ( this.exposedAttributes == null )
-            this.exposedAttributes = new String[0];
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#setProvider(rtspproxy.filter.GenericProvider)
+     */
+    @Override
+    public void setProvider( UrlRewritingProvider provider )
+    {
+        this.provider = provider;
+        exposedAttributes = provider.getWantedSessionAttributes();
+        if ( exposedAttributes == null )
+            exposedAttributes = new String[0];
     }
 
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderInterface()
+     */
     @Override
-    public abstract void messageReceived( NextFilter nextFilter, IoSession session,
-            Object message ) throws Exception;
+    public Class&lt;UrlRewritingProvider&gt; getProviderInterface()
+    {
+        return UrlRewritingProvider.class;
+    }
 
+    /*
+     * (non-Javadoc)
+     * 
+     * @see rtspproxy.filter.FilterBase#getProviderClassName()
+     */
+    @Override
+    public String getProviderClassName()
+    {
+        return Config.filtersRewriteImplClass.getValue();
+    }
+
     /**
      * process a request message
      * 
@@ -75,7 +115,7 @@
         boolean passOn = true;
 
         if ( req.getUrl() != null ) {
-            HashMap&lt;String, Object&gt; exposedSessionAttributes = new HashMap&lt;String, Object&gt;();
+            Map&lt;String, Object&gt; exposedSessionAttributes = new HashMap&lt;String, Object&gt;();
 
             for ( String attr : this.exposedAttributes ) {
                 log.debug( &quot;exposing session attribute: {}&quot;, attr );
@@ -141,6 +181,39 @@
         }
     }
 
+    @Override
+    public void messageReceived( NextFilter nextFilter, IoSession session, Object message )
+            throws Exception
+    {
+        boolean passOn = true;
+
+        log.debug( &quot;Received (pre-rewriting) message:\n{}&quot;, message );
+
+        if ( isRunning() ) {
+            if ( message instanceof RtspMessage ) {
+                RtspMessage rtspMessage = (RtspMessage) message;
+
+                if ( side == Side.Client
+                        &amp;&amp; rtspMessage.getType() == RtspMessage.Type.TypeRequest )
+                    passOn = processRequest( session, (RtspRequest) rtspMessage );
+
+                else if ( side == Side.Server
+                        &amp;&amp; rtspMessage.getType() == RtspMessage.Type.TypeResponse )
+                    processResponse( (RtspResponse) rtspMessage );
+
+            } else {
+                log.error( &quot;Expecting a RtspMessage. Received a {}&quot;, //
+                        message.getClass().getName() );
+            }
+
+        }
+
+        if ( passOn ) {
+            log.debug( &quot;Sent (post-rewriting) message:\n{}&quot;, message );
+            nextFilter.messageReceived( session, message );
+        }
+    }
+
     /**
      * rewrite a header
      */


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingFilter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingProvider.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingProvider.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingProvider.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -10,9 +10,9 @@
  ***************************************************************************/
 
 /*
- * $Id: Handler.java 248 2005-10-23 18:47:41Z merlimat $
+ * $Id$
  * 
- * $URL: <A HREF="https://rbieniek@svn.berlios.de/svnroot/repos/rtspproxy/trunk/src/main/java/rtspproxy/rtsp/Handler.java">https://rbieniek@svn.berlios.de/svnroot/repos/rtspproxy/trunk/src/main/java/rtspproxy/rtsp/Handler.java</A> $
+ * $URL$
  * 
  */
 package rtspproxy.filter.rewrite;
@@ -25,28 +25,35 @@
 import rtspproxy.rtsp.RtspRequest;
 
 /**
- * This filter is used to rewrite the requested URL before passing it
- * to the upstream server.
+ * This filter is used to rewrite the requested URL before passing it to the
+ * upstream server.
  * 
  * @author Rainer Bieniek
  */
-public interface UrlRewritingProvider extends GenericProvider {
-	/**
-	 * rewrite the request URL.
-	 * @return a result object which can contain a modified result URL or a response message
-	 * sent back to the client. If null is returned, the URL is passed on without modification.
-	 */
-	public UrlRewritingResult rewriteRequestUrl(URL request, RtspRequest.Verb verb, SocketAddress client,
-			Map&lt;String, String&gt; requestHeaders, Map&lt;String, Object&gt; sessionAttributes);
+public interface UrlRewritingProvider extends GenericProvider
+{
 
-	/**
-	 * rewrite an URL in a response header.
-	 * @return a replacement URL or null if the URL is not to be modified.
-	 */
-	public URL rewriteResponseHeaderUrl(URL request);
-	
-	/**
-	 * get a list of session attributes the filter wants to get exposed from the session
-	 */
-	public String[] getWantedSessionAttributes();
+    /**
+     * rewrite the request URL.
+     * 
+     * @return a result object which can contain a modified result URL or a
+     *         response message sent back to the client. If null is returned,
+     *         the URL is passed on without modification.
+     */
+    public UrlRewritingResult rewriteRequestUrl( URL request, RtspRequest.Verb verb,
+            SocketAddress client, Map&lt;String, String&gt; requestHeaders,
+            Map&lt;String, Object&gt; sessionAttributes );
+
+    /**
+     * rewrite an URL in a response header.
+     * 
+     * @return a replacement URL or null if the URL is not to be modified.
+     */
+    public URL rewriteResponseHeaderUrl( URL request );
+
+    /**
+     * get a list of session attributes the filter wants to get exposed from the
+     * session
+     */
+    public String[] getWantedSessionAttributes();
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingProvider.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite/UrlRewritingResult.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionClientTrackingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionClientTrackingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionClientTrackingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -24,14 +24,6 @@
 	// session attribute
 	private static final String SessionAttribute = &quot;lastSetupURL&quot;;
 
-	/**
-	 * @param filterName
-	 * @param typeName
-	 */
-	public RdtSessionClientTrackingFilter() {
-		super(&quot;client&quot;);
-	}
-
 	/*
 	 * (non-Javadoc)
 	 * 

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionTrackingFilter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionTrackingFilter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking/RdtSessionTrackingFilter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -9,6 +9,7 @@
 
 import rtspproxy.config.Config;
 import rtspproxy.filter.FilterBase;
+import rtspproxy.filter.GenericProvider;
 import rtspproxy.rtsp.RtspRequest;
 import rtspproxy.rtsp.RtspResponse;
 import rtspproxy.rtsp.RtspTransport;
@@ -16,7 +17,7 @@
 
 /**
  * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
- *
+ * TODO: to be implemented
  */
 public abstract class RdtSessionTrackingFilter extends FilterBase {
 	
@@ -24,15 +25,27 @@
 
 	public static final String FilterNAME = &quot;rdtTrackingFilter&quot;;
 
-	/**
-	 * @param filterName
-	 * @param className
-	 * @param typeName
-	 */
-	public RdtSessionTrackingFilter(String typeName) {
-		super(FilterNAME, typeName);
-	}
+	public String getName()
+        {
+                return FilterNAME;
+        }
 
+        public void setProvider( GenericProvider provider )
+        {
+              	// XXX
+        }
+
+        public Class getProviderInterface()
+        {
+                return null;
+        }
+
+        public String getProviderClassName()
+        {
+                // TODO: to be implemented
+                return &quot;&quot;; // Config.filtersImplClass.getValue();
+        }
+
 	/**
 	 * check the message for following conditions
 	 */

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxAgent.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxAgent.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxAgent.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -68,340 +68,310 @@
 public class JmxAgent extends Singleton
 {
 
-	private static Logger log = LoggerFactory.getLogger( JmxAgent.class );
+    private static Logger log = LoggerFactory.getLogger( JmxAgent.class );
 
-	public static final String DOMAIN = &quot;RtspProxy&quot;;
-	public static final String SERVICES_DOMAIN = &quot;RtspProxy.Services&quot;;
-	public static final String FILTERS_DOMAIN = &quot;RtspProxy.Filters&quot;;
-	public static final String RTSP_SESSION_DOMAIN = &quot;RtspProxy.Sessions.RTSP&quot;;
-	public static final String PROXY_SESSION_DOMAIN = &quot;RtspProxy.Sessions.Proxy&quot;;
-	public static final String RTP_DYNAMIC_SESSION_DOMAIN = &quot;RtspProxy.Sessions.RTP.dynamic&quot;;
+    public static final String DOMAIN = &quot;RtspProxy&quot;;
 
-	private MBeanServer mbeanServer = null;
+    public static final String SERVICES_DOMAIN = &quot;RtspProxy.Services&quot;;
 
-	/**
-	 * Creates a MBean server and attach all the MBeans to it. Also starts, if
-	 * needed, the web console and the JMX connector server.
-	 */
-	public JmxAgent()
-	{
-		// Silent mx4j info messages
-		System.setProperty( &quot;mx4j.log.priority&quot;, &quot;warn&quot; );
+    public static final String FILTERS_DOMAIN = &quot;RtspProxy.Filters&quot;;
 
-		// Redirect mx4j messages to our own logger
-		Log.redirectTo( new Slf4JLogger() );
+    public static final String RTSP_SESSION_DOMAIN = &quot;RtspProxy.Sessions.RTSP&quot;;
 
-		mbeanServer = MBeanServerFactory.createMBeanServer();
+    public static final String PROXY_SESSION_DOMAIN = &quot;RtspProxy.Sessions.Proxy&quot;;
 
-		try {
+    public static final String RTP_DYNAMIC_SESSION_DOMAIN = &quot;RtspProxy.Sessions.RTP.dynamic&quot;;
 
-			// Basic Info
-			Object infoMBean = new Info();
-			ObjectName infoName = ObjectName.getInstance( DOMAIN + &quot;:name=Info&quot; );
-			mbeanServer.registerMBean( infoMBean, infoName );
+    private MBeanServer mbeanServer = null;
 
-			// Parameters
-			Object parametersMBean = mbeanServer.instantiate( ParametersMBean.class.getName() );
-			ObjectName parametersName = ObjectName.getInstance( DOMAIN
-					+ &quot;:name=Parameters&quot; );
-			mbeanServer.registerMBean( parametersMBean, parametersName );
+    /**
+     * Creates a MBean server and attach all the MBeans to it. Also starts, if
+     * needed, the web console and the JMX connector server.
+     */
+    public JmxAgent()
+    {
+        // Silent mx4j info messages
+        System.setProperty( &quot;mx4j.log.priority&quot;, &quot;warn&quot; );
 
-			// Proxy Services
-			ProxyService[] proxyServices = { RtspService.getInstance(),
-					RdtClientService.getInstance(), RdtServerService.getInstance(),
-					RtcpClientService.getInstance(), RtcpServerService.getInstance(),
-					RtpClientService.getInstance(), RtpServerService.getInstance() };
-			ObjectName objectName;
-			for ( ProxyService proxyService : proxyServices ) {
-				objectName = ObjectName.getInstance( SERVICES_DOMAIN + &quot;:name=&quot;
-						+ proxyService.getName() );
-				mbeanServer.registerMBean( new Service( proxyService ), objectName );
-			}
+        // Redirect mx4j messages to our own logger
+        Log.redirectTo( new Mx4jLoggerWrapper() );
 
-			startWebConsole();
-			startConnectorServer();
+        mbeanServer = MBeanServerFactory.createMBeanServer();
 
-		} catch ( Exception e ) {
-			log.error( &quot;Exception: &quot;, e );
-			Reactor.stop();
-		}
-	}
+        try {
 
-	public void stop()
-	{
-		// TODO: Handle the shutdown of the JMX agent
-	}
+            // Basic Info
+            Object infoMBean = new Info();
+            ObjectName infoName = ObjectName.getInstance( DOMAIN + &quot;:name=Info&quot; );
+            mbeanServer.registerMBean( infoMBean, infoName );
 
-	private void startWebConsole() throws Exception
-	{
-		boolean enabled = Config.jmxWebEnable.getValue();
-		if ( !enabled )
-			return;
+            // Parameters
+            Object parametersMBean = mbeanServer.instantiate( ParametersMBean.class
+                    .getName() );
+            ObjectName parametersName = ObjectName.getInstance( DOMAIN
+                    + &quot;:name=Parameters&quot; );
+            mbeanServer.registerMBean( parametersMBean, parametersName );
 
-		String host = Config.jmxAddress.getValue();
-		int port = Config.jmxWebPort.getValue();
-		String user = Config.jmxUser.getValue();
-		String password = Config.jmxPassword.getValue();
+            // Proxy Services
+            ProxyService[] proxyServices = { RtspService.getInstance(),
+                    RdtClientService.getInstance(), RdtServerService.getInstance(),
+                    RtcpClientService.getInstance(), RtcpServerService.getInstance(),
+                    RtpClientService.getInstance(), RtpServerService.getInstance() };
+            ObjectName objectName;
+            for ( ProxyService proxyService : proxyServices ) {
+                objectName = ObjectName.getInstance( SERVICES_DOMAIN + &quot;:name=&quot;
+                        + proxyService.getName() );
+                mbeanServer.registerMBean( new Service( proxyService ), objectName );
+            }
 
-		HttpAdaptor adaptor = new HttpAdaptor();
-		ObjectName name = new ObjectName( &quot;Server:name=HttpAdaptor&quot; );
-		mbeanServer.registerMBean( adaptor, name );
-		adaptor.setHost( host );
-		adaptor.setPort( port );
-		// MX4J HTTP adaptor only supports Basic authentication
-		adaptor.setAuthenticationMethod( &quot;basic&quot; );
-		adaptor.addAuthorization( user, password );
-		adaptor.start();
+            startWebConsole();
+            startConnectorServer();
 
-		XSLTProcessor processor = new XSLTProcessor();
-		processor.setUseCache( true );
-		adaptor.setProcessor( processor );
+        } catch ( Exception e ) {
+            log.error( &quot;Exception: &quot;, e );
+            Reactor.stop();
+        }
+    }
 
-		String url = &quot;<A HREF="http://">http://</A>&quot; + host + &quot;:&quot; + port + &quot;/&quot;;
-		log.info( &quot;Started web console. Accepting connections on &quot; + url );
-	}
+    public void stop()
+    {
+        // TODO: Handle the shutdown of the JMX agent
+    }
 
-	@SuppressWarnings(&quot;unchecked&quot;)
-	private void startConnectorServer() throws Exception
-	{
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+    private void startWebConsole() throws Exception
+    {
+        boolean enabled = Config.jmxWebEnable.getValue();
+        if ( !enabled )
+            return;
 
-		// Register and start the rmiregistry MBean, needed by JSR 160
-		// RMIConnectorServer
-		ObjectName namingName = ObjectName.getInstance( &quot;naming:type=rmiregistry&quot; );
-		NamingService namingService = new NamingService();
-		mbeanServer.registerMBean( namingService, namingName );
-		namingService.start();
-		int namingPort = ( (Integer) mbeanServer.getAttribute( namingName, &quot;Port&quot; ) ).intValue();
+        String host = Config.jmxAddress.getValue();
+        int port = Config.jmxWebPort.getValue();
+        String user = Config.jmxUser.getValue();
+        String password = Config.jmxPassword.getValue();
 
-		String jndiPath = &quot;/rtspproxy&quot;;
-		String host = Config.jmxAddress.getValue();
-		String uri = &quot;service:jmx:<A HREF="rmi://">rmi://</A>&quot; + host + &quot;/jndi/<A HREF="rmi://">rmi://</A>&quot; + host + &quot;:&quot;
-				+ namingPort + jndiPath;
+        HttpAdaptor adaptor = new HttpAdaptor();
+        ObjectName name = new ObjectName( &quot;Server:name=HttpAdaptor&quot; );
+        mbeanServer.registerMBean( adaptor, name );
+        adaptor.setHost( host );
+        adaptor.setPort( port );
+        // MX4J HTTP adaptor only supports Basic authentication
+        adaptor.setAuthenticationMethod( &quot;basic&quot; );
+        adaptor.addAuthorization( user, password );
+        adaptor.start();
 
-		JMXServiceURL url = new JMXServiceURL( uri );
+        XSLTProcessor processor = new XSLTProcessor();
+        processor.setUseCache( true );
+        adaptor.setProcessor( processor );
 
-		// Remote Authentication
-		JMXAuthenticator authenticator = new Authenticator();
-		Map&lt;String, JMXAuthenticator&gt; environment = new HashMap&lt;String, JMXAuthenticator&gt;();
-		environment.put( JMXConnectorServer.AUTHENTICATOR, authenticator );
+        String url = &quot;<A HREF="http://">http://</A>&quot; + host + &quot;:&quot; + port + &quot;/&quot;;
+        log.info( &quot;Started web console. Accepting connections on {}&quot;, url );
+    }
 
-		// Create and start the RMIConnectorServer
-		JMXConnectorServer connectorServer = JMXConnectorServerFactory.newJMXConnectorServer(
-				url, environment, mbeanServer );
-		connectorServer.start();
+    @SuppressWarnings(&quot;unchecked&quot;)
+    private void startConnectorServer() throws Exception
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
 
-		log.info( &quot;Started JMX connector server. Service url: &quot; + uri );
-	}
+        // Register and start the rmiregistry MBean, needed by JSR 160
+        // RMIConnectorServer
+        ObjectName namingName = ObjectName.getInstance( &quot;naming:type=rmiregistry&quot; );
+        NamingService namingService = new NamingService();
+        mbeanServer.registerMBean( namingService, namingName );
+        namingService.start();
+        int namingPort = ((Integer) mbeanServer.getAttribute( namingName, &quot;Port&quot; ))
+                .intValue();
 
-	/**
-	 * get the singleton instance
-	 */
-	public static JmxAgent getInstance() {
-		return (JmxAgent)Singleton.getInstance(JmxAgent.class);
-	}
-	
-	/**
-	 * register a MBean as a management facade to a filter implementation
-	 */
-	public void registerFilter(FilterBase filter) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+        String jndiPath = &quot;/rtspproxy&quot;;
+        String host = Config.jmxAddress.getValue();
+        String uri = &quot;service:jmx:<A HREF="rmi://">rmi://</A>&quot; + host + &quot;/jndi/<A HREF="rmi://">rmi://</A>&quot; + host + &quot;:&quot;
+                + namingPort + jndiPath;
 
-		try {
-			Filter mbean = new Filter(filter);
-			
-			mbeanServer.registerMBean(mbean, mbean.getName());
-			filter.setMbeanName(mbean.getName());
-			if(filter instanceof JmxManageable)
-				((JmxManageable)filter).setMBeanServer(mbeanServer);
-		} catch(Exception e) {
-			log.error( &quot;failed to register filter MBean: filter=&quot; + filter, e );			
-		}
-	}
-	
-	/**
-	 * simple wrapper to log mx4j logging info into slf4j subsystem
-	 * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
-	 *
-	 */
-	public static class Slf4JLogger extends mx4j.log.Logger {
+        JMXServiceURL url = new JMXServiceURL( uri );
 
-		private Logger m_logger;
-		
-		/**
-		 * default no-op constructor
-		 */
-		public Slf4JLogger() {}
-		
-		/* (non-Javadoc)
-		 * @see mx4j.log.Logger#log(int, java.lang.Object, java.lang.Throwable)
-		 */
-		@Override
-		protected void log(int level, Object msg, Throwable t) {
-			switch(level) {
-			case mx4j.log.Logger.DEBUG:
-				this.m_logger.debug(msg.toString(), t);
-				break;
-			case mx4j.log.Logger.ERROR:
-				this.m_logger.error(msg.toString(), t);
-				break;
-			case mx4j.log.Logger.FATAL:
-				this.m_logger.error(msg.toString(), t);
-				break;
-			case mx4j.log.Logger.INFO:
-				this.m_logger.info(msg.toString(), t);
-				break;
-			case mx4j.log.Logger.TRACE:
-				this.m_logger.debug(msg.toString(), t);
-				break;
-			case mx4j.log.Logger.WARN:
-				this.m_logger.warn(msg.toString(), t);
-				break;
-			}
-		}
+        // Remote Authentication
+        JMXAuthenticator authenticator = new Authenticator();
+        Map&lt;String, JMXAuthenticator&gt; environment = new HashMap&lt;String, JMXAuthenticator&gt;();
+        environment.put( JMXConnectorServer.AUTHENTICATOR, authenticator );
 
-		/* (non-Javadoc)
-		 * @see mx4j.log.Logger#setCategory(java.lang.String)
-		 */
-		@Override
-		protected void setCategory(String arg0) {
-			super.setCategory(arg0);
-			
-			this.m_logger = LoggerFactory.getLogger(arg0);
-		}		
-	}
+        // Create and start the RMIConnectorServer
+        JMXConnectorServer connectorServer = JMXConnectorServerFactory
+                .newJMXConnectorServer( url, environment, mbeanServer );
+        connectorServer.start();
 
-	/**
-	 * @return Returns the mbeanServer.
-	 */
-	public MBeanServer getMbeanServer() {
-		return mbeanServer;
-	}
-	
-	/**
-	 * register a proxy session
-	 * 
-	 */
-	public void registerProxySession(ProxySession session) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+        log.info( &quot;Started JMX connector server. Service url: {}&quot;, uri );
+    }
 
-		try {
-			ProxySessionFacade mbean = new ProxySessionFacade(session);
-			ObjectName name = mbean.buildName();
-		
-			mbeanServer.registerMBean(mbean, name);
-			session.setObjectName(name);
-		} catch(Exception e) {
-			log.error( &quot;failed to register proxy session MBean: session=&quot; + session, e );
-		}
-	}
-	
-	/**
-	 * unregister a proxy session
-	 */
-	public void unregisterProxySession(ProxySession session) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+    /**
+     * get the singleton instance
+     */
+    public static JmxAgent getInstance()
+    {
+        return (JmxAgent) Singleton.getInstance( JmxAgent.class );
+    }
 
-		try {
-			ObjectName name = session.getObjectName();
-		
-			if(name != null) {
-				mbeanServer.unregisterMBean(name);
-				session.setObjectName(null);
-			}
-		} catch(InstanceNotFoundException infe) {
-			log.debug(&quot;internal problem: MBean not found, name={}&quot;, session.getObjectName(), infe);
-		} catch(Exception e) {
-			log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
-		}
-		
-	}
-	
-	/**
-	 * register a proxy session
-	 * 
-	 */
-	public void registerPortRangeRtpServerSessionfactory(PortrangeRtpServerSessionFactory sessionFactory) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+    /**
+     * register a MBean as a management facade to a filter implementation
+     */
+    public void registerFilter( FilterBase filter )
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
 
-		try {
-			ObjectName objectName = ObjectName.getInstance( SERVICES_DOMAIN + &quot;:name=PortrangeRtpServerSessionFactory&quot;);
-		
-			mbeanServer.registerMBean( new PortrangeRtpServerFactory(sessionFactory), objectName );
-		} catch(Exception e) {
-			log.info(&quot;failed to register PortrangeRtpServerFactory MBean&quot;, e);
-		}
-	}
-	
-	/**
-	 * register a proxy session
-	 * 
-	 */
-	public void unregisterPortRangeRtpServerSessionfactory() {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
+        try {
+            Filter mbean = new Filter( filter );
 
-		try {
-			ObjectName objectName = ObjectName.getInstance( SERVICES_DOMAIN + &quot;:name=PortrangeRtpServerSessionFactory&quot;);
-		
-			mbeanServer.unregisterMBean(  objectName );
-		} catch(InstanceNotFoundException infe) {
-			log.debug(&quot;PortrangeRtpServerFactory MBean not found&quot;, infe);
-		} catch(Exception e) {
-			log.info(&quot;failed to register PortrangeRtpServerFactory MBean&quot;, e);
-		}
-	}
-	
-	/**
-	 * register a generated RTP server session in the portrange case
-	 */
-	public void registerPortrangeRtpServerSession(PortrangeRtpServerSession session) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
-		
-		try {
-			PortrangeRtpSession mbean = new PortrangeRtpSession(session);
-			ObjectName name = mbean.buildName();
-		
-			mbeanServer.registerMBean(mbean, name);
-			session.setObjectName(name);
-		} catch(Exception e) {
-			log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
-		}
-	}
-	
-	/**
-	 * register a generated RTP server session in the portrange case
-	 */
-	public void unregisterPortrangeRtpServerSession(PortrangeRtpServerSession session) {
-		boolean enabled = Config.jmxConnectorServiceEnable.getValue();
-		if ( !enabled )
-			return;
-		
-		try {
-			ObjectName name = session.getObjectName();
-		
-			if(name != null) {
-				mbeanServer.unregisterMBean(name);
-				session.setObjectName(null);
-			}
-		} catch(InstanceNotFoundException infe) {
-			log.debug(&quot;internal problem: MBean not found, name=&quot; + session.getObjectName(), infe);
-		} catch(Exception e) {
-			log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
-		}		
-	}
+            mbeanServer.registerMBean( mbean, mbean.getName() );
+            filter.setMbeanName( mbean.getName() );
+            if ( filter instanceof JmxManageable )
+                ((JmxManageable) filter).setMBeanServer( mbeanServer );
+        } catch ( Exception e ) {
+            log.error( &quot;failed to register filter MBean: filter=&quot; + filter, e );
+        }
+    }
 
+    /**
+     * @return Returns the mbeanServer.
+     */
+    public MBeanServer getMbeanServer()
+    {
+        return mbeanServer;
+    }
+
+    /**
+     * register a proxy session
+     * 
+     */
+    public void registerProxySession( ProxySession session )
+    {
+        boolean enabled = Config.jmxEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            ProxySessionFacade mbean = new ProxySessionFacade( session );
+            ObjectName name = mbean.buildName();
+
+            mbeanServer.registerMBean( mbean, name );
+            session.setObjectName( name );
+        } catch ( Exception e ) {
+            log.error( &quot;failed to register proxy session MBean: session=&quot; + session, e );
+        }
+    }
+
+    /**
+     * unregister a proxy session
+     */
+    public void unregisterProxySession( ProxySession session )
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            ObjectName name = session.getObjectName();
+
+            if ( name != null ) {
+                mbeanServer.unregisterMBean( name );
+                session.setObjectName( null );
+            }
+        } catch ( InstanceNotFoundException infe ) {
+            log.debug( &quot;internal problem: MBean not found, name={}&quot;, session
+                    .getObjectName(), infe );
+        } catch ( Exception e ) {
+            log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
+        }
+
+    }
+
+    /**
+     * register a proxy session
+     * 
+     */
+    public void registerPortRangeRtpServerSessionfactory(
+            PortrangeRtpServerSessionFactory sessionFactory )
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            ObjectName objectName = ObjectName.getInstance( SERVICES_DOMAIN
+                    + &quot;:name=PortrangeRtpServerSessionFactory&quot; );
+
+            mbeanServer.registerMBean( new PortrangeRtpServerFactory( sessionFactory ),
+                    objectName );
+        } catch ( Exception e ) {
+            log.info( &quot;failed to register PortrangeRtpServerFactory MBean&quot;, e );
+        }
+    }
+
+    /**
+     * register a proxy session
+     * 
+     */
+    public void unregisterPortRangeRtpServerSessionfactory()
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            ObjectName objectName = ObjectName.getInstance( SERVICES_DOMAIN
+                    + &quot;:name=PortrangeRtpServerSessionFactory&quot; );
+
+            mbeanServer.unregisterMBean( objectName );
+        } catch ( InstanceNotFoundException infe ) {
+            log.debug( &quot;PortrangeRtpServerFactory MBean not found&quot;, infe );
+        } catch ( Exception e ) {
+            log.info( &quot;failed to register PortrangeRtpServerFactory MBean&quot;, e );
+        }
+    }
+
+    /**
+     * register a generated RTP server session in the portrange case
+     */
+    public void registerPortrangeRtpServerSession( PortrangeRtpServerSession session )
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            PortrangeRtpSession mbean = new PortrangeRtpSession( session );
+            ObjectName name = mbean.buildName();
+
+            mbeanServer.registerMBean( mbean, name );
+            session.setObjectName( name );
+        } catch ( Exception e ) {
+            log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
+        }
+    }
+
+    /**
+     * register a generated RTP server session in the portrange case
+     */
+    public void unregisterPortrangeRtpServerSession( PortrangeRtpServerSession session )
+    {
+        boolean enabled = Config.jmxConnectorServiceEnable.getValue();
+        if ( !enabled )
+            return;
+
+        try {
+            ObjectName name = session.getObjectName();
+
+            if ( name != null ) {
+                mbeanServer.unregisterMBean( name );
+                session.setObjectName( null );
+            }
+        } catch ( InstanceNotFoundException infe ) {
+            log.debug( &quot;internal problem: MBean not found, name=&quot;
+                    + session.getObjectName(), infe );
+        } catch ( Exception e ) {
+            log.error( &quot;failed to register proxy session MBean: session={}&quot;, session, e );
+        }
+    }
+
 }


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxManageable.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/JmxManageable2.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Added: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/Mx4jLoggerWrapper.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/Mx4jLoggerWrapper.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/Mx4jLoggerWrapper.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -0,0 +1,59 @@
+package rtspproxy.jmx;
+
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+/**
+ * Simple wrapper to log mx4j logging info into slf4j subsystem
+ * 
+ * @author Rainer Bieniek (<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>)
+ * 
+ */
+public class Mx4jLoggerWrapper extends mx4j.log.Logger
+{
+
+    private Logger logger;
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see mx4j.log.Logger#log(int, java.lang.Object, java.lang.Throwable)
+     */
+    @Override
+    protected void log( int level, Object msg, Throwable t )
+    {
+        switch ( level )
+        {
+        case mx4j.log.Logger.DEBUG:
+            logger.debug( msg.toString(), t );
+            break;
+        case mx4j.log.Logger.ERROR:
+            logger.error( msg.toString(), t );
+            break;
+        case mx4j.log.Logger.FATAL:
+            logger.error( msg.toString(), t );
+            break;
+        case mx4j.log.Logger.INFO:
+            logger.info( msg.toString(), t );
+            break;
+        case mx4j.log.Logger.TRACE:
+            logger.debug( msg.toString(), t );
+            break;
+        case mx4j.log.Logger.WARN:
+            logger.warn( msg.toString(), t );
+            break;
+        }
+    }
+
+    /*
+     * (non-Javadoc)
+     * 
+     * @see mx4j.log.Logger#setCategory(java.lang.String)
+     */
+    @Override
+    protected void setCategory( String category )
+    {
+        super.setCategory( category );
+        logger = LoggerFactory.getLogger( category );
+    }
+}


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/Mx4jLoggerWrapper.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/Filter.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/Filter.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/Filter.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -29,15 +29,16 @@
 	 * @throws MalformedObjectNameException 
 	 * 
 	 */
-	public Filter(FilterBase filter) throws MalformedObjectNameException, NullPointerException {
+	public Filter( FilterBase filter ) 
+		throws MalformedObjectNameException, NullPointerException 
+	{
 		this.filter = filter;
 		
 		// build the MBean name
 		Hashtable&lt;String, String&gt; keys = new Hashtable&lt;String, String&gt;();
 		
-		keys.put(&quot;filter&quot;, filter.getTypeName());
-		keys.put(&quot;side&quot;, filter.getSide().toString());
-		keys.put(&quot;classname&quot;, filter.getClassName());
+		keys.put(&quot;filter&quot;, filter.getName());
+		keys.put(&quot;classname&quot;, filter.getProviderClassName());
 		keys.put(&quot;id&quot;, Long.toHexString(System.identityHashCode(filter)));
 		
 		this.name = new ObjectName(JmxAgent.FILTERS_DOMAIN, keys);


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/Filter.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/FilterMBean.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpServerFactory.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpServerFactoryMBean.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpSession.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/PortrangeRtpSessionMBean.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/ProxySessionFacade.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/jmx/mbeans/ProxySessionFacadeMBean.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/Base64.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/Side.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedByte.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedInt.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedLong.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedNumber.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/lib/number/UnsignedShort.java
___________________________________________________________________
Name: svn:executable
   - *

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ClientRtcpPacketHandler.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ClientRtcpPacketHandler.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ClientRtcpPacketHandler.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -58,11 +58,13 @@
 
         if ( track == null ) {
             // drop packet
-            log.debug( &quot;Invalid address: {} - Class: {}&quot;, session.getRemoteAddress(),
-                    ((InetSocketAddress) session.getRemoteAddress()).getAddress()
-                            .getClass() );
-            
-            log.debug( &quot;Known Client Addresses: {}&quot;, Track.clientAddressMap.keySet() );
+            if ( log.isDebugEnabled() ) {
+                log.debug( &quot;Invalid address: {} - Class: {}&quot;, session.getRemoteAddress(),
+                        ((InetSocketAddress) session.getRemoteAddress()).getAddress()
+                                .getClass() );
+
+                log.debug( &quot;Known Client Addresses: {}&quot;, Track.getClientAddresses() );
+            }
             return;
         }
 


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyConstants.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyHandler.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyHandler.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/ProxyHandler.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -24,12 +24,14 @@
 import java.net.InetSocketAddress;
 import java.net.URL;
 import java.net.UnknownHostException;
-import java.nio.channels.UnresolvedAddressException;
 import java.util.HashMap;
 import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.mina.common.ConnectFuture;
+import org.apache.mina.common.IoFuture;
 import org.apache.mina.common.IoSession;
+import org.apache.mina.common.TrafficMask;
+import org.apache.mina.common.IoFuture.Callback;
 import org.apache.mina.transport.socket.nio.SocketConnector;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -58,7 +60,7 @@
 /**
  * @author Matteo Merli
  */
-public class ProxyHandler
+public class ProxyHandler implements Callback
 {
 
     private static Logger log = LoggerFactory.getLogger( ProxyHandler.class );
@@ -246,7 +248,7 @@
 
         RtspTransportList rtspTransportList = new RtspTransportList( request
                 .getHeader( &quot;Transport&quot; ) );
-        log.debug( &quot;Parsed: {}&quot;, rtspTransportList );
+        log.debug( &quot;Parsed: [{}]&quot;, rtspTransportList );
 
         if ( rtspTransportList.count() == 0 ) {
             /**
@@ -255,6 +257,7 @@
              * client will have the chance to reformule the request with another
              * transports set.
              */
+            log.debug( &quot;No supported transport was found.&quot; );
             sendResponse( clientSession, RtspResponse
                     .errorResponse( RtspCode.UnsupportedTransport ) );
             return;
@@ -497,24 +500,32 @@
         connector.setFilterChainBuilder( new RtspServerFilters() );
 
         // Start communication.
+        InetSocketAddress addr = new InetSocketAddress( host, port );
         log.debug( &quot;Trying to connect to '{}' {}&quot;, host, port );
-        try {
+        if ( addr.isUnresolved() ) {
+            log.warn( &quot;Cannot resolve hostname: {}&quot;, host );
+            sendResponse( clientSession, RtspResponse
+                    .errorResponse( RtspCode.DestinationUnreachable ) );
+            clientSession.close();
+            return;
+        }
 
-            /*
-             * TODO: Current implementation wait (future.join()) until the
-             * connection with server is completed. This could block the thread
-             * for a long time. Check how to do it in asyncronous way.
-             */
-            ConnectFuture future = connector.connect(
-                    new InetSocketAddress( host, port ), new ServerSide() );
-            future.join();
-            serverSession = future.getSession();
+        // Set the traffic mask to none to avoid reception of
+        // messages from the client.
+        clientSession.setTrafficMask( TrafficMask.NONE );
 
-            // TODO: Rtsp Keep Alive
-            // if (Config.proxyRtspKeepAlive.getValue())
-            // ((SocketSession) serverSession).setKeepAlive(true);
-        } catch ( UnresolvedAddressException e ) {
-            log.warn( &quot;Destination unreachable: &quot; + host + &quot;:&quot; + port );
+        ConnectFuture future = connector.connect( addr, new ServerSide() );
+        future.setCallback( this );
+    }
+
+    public void operationComplete( IoFuture future )
+    {
+        ConnectFuture connectFuture = (ConnectFuture) future;
+        log.debug( &quot;operation completed&quot; );
+        clientSession.setTrafficMask( TrafficMask.ALL );
+
+        if ( !connectFuture.isConnected() ) {
+            log.warn( &quot;Destination unreachable&quot; );
             sendResponse( clientSession, RtspResponse
                     .errorResponse( RtspCode.DestinationUnreachable ) );
             clientSession.close();
@@ -523,6 +534,17 @@
 
         log.debug( &quot;Connected!&quot; );
 
+        try {
+            serverSession = connectFuture.getSession();
+        } catch ( IOException e ) {
+            log.error( &quot;Error getting connection session: &quot; + e );
+            clientSession.close();
+        }
+
+        // TODO: Rtsp Keep Alive
+        // if (Config.proxyRtspKeepAlive.getValue())
+        // ((SocketSession) serverSession).setKeepAlive(true);
+
         // Save current ProxyHandler into the ProtocolSession
         serverSession.setAttribute( ProxyHandler.ATTR, this );
 

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/track/Track.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/track/Track.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/proxy/track/Track.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -21,6 +21,7 @@
 import java.net.InetAddress;
 import java.net.InetSocketAddress;
 import java.util.Map;
+import java.util.Set;
 import java.util.concurrent.ConcurrentHashMap;
 
 /**
@@ -84,7 +85,7 @@
 
     /** Maps a client address to a Track */
     // TODO: bring back to protected
-    public static Map&lt;InetSocketAddress, Track&gt; clientAddressMap = new ConcurrentHashMap&lt;InetSocketAddress, Track&gt;();
+    protected static Map&lt;InetSocketAddress, Track&gt; clientAddressMap = new ConcurrentHashMap&lt;InetSocketAddress, Track&gt;();
 
     /** Maps a server address to a Track */
     protected static Map&lt;InetSocketAddress, Track&gt; serverAddressMap = new ConcurrentHashMap&lt;InetSocketAddress, Track&gt;();
@@ -142,6 +143,11 @@
     {
         return serverAddressMap.get( serverAddress );
     }
+    
+    public static Set&lt;InetSocketAddress&gt; getClientAddresses()
+    {
+        return clientAddressMap.keySet();
+    }
 
     /**
      * Get the track by looking at server socket address.


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtAckPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtControlPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtDataPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtFilterChainBuilder.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtLatencyReportPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtPacketDecoder.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolCodecFactory.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolDecoder.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtProtocolEncoder.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtRttRequestPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtRttResponsePacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rdt/RdtStreamEndPacket.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/PortrangeRtpServerSession.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/PortrangeRtpServerSessionFactory.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/RtpRtcpFilterChainBuilder.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtp/range/RtpServerSessionFactory.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtsp/RtspTransportList.java
===================================================================
--- trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtsp/RtspTransportList.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/main/java/rtspproxy/rtsp/RtspTransportList.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -65,13 +65,13 @@
 	@Override
     public String toString()
 	{
-		final StringBuilder buf = new StringBuilder();
+		final StringBuilder sb = new StringBuilder();
 		int i = 0;
 		for ( RtspTransport transport : transportList ) {
 			if ( i++ != 0 )
-				buf.append( ',' );
-			buf.append( transport.toString() );
+				sb.append( ',' );
+			sb.append( transport.toString() );
 		}
-		return buf.toString();
+		return sb.toString();
 	}
 }


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedByteTest.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedIntTest.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedLongTest.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/lib/number/UnsignedShortTest.java
___________________________________________________________________
Name: svn:executable
   - *


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/BufferUtils.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtAckPacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtDataPacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtLatencyRepostPacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtRttRequestPacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtRttResponsePacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rdt/RdtStreamEndPacketTest.java
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-Core/src/test/java/rtspproxy/rtsp/RtspTransportTest.java
===================================================================
--- trunk/RTSPProxy-Core/src/test/java/rtspproxy/rtsp/RtspTransportTest.java	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-Core/src/test/java/rtspproxy/rtsp/RtspTransportTest.java	2006-04-25 21:47:58 UTC (rev 416)
@@ -41,6 +41,7 @@
 	String test5 = &quot;x-pn-tng/tcp;mode=play&quot;;
 	String test6 = &quot;x-real-rdt/tcp;mode=play&quot;;
 	String test7 = &quot;RTP/AVP/TCP;unicast;mode=play&quot;;
+    String test8 = &quot;RTP/AVP/TCP;UNICAST;mode=play&quot;;
 
 	RtspTransport transport1;
 	RtspTransport transport2;
@@ -49,6 +50,7 @@
 	RtspTransport transport5;
 	RtspTransport transport6;
 	RtspTransport transport7;
+    RtspTransport transport8;
 
 	@Override
 	protected void setUp() throws Exception
@@ -60,6 +62,7 @@
 		transport5 = new RtspTransport( test5 );
 		transport6 = new RtspTransport( test6 );
 		transport7 = new RtspTransport( test7 );
+        transport8 = new RtspTransport( test8 );
 	}
 
 	public void testIsSupportedByProxy()
@@ -71,6 +74,7 @@
 		assertEquals( false, transport5.isSupportedByProxy() );
 		assertEquals( false, transport6.isSupportedByProxy() );
 		assertEquals( false, transport7.isSupportedByProxy() );
+        assertEquals( false, transport8.isSupportedByProxy() );
 	}
 
 	/*
@@ -93,6 +97,7 @@
 		assertEquals( false, transport5.isAppend() );
 		assertEquals( false, transport6.isAppend() );
 		assertEquals( false, transport7.isAppend() );
+        assertEquals( false, transport8.isAppend() );
 	}
 
 	/*
@@ -107,6 +112,7 @@
 		assertTrue( Arrays.equals( new int[] { 0, 0 }, transport5.getClientPort() ) );
 		assertTrue( Arrays.equals( new int[] { 0, 0 }, transport6.getClientPort() ) );
 		assertTrue( Arrays.equals( new int[] { 0, 0 }, transport7.getClientPort() ) );
+        assertTrue( Arrays.equals( new int[] { 0, 0 }, transport8.getClientPort() ) );
 	}
 
 	/*
@@ -121,6 +127,7 @@
 		assertEquals( DeliveryType.None, transport5.getDeliveryType() );
 		assertEquals( DeliveryType.unicast, transport6.getDeliveryType() );
 		assertEquals( DeliveryType.unicast, transport7.getDeliveryType() );
+        assertEquals( DeliveryType.unicast, transport8.getDeliveryType() );
 	}
 
 	/*


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtAckPacket.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketDataPacket.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketStream0.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtDataPacketStream1.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtLatencyReportWithDataPacket.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtRttRequestPacket.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtRttResponsePacket.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtStreamEndPacketStream0.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev


Property changes on: trunk/RTSPProxy-Core/src/test/resources/rtspproxy/rdt/RdtStreamEndPacketStream1.txt
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/RTSPProxy-OSGi/pom.xml
===================================================================
--- trunk/RTSPProxy-OSGi/pom.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/RTSPProxy-OSGi/pom.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,90 +1,67 @@
-&lt;project xmlns=&quot;<A HREF="http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</A>&quot; xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;
-  xsi:schemaLocation=&quot;<A HREF="http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</A> <A HREF="http://maven.apache.org/maven-v4_0_0.xsd">http://maven.apache.org/maven-v4_0_0.xsd</A>&quot;&gt;
-  &lt;parent&gt;
-    &lt;groupId&gt;net.merlimat&lt;/groupId&gt;
-    &lt;artifactId&gt;rtspproxy&lt;/artifactId&gt;
-    &lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-  &lt;/parent&gt;
-  
-  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
-  &lt;groupId&gt;net.merlimat&lt;/groupId&gt;
-  &lt;artifactId&gt;RTSPProxy-OSGi&lt;/artifactId&gt;
-  &lt;packaging&gt;osgi-bundle&lt;/packaging&gt;
-  &lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-  &lt;name&gt;RTSP Proxy OSGi bundle&lt;/name&gt;
-  &lt;url&gt;<A HREF="http://rtspproxy.berlios.de&lt;/url">http://rtspproxy.berlios.de&lt;/url</A>&gt;
-  &lt;inceptionYear&gt;2003&lt;/inceptionYear&gt;
+&lt;project xmlns=&quot;<A HREF="http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</A>&quot;
+	xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;
+	xsi:schemaLocation=&quot;<A HREF="http://maven.apache.org/POM/4.0.0">http://maven.apache.org/POM/4.0.0</A> <A HREF="http://maven.apache.org/maven-v4_0_0.xsd">http://maven.apache.org/maven-v4_0_0.xsd</A>&quot;&gt;
+		
+	&lt;!-- $Id$
+	     $URL$
+	 --&gt;
+	
+	&lt;parent&gt;
+		&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
+		&lt;artifactId&gt;rtspproxy&lt;/artifactId&gt;
+		&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
+		&lt;relativePath&gt;../pom.xml&lt;/relativePath&gt;
+	&lt;/parent&gt;
 
-  &lt;dependencies&gt;
+	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
 
-    &lt;dependency&gt;
-      &lt;groupId&gt;net.merlimat&lt;/groupId&gt;
-      &lt;artifactId&gt;RTSPProxy-Core&lt;/artifactId&gt;
-      &lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
-    &lt;/dependency&gt;
+	&lt;artifactId&gt;RTSPProxy-OSGi&lt;/artifactId&gt;
+	&lt;packaging&gt;osgi-bundle&lt;/packaging&gt;
+	&lt;name&gt;RTSP Proxy OSGi bundle&lt;/name&gt;
 
-    &lt;dependency&gt;
-      &lt;groupId&gt;org.osgi&lt;/groupId&gt;
-      &lt;artifactId&gt;org.osgi&lt;/artifactId&gt;
-      &lt;version&gt;3.0&lt;/version&gt;
-      &lt;scope&gt;provided&lt;/scope&gt;
-    &lt;/dependency&gt;
+	&lt;dependencies&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;net.merlimat&lt;/groupId&gt;
+			&lt;artifactId&gt;RTSPProxy-Core&lt;/artifactId&gt;
+			&lt;version&gt;3.0-ALPHA5-SNAPSHOT&lt;/version&gt;
+		&lt;/dependency&gt;
 
-    &lt;dependency&gt;
-      &lt;groupId&gt;junit&lt;/groupId&gt;
-      &lt;artifactId&gt;junit&lt;/artifactId&gt;
-      &lt;version&gt;3.8.1&lt;/version&gt;
-      &lt;scope&gt;test&lt;/scope&gt;
-    &lt;/dependency&gt;
+		&lt;dependency&gt;
+			&lt;groupId&gt;org.osgi&lt;/groupId&gt;
+			&lt;artifactId&gt;org.osgi&lt;/artifactId&gt;
+			&lt;version&gt;3.0&lt;/version&gt;
+			&lt;scope&gt;provided&lt;/scope&gt;
+		&lt;/dependency&gt;
+	&lt;/dependencies&gt;
 
-  &lt;/dependencies&gt;
+	&lt;build&gt;
+		&lt;defaultGoal&gt;package&lt;/defaultGoal&gt;
 
-  &lt;build&gt;
-    &lt;defaultGoal&gt;assembly:directory&lt;/defaultGoal&gt;
-    
-    &lt;resources&gt;
-      &lt;resource&gt;
-	&lt;directory&gt;src/main/resources&lt;/directory&gt;
-	&lt;filtering&gt;true&lt;/filtering&gt;
-      &lt;/resource&gt;
-    &lt;/resources&gt;
-    
-    &lt;plugins&gt;
-      &lt;plugin&gt;
-	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
-	&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
-	&lt;configuration&gt;
-	  &lt;source&gt;1.5&lt;/source&gt;
-	  &lt;target&gt;1.5&lt;/target&gt;
-	  &lt;showWarnings&gt;true&lt;/showWarnings&gt;
-	&lt;/configuration&gt;
-      &lt;/plugin&gt;
+		&lt;plugins&gt;
 
-      &lt;!-- see <A HREF="http://docs.safehaus.org/display/OSGI/OSGi+Plugin+for+Maven+2.0">http://docs.safehaus.org/display/OSGI/OSGi+Plugin+for+Maven+2.0</A> for further instructions --&gt;
-      &lt;plugin&gt;
-        &lt;groupId&gt;org.apache.felix.plugins&lt;/groupId&gt;
-        &lt;artifactId&gt;maven-osgi-plugin&lt;/artifactId&gt;
-        &lt;extensions&gt;true&lt;/extensions&gt;
-        &lt;version&gt;0.3.0&lt;/version&gt;
-        &lt;configuration&gt;
-          &lt;osgiManifest&gt;
-            &lt;bundleActivator&gt;rtspproxy.bundle.Activator&lt;/bundleActivator&gt;
-            &lt;bundleName&gt;RTSP Proxy bundle&lt;/bundleName&gt;
-            &lt;bundleDescription&gt;RTSP Proxy bundle&lt;/bundleDescription&gt;
-            &lt;bundleVendor&gt;rbieniek&lt;/bundleVendor&gt;
-	    &lt;importPackage&gt;org.osgi.service.log&lt;/importPackage&gt;
-          &lt;/osgiManifest&gt;
-        &lt;/configuration&gt;
-      &lt;/plugin&gt;
-    &lt;/plugins&gt;
-  &lt;/build&gt;
+			&lt;!-- see <A HREF="http://docs.safehaus.org/display/OSGI/OSGi+Plugin+for+Maven+2.0">http://docs.safehaus.org/display/OSGI/OSGi+Plugin+for+Maven+2.0</A> for further instructions --&gt;
+			&lt;plugin&gt;
+				&lt;groupId&gt;org.apache.felix.plugins&lt;/groupId&gt;
+				&lt;artifactId&gt;maven-osgi-plugin&lt;/artifactId&gt;
+				&lt;extensions&gt;true&lt;/extensions&gt;
+				&lt;version&gt;0.3.0&lt;/version&gt;
+				&lt;configuration&gt;
+					&lt;osgiManifest&gt;
+						&lt;bundleActivator&gt;
+							rtspproxy.bundle.Activator
+						&lt;/bundleActivator&gt;
+						&lt;bundleName&gt;RTSP Proxy bundle&lt;/bundleName&gt;
+						&lt;bundleDescription&gt;
+							RTSP Proxy bundle
+						&lt;/bundleDescription&gt;
+						&lt;bundleVendor&gt;rbieniek&lt;/bundleVendor&gt;
+						&lt;importPackage&gt;
+							org.osgi.service.log
+						&lt;/importPackage&gt;
+					&lt;/osgiManifest&gt;
+				&lt;/configuration&gt;
+			&lt;/plugin&gt;
+		&lt;/plugins&gt;
+	&lt;/build&gt;
 
-  &lt;repositories&gt;
-    &lt;repository&gt;
-      &lt;id&gt;safehaus-repository&lt;/id&gt;
-      &lt;name&gt;Safehaus Repository&lt;/name&gt;
-      &lt;url&gt;<A HREF="http://m2.safehaus.org&lt;/url">http://m2.safehaus.org&lt;/url</A>&gt;
-    &lt;/repository&gt;
-  &lt;/repositories&gt;
-
 &lt;/project&gt;


Property changes on: trunk/RTSPProxy-OSGi/pom.xml
___________________________________________________________________
Name: svn:keywords
   + Id URL Rev

Modified: trunk/pom.xml
===================================================================
--- trunk/pom.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/pom.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -95,6 +95,107 @@
     &lt;module&gt;RTSPProxy-App&lt;/module&gt;
     &lt;module&gt;RTSPProxy-OSGi&lt;/module&gt;
   &lt;/modules&gt;
+
+
+&lt;dependencies&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;org.apache.directory.mina&lt;/groupId&gt;
+		&lt;artifactId&gt;mina-core&lt;/artifactId&gt;
+		&lt;version&gt;0.9.3&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;mx4j&lt;/groupId&gt;
+		&lt;artifactId&gt;mx4j-tools&lt;/artifactId&gt;
+		&lt;version&gt;2.1.1&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
+		&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
+		&lt;version&gt;1.0&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;log4j&lt;/groupId&gt;
+		&lt;artifactId&gt;log4j&lt;/artifactId&gt;
+		&lt;version&gt;1.2.13&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;commons-pool&lt;/groupId&gt;
+		&lt;artifactId&gt;commons-pool&lt;/artifactId&gt;
+		&lt;version&gt;1.3&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;commons-configuration&lt;/groupId&gt;
+		&lt;artifactId&gt;commons-configuration&lt;/artifactId&gt;
+		&lt;version&gt;1.2&lt;/version&gt;
+	&lt;/dependency&gt;
+	
+	&lt;!-- Included here to disambiguate the version number --&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;commons-collections&lt;/groupId&gt;
+		&lt;artifactId&gt;commons-collections&lt;/artifactId&gt;
+		&lt;version&gt;3.1&lt;/version&gt;
+	&lt;/dependency&gt;
+
+	&lt;dependency&gt;
+		&lt;groupId&gt;junit&lt;/groupId&gt;
+		&lt;artifactId&gt;junit&lt;/artifactId&gt;
+		&lt;version&gt;3.8.1&lt;/version&gt;
+		&lt;scope&gt;test&lt;/scope&gt;
+	&lt;/dependency&gt;
+
+	&lt;!-- These are dependencies inherited which are not really
+	     necessaries, so we prevent them from being included
+	     in the final binary package.
+	  --&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;xalan&lt;/groupId&gt;
+		&lt;artifactId&gt;xalan&lt;/artifactId&gt;
+		&lt;version&gt;2.7.0&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+	
+	&lt;dependency&gt;
+		&lt;groupId&gt;xerces&lt;/groupId&gt;
+		&lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
+		&lt;version&gt;2.2.1&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;xml-apis&lt;/groupId&gt;
+		&lt;artifactId&gt;xml-apis&lt;/artifactId&gt;
+		&lt;version&gt;1.0.b2&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+        &lt;dependency&gt;
+		&lt;groupId&gt;dom4j&lt;/groupId&gt;
+		&lt;artifactId&gt;dom4j&lt;/artifactId&gt;
+		&lt;version&gt;1.4&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;msv&lt;/groupId&gt;
+		&lt;artifactId&gt;msv&lt;/artifactId&gt;
+		&lt;version&gt;20020414&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
+		&lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
+		&lt;version&gt;2.3&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+	&lt;dependency&gt;
+		&lt;groupId&gt;jaxen&lt;/groupId&gt;
+		&lt;artifactId&gt;jaxen&lt;/artifactId&gt;
+		&lt;version&gt;1.0-FCS&lt;/version&gt;
+		&lt;scope&gt;provided&lt;/scope&gt;
+	&lt;/dependency&gt;
+&lt;/dependencies&gt;
     
   &lt;build&gt;
     &lt;defaultGoal&gt;package&lt;/defaultGoal&gt;
@@ -107,6 +208,19 @@
     &lt;/resources&gt;
     
     &lt;plugins&gt;
+		&lt;plugin&gt;
+			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
+			&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
+			&lt;configuration&gt;
+				&lt;source&gt;1.5&lt;/source&gt;
+				&lt;target&gt;1.5&lt;/target&gt;
+				&lt;optimize&gt;true&lt;/optimize&gt;
+				&lt;debug&gt;true&lt;/debug&gt;
+				&lt;showWarnings&gt;true&lt;/showWarnings&gt;
+				&lt;showDeprecations&gt;true&lt;/showDeprecations&gt;
+			&lt;/configuration&gt;
+		&lt;/plugin&gt;
+	
 &lt;!--
       &lt;plugin&gt;
 	&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
@@ -189,5 +303,28 @@
       --&gt;
     &lt;/plugins&gt;
   &lt;/reporting&gt;
+
+	&lt;repositories&gt;
+
+		&lt;repository&gt;
+			&lt;id&gt;Apache repository&lt;/id&gt;
+			&lt;url&gt;<A HREF="http://svn.apache.org/repository/&lt;/url">http://svn.apache.org/repository/&lt;/url</A>&gt;
+		&lt;/repository&gt;
+
+		&lt;!-- For snapshots (no release jars or non-apache jars)           --&gt;
+		&lt;repository&gt;
+			&lt;id&gt;apache.snapshots&lt;/id&gt;
+			&lt;name&gt;Apache Snapshot Repository&lt;/name&gt;
+			&lt;url&gt;<A HREF="http://cvs.apache.org/maven-snapshot-repository&lt;/url">http://cvs.apache.org/maven-snapshot-repository&lt;/url</A>&gt;
+		&lt;/repository&gt;
+
+		&lt;!--
+			&lt;repository&gt;
+			&lt;id&gt;ibilio maven2&lt;/id&gt;
+			&lt;url&gt;<A HREF="http://www.ibiblio.org/maven2/&lt;/url">http://www.ibiblio.org/maven2/&lt;/url</A>&gt;
+			&lt;/repository&gt;
+		--&gt;
+	&lt;/repositories&gt;
+
   
 &lt;/project&gt;

Modified: trunk/src/changes/changes.xml
===================================================================
--- trunk/src/changes/changes.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/src/changes/changes.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -1,19 +1,143 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;document&gt;
-  &lt;properties&gt;
-    &lt;title&gt;Changes History&lt;/title&gt;
-    &lt;author email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">Rainer.Bieniek at vodafone.com</A>&quot;&gt;Rainer Bieniek&lt;/author&gt;
-  &lt;/properties&gt;
-  &lt;body&gt;
-    
-    &lt;release version=&quot;3.0-ALPHA4-SNAPSHOT&quot; date=&quot;in SVN&quot;&gt;
-      &lt;action dev=&quot;rbieniek&quot; type=&quot;change&quot;&gt;
-	Restructured project for multi-module project.
-      &lt;/action&gt;
+	&lt;properties&gt;
+		&lt;title&gt;Changes History&lt;/title&gt;
+		&lt;author email=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">matteo.merli at gmail.com</A>&quot;&gt;Matteo Merli&lt;/author&gt;
+	&lt;/properties&gt;
+	&lt;body&gt;
 
-      &lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
-	Added OSGi bundle skeleton.
-      &lt;/action&gt;
-    &lt;/release&gt;
-  &lt;/body&gt;
+		&lt;release version=&quot;3.0-ALPHA5-SNAPSHOT&quot; date=&quot;in SVN&quot;&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;update&quot;&gt;
+				Restructured project for multi-module project.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
+				Added OSGi bundle skeleton.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
+				Added support for XML based comfiguration files.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;update&quot;&gt;
+				Configuration has been changed from property-file to XML
+				config file. The configuration has been changed to allow
+				multiple filters per type and each filter may take its
+				configuration information from a central configuration
+				file.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;update&quot;&gt;
+				Changed logging framework from log4j to slf4j (Simple
+				Logging Facade for Java). This change streamlines the
+				logging framework with the underlying mina logging
+				approach. This changes also allows an easier integration
+				into containers which provide their own logging
+				mechanisms (like OSGi).
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
+				Added a concept of filters being applied to the upstream
+				(remote server) connection and the downstream client
+				connection. This allows for example IP addess based
+				filters which might constrain access to either the
+				streaming proxy, to remote streaming servers or both.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
+				Made installed filters manageable through JMX. An
+				individual filter can be suspended or resumed via JMX
+				and may provide addtional management capabilites by
+				exposing an linked MBean.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;add&quot;&gt;
+				All RTSP filters are now managed through a central
+				filter registry. This will allow the dynamic
+				reconfiguration of the applied filter chain per new
+				session.
+			&lt;/action&gt;
+
+			&lt;action dev=&quot;rbieniek&quot; type=&quot;update&quot;&gt;
+				Made URL rewriting working again. This filter is
+				actually applied to both the client and the server
+				connection because it needs to modify both request and
+				response. The response filter currently honours the
+				Content-base header, the RTP-Info header is not
+				processed yet.
+			&lt;/action&gt;
+
+		&lt;/release&gt;
+
+		&lt;release version=&quot;3.0-ALPHA4&quot; date=&quot;not released&quot; /&gt;
+
+		&lt;release version=&quot;3.0-ALPHA3&quot; date=&quot;not released&quot;&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Added support for RDT transport and RealVideo streams.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;change&quot;&gt;
+				Refactored the configuration subsystem.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Added JMX complaint remote management capabilities.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Added accounting filter to log accesses to the proxy
+				service.
+			&lt;/action&gt;
+		&lt;/release&gt;
+
+		&lt;release version=&quot;3.0-ALPHA2&quot; date=&quot;2005-12-08&quot;&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Added preliminary implementation of the IP address and
+				host name filter.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;fix&quot;&gt;
+				Fixed Windows startup script.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;update&quot;&gt;
+				Using only a UDP port pair for all RTP/RTCP packet
+				handling and sending for all the connected clients.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;fix&quot;&gt;
+				Properly clear session data when a session is closed.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;fix&quot;&gt;
+				Fixed several NullPointerException.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;update&quot;&gt;
+				Faster parsing of RTSP messages.
+			&lt;/action&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Handling proper shutdown of the service.
+			&lt;/action&gt;
+		&lt;/release&gt;
+
+		&lt;release version=&quot;3.0-ALPHA1&quot; date=&quot;2005-10-24&quot;&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;add&quot;&gt;
+				Completely rewritten the proxy from scratch in Java
+			&lt;/action&gt;
+		&lt;/release&gt;
+
+		&lt;release version=&quot;2.4.1&quot; date=&quot;2005-02-28&quot;&gt;
+			&lt;action dev=&quot;merlimat&quot; type=&quot;fix&quot;&gt;
+				Fixed a compilation bug.
+			&lt;/action&gt;
+		&lt;/release&gt;
+
+		&lt;release version=&quot;2.4&quot; date=&quot;2005-02-09&quot;&gt;
+			&lt;action type=&quot;fix&quot; dev=&quot;merlimat&quot;&gt;
+				In this release there are many important bug fixes that
+				make the proxy works with major RTSP streaming servers
+				and video players.
+			&lt;/action&gt;
+			&lt;action type=&quot;update&quot; dev=&quot;merlimat&quot;&gt;
+				The proxy was ported to MacOsX and now it can be
+				compiled using a various Gcc versions (2.95, 3.1, 3.3,
+				3.4).
+			&lt;/action&gt;
+		&lt;/release&gt;
+	&lt;/body&gt;
 &lt;/document&gt;
+

Modified: trunk/src/site/site.xml
===================================================================
--- trunk/src/site/site.xml	2006-04-14 15:41:06 UTC (rev 415)
+++ trunk/src/site/site.xml	2006-04-25 21:47:58 UTC (rev 416)
@@ -17,6 +17,10 @@
 		&lt;/links&gt;
 
 		&lt;menu name=&quot;Rtsp Proxy&quot;&gt;
+			&lt;item name=&quot;FALSE&quot; href=&quot;&quot;&gt;
+				&lt;item name=&quot;test1&quot; href=&quot;test1.html&quot; /&gt;
+				&lt;item name=&quot;test2&quot; href=&quot;&quot; /&gt;
+			&lt;/item&gt;
 			&lt;item
 				name=&quot;Home&quot;
 				href=&quot;index.html&quot; /&gt;
@@ -92,4 +96,4 @@
 
                ${modules}
 	&lt;/body&gt;
-&lt;/project&gt;
\ No newline at end of file
+&lt;/project&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000099.html">[Rtspproxy-devel] r415 - in trunk: RTSPProxy-App RTSPProxy-App/src/main/java/rtspproxy RTSPProxy-App/src/main/java/rtspproxy/filter/accounting RTSPProxy-App/src/resources/conf RTSPProxy-App/src/test/java/rtspproxy/filter/ipaddress RTSPProxy-Core RTSPProxy-Core/src/main/java/gov/nist/javax/sdp RTSPProxy-Core/src/main/java/javax/sdp RTSPProxy-Core/src/main/java/rtspproxy RTSPProxy-Core/src/main/java/rtspproxy/config RTSPProxy-Core/src/main/java/rtspproxy/filter RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication RTSPProxy-Core/src/main/java/rtspproxy/filter/authentication/scheme RTSPProxy-Core/src/main/java/rtspproxy/filter/control RTSPProxy-Core/src/main/java/rtspproxy/filter/rewrite RTSPProxy-Core/src/main/java/rtspproxy/filter/tracking RTSPProxy-Core/src/main/java/rtspproxy/jmx RTSPProxy-Core/src/main/java/rtspproxy/lib RTSPProxy-Core/src/main/java/rtspproxy/lib/number RTSPProxy-Core/src/main/java/rtspproxy/proxy RTSPProxy-Core/src/main/java/rtspproxy/proxy/track RTSPProxy-! Core/src/main/java/rtspproxy/rdt RTSPProxy-Core/src/main/java/rtspproxy/rtp/range RTSPProxy-Core/src/main/java/rtspproxy/rtsp
</A></li>
	<LI>Next message: <A HREF="000101.html">[Rtspproxy-devel] r417 - in trunk: . JainSDP JainSDP/src JainSDP/src/main JainSDP/src/main/java JainSDP/src/main/java/javax RTSPProxy-Core/src/main/java RTSPProxy-Core/src/main/java/javax RTSPProxy-OSGi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#100">[ date ]</a>
              <a href="thread.html#100">[ thread ]</a>
              <a href="subject.html#100">[ subject ]</a>
              <a href="author.html#100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/rtspproxy-devel">More information about the Rtspproxy-devel
mailing list</a><br>
</body></html>
